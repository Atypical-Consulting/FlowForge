---
phase: 11-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/settings.ts
  - src/components/settings/SettingsWindow.tsx
  - src/components/settings/GeneralSettings.tsx
  - src/components/settings/GitSettings.tsx
  - src/components/settings/AppearanceSettings.tsx
  - src/components/settings/index.ts
  - src/components/Header.tsx
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can open settings from header gear icon"
    - "User can open settings with Ctrl+, keyboard shortcut"
    - "Settings window shows categorized sections (General, Git, Appearance)"
    - "Settings changes apply immediately without Save button"
    - "Settings persist across app restarts"
  artifacts:
    - path: "src/stores/settings.ts"
      provides: "Settings state with Tauri store persistence"
      exports: ["useSettingsStore"]
    - path: "src/components/settings/SettingsWindow.tsx"
      provides: "Settings modal with sidebar navigation"
      exports: ["SettingsWindow"]
  key_links:
    - from: "src/components/Header.tsx"
      to: "src/stores/settings.ts"
      via: "open settings action"
      pattern: "openSettings|setOpen"
    - from: "src/stores/settings.ts"
      to: "@tauri-apps/plugin-store"
      via: "persistence"
      pattern: "getStore|store\\.set"
---

<objective>
Create settings window with categorized sections and persistent storage.

Purpose: Allow users to configure preferences (theme, Git defaults) in an organized UI that persists across sessions.
Output: Settings store with persistence, Settings window component accessible from header and keyboard shortcut.
</objective>

<execution_context>
@C:\Users\matrayp\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\matrayp\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-foundation/11-CONTEXT.md
@.planning/phases/11-foundation/11-RESEARCH.md
@src/stores/theme.ts
@src/lib/store.ts
@src/components/Header.tsx
@src/components/ui/dialog.tsx
@src/hooks/useKeyboardShortcuts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Settings Store with Persistence</name>
  <files>src/stores/settings.ts</files>
  <action>
Create zustand store for settings following theme.ts pattern for Tauri store persistence.

Settings to manage (organized by category):

General:
- defaultTab: 'changes' | 'history' | 'topology' (default: 'changes')

Git:
- defaultRemote: string (default: 'origin')
- autoFetchInterval: number | null (minutes, null = disabled, default: null)

Appearance:
- theme: already in theme.ts, reference from there

Store structure:
- isOpen: boolean (controls settings window visibility)
- activeCategory: 'general' | 'git' | 'appearance'
- settings: { general: {...}, git: {...} }
- openSettings: () => void
- closeSettings: () => void
- setCategory: (category) => void
- updateSetting: (category, key, value) => Promise<void>
- initSettings: () => Promise<void>

Persistence:
- Use getStore() from lib/store.ts
- Load settings on init
- Save immediately on each update (await store.set(), await store.save())
- Key in store: 'settings'
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>Settings store with persistence, exports useSettingsStore</done>
</task>

<task type="auto">
  <name>Task 2: Create Settings Window Component</name>
  <files>src/components/settings/SettingsWindow.tsx, src/components/settings/GeneralSettings.tsx, src/components/settings/GitSettings.tsx, src/components/settings/AppearanceSettings.tsx, src/components/settings/index.ts</files>
  <action>
Create settings components following VS Code style (sidebar categories on left, content on right).

SettingsWindow.tsx:
- Use Dialog component from ui/dialog.tsx
- Width: max-w-2xl, height: h-[500px]
- Left sidebar: 180px width, list of category buttons
- Right content: flex-1, renders active category component
- Categories: General (Sliders icon), Git (GitBranch icon), Appearance (Palette icon)
- Active category highlighted with ctp-blue background

GeneralSettings.tsx:
- Default tab selector (radio buttons or select)
- Label: "Default view when opening repository"
- Options: Changes, History, Topology

GitSettings.tsx:
- Default remote input (text field, default 'origin')
- Auto-fetch interval (number input + checkbox to enable/disable)
- Label: "Auto-fetch interval (minutes)"

AppearanceSettings.tsx:
- Theme selector using existing useThemeStore
- Options: Light, Dark, System
- Render as radio buttons or segmented control

index.ts:
- Export SettingsWindow

All settings use immediate apply pattern - onChange calls updateSetting directly, no Save button needed.
  </action>
  <verify>npx tsc --noEmit</verify>
  <done>Settings window renders with three categories, each with appropriate controls</done>
</task>

<task type="auto">
  <name>Task 3: Add Settings Access Points</name>
  <files>src/components/Header.tsx, src/App.tsx, src/hooks/useKeyboardShortcuts.ts</files>
  <action>
Header.tsx:
- Import Settings icon from lucide-react
- Add settings button next to ThemeToggle (gear icon)
- onClick calls useSettingsStore().openSettings()
- Title: "Settings (Ctrl+,)"

App.tsx:
- Import SettingsWindow from './components/settings'
- Add SettingsWindow component after ChangelogDialog
- Initialize settings on mount: useEffect with initSettings()

useKeyboardShortcuts.ts:
- Add Ctrl+, (mod+,) shortcut
- On trigger: call openSettings from settings store
- Add to the existing shortcuts list in the file header comment
  </action>
  <verify>npm run tauri dev - click gear icon opens settings, Ctrl+, opens settings</verify>
  <done>Settings accessible from header icon and keyboard shortcut</done>
</task>

</tasks>

<verification>
1. npm run tauri dev - app starts
2. Click gear icon in header - settings window opens
3. Press Ctrl+, - settings window opens
4. Change theme in settings - applies immediately
5. Close and reopen app - settings persist
</verification>

<success_criteria>
- Settings window opens from header gear icon
- Settings window opens with Ctrl+, shortcut
- Three categories visible: General, Git, Appearance
- Settings changes apply immediately
- Settings persist after app restart
- Requirements DFLT-05, DFLT-06 satisfied
</success_criteria>

<output>
After completion, create .planning/phases/11-foundation/11-02-SUMMARY.md
</output>
