---
phase: 11-foundation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/branches/BranchItem.tsx
  - src/components/stash/StashItem.tsx
  - src/components/tags/TagItem.tsx
  - src/components/RepositoryView.tsx
  - src/components/commit/CommitForm.tsx
  - src/components/commit/ConventionalCommitModal.tsx
autonomous: true

must_haves:
  truths:
    - "Left panel items display with compact spacing (VS Code style)"
    - "Action icons do not overlap with text content"
    - "Commit form is positioned at bottom of left panel"
    - "Conventional Commits checkbox is unchecked by default"
    - "Conventional Commits type/scope opens as modal"
  artifacts:
    - path: "src/components/branches/BranchItem.tsx"
      provides: "Compact branch item with non-overlapping icons"
    - path: "src/components/commit/ConventionalCommitModal.tsx"
      provides: "Modal for conventional commit type/scope selection"
      exports: ["ConventionalCommitModal"]
  key_links:
    - from: "src/components/RepositoryView.tsx"
      to: "CommitForm"
      via: "JSX in left panel"
      pattern: "<CommitForm"
    - from: "src/components/commit/CommitForm.tsx"
      to: "ConventionalCommitModal"
      via: "modal trigger"
      pattern: "<ConventionalCommitModal|setShowModal"
---

<objective>
Fix layout issues: left panel spacing, icon overlap, and commit panel positioning.

Purpose: Improve usability by ensuring readable text, non-overlapping controls, and logical panel organization (GitHub Desktop style).
Output: Compact left panel items, commit form at bottom of left panel, conventional commits as modal.
</objective>

<execution_context>
@C:\Users\matrayp\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\matrayp\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-foundation/11-CONTEXT.md
@src/components/branches/BranchItem.tsx
@src/components/stash/StashItem.tsx
@src/components/tags/TagItem.tsx
@src/components/RepositoryView.tsx
@src/components/commit/CommitForm.tsx
@src/components/commit/ConventionalCommitForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compact Left Panel Item Spacing</name>
  <files>src/components/branches/BranchItem.tsx, src/components/stash/StashItem.tsx, src/components/tags/TagItem.tsx</files>
  <action>
Update all three item components for compact, VS Code-style spacing:

BranchItem.tsx:
- Reduce padding: px-2 py-1 (was px-3 py-2)
- Reduce icon size: w-3.5 h-3.5 (was w-4 h-4)
- Reduce action button padding: p-1 (was p-1.5)
- Ensure text truncates with min-w-0 flex-1 on text container
- Add gap-1.5 between icon and text (was gap-2)
- Action buttons: use opacity-0 group-hover:opacity-100 pattern to show on hover only
- Add 'group' class to root container

StashItem.tsx:
- Apply same spacing changes as BranchItem
- Ensure stash message truncates properly

TagItem.tsx:
- Apply same spacing changes as BranchItem
- Ensure tag name truncates properly

Key: Icons MUST NOT overlap text. Use flexbox with shrink-0 on icons, min-w-0 + truncate on text.
  </action>
  <verify>npm run tauri dev - check left panel items are compact, text doesn't overlap with icons</verify>
  <done>Left panel items use compact spacing, icons don't overlap text</done>
</task>

<task type="auto">
  <name>Task 2: Move Commit Form to Left Panel</name>
  <files>src/components/RepositoryView.tsx</files>
  <action>
Restructure RepositoryView to place CommitForm at bottom of left panel (GitHub Desktop style).

Current structure:
- Left sidebar (branches/stashes/tags/gitflow/worktrees)
- Middle panel (tabs + StagingPanel + CommitForm at bottom)
- Right panel (diff viewer)

New structure:
- Left sidebar: branches/stashes/tags/gitflow/worktrees + CommitForm at very bottom
- Middle panel: tabs + StagingPanel only (no CommitForm)
- Right panel: diff viewer (unchanged)

Implementation:
1. In left panel (id="sidebar"), after the worktrees details section:
   - Add a div with className="mt-auto border-t border-ctp-surface0"
   - Render CommitForm inside this div
2. In middle panel (activeTab === "changes" block):
   - Remove CommitForm from the fragment
   - Keep only StagingPanel
3. The left panel needs flex flex-col to allow mt-auto to push CommitForm to bottom:
   - Update the inner div: "h-full border-r border-ctp-surface0 bg-ctp-base flex flex-col"
   - Wrap the details sections in a div with "flex-1 overflow-y-auto"
   - CommitForm goes after this wrapper with "shrink-0"

This ensures StagingPanel in middle panel is not covered by CommitForm.
  </action>
  <verify>npm run tauri dev - CommitForm appears at bottom of left panel, StagingPanel has full middle panel height</verify>
  <done>Commit form positioned at bottom of left panel, changes list not covered</done>
</task>

<task type="auto">
  <name>Task 3: Conventional Commits Modal and Default Off</name>
  <files>src/components/commit/CommitForm.tsx, src/components/commit/ConventionalCommitModal.tsx</files>
  <action>
CommitForm.tsx changes:
- Change default: useState(false) instead of useState(true) for useConventional
- When useConventional is true, show a button "Configure commit..." that opens modal
- When useConventional is false, show simple textarea (existing behavior)
- The "Conventional Commits" checkbox stays as toggle

Create ConventionalCommitModal.tsx:
- Use Dialog component from ui/dialog.tsx
- Receives: open, onOpenChange, onCommit callback
- Contains the full ConventionalCommitForm component
- Modal title: "Conventional Commit"
- Width: max-w-lg

Integration flow:
1. User checks "Conventional Commits" checkbox
2. Instead of inline form, show button "Write commit message..."
3. Clicking button opens ConventionalCommitModal
4. User fills form in modal, clicks Commit
5. Modal closes, commit executes

This prevents the conventional commit form from taking space in the commit panel,
addressing LAYOUT-03 (panel doesn't cover changes list).
  </action>
  <verify>npm run tauri dev - conventional commits checkbox is off by default, checking it shows modal trigger button</verify>
  <done>Conventional commits unchecked by default, opens as modal when enabled</done>
</task>

</tasks>

<verification>
1. npm run tauri dev - app starts
2. Left panel: items are compact, icons don't overlap text
3. Commit form appears at bottom of left panel
4. Conventional commits checkbox is OFF by default
5. When enabled, opens modal instead of inline form
6. Middle panel (Changes tab) shows only file list, no overlap
</verification>

<success_criteria>
- Left panel uses compact VS Code-style spacing (LAYOUT-01)
- Icons never overlap text content (LAYOUT-02)
- Commit form at bottom of left panel, changes list not covered (LAYOUT-03)
- Conventional commits checkbox defaults to unchecked (DFLT-01)
- Conventional commits type/scope selection opens as modal (CONTEXT decision)
</success_criteria>

<output>
After completion, create .planning/phases/11-foundation/11-03-SUMMARY.md
</output>
