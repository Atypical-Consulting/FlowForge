---
phase: 24-code-review-guidance-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/reviewChecklist.ts
  - src/components/gitflow/ReviewChecklist.tsx
  - src/components/gitflow/FinishFlowDialog.tsx
  - src/components/settings/ReviewSettings.tsx
  - src/components/blades/SettingsBlade.tsx
  - src/stores/settings.ts
  - src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a review checklist with per-flow-type items when finishing a Gitflow feature, release, or hotfix"
    - "Checklist items are advisory and never block the Finish button"
    - "User can configure custom checklist items per flow type in the Settings blade"
    - "Custom checklist items persist across app restarts"
  artifacts:
    - path: "src/stores/reviewChecklist.ts"
      provides: "Zustand store for review checklist item definitions with Tauri store persistence"
      exports: ["useReviewChecklistStore", "ChecklistItem"]
    - path: "src/components/gitflow/ReviewChecklist.tsx"
      provides: "Checklist UI component rendered inside FinishFlowDialog"
      exports: ["ReviewChecklist"]
    - path: "src/components/settings/ReviewSettings.tsx"
      provides: "Settings tab for CRUD management of checklist items per flow type"
      exports: ["ReviewSettings"]
  key_links:
    - from: "src/components/gitflow/FinishFlowDialog.tsx"
      to: "src/components/gitflow/ReviewChecklist.tsx"
      via: "<ReviewChecklist flowType={flowType} /> between description and tag message"
      pattern: "ReviewChecklist.*flowType"
    - from: "src/components/gitflow/ReviewChecklist.tsx"
      to: "src/stores/reviewChecklist.ts"
      via: "useReviewChecklistStore hook"
      pattern: "useReviewChecklistStore"
    - from: "src/stores/reviewChecklist.ts"
      to: "src/lib/store.ts"
      via: "getStore() for Tauri plugin-store persistence"
      pattern: "getStore.*review-checklist"
    - from: "src/components/blades/SettingsBlade.tsx"
      to: "src/components/settings/ReviewSettings.tsx"
      via: "New 'review' tab in settingsTabs array"
      pattern: "ReviewSettings"
    - from: "src/App.tsx"
      to: "src/stores/reviewChecklist.ts"
      via: "initChecklist() called in startup useEffect"
      pattern: "initChecklist"
---

<objective>
Add a pre-merge review checklist to the Gitflow FinishFlowDialog and a settings tab for checklist configuration.

Purpose: Users receive lightweight review guidance (advisory, never blocking) when finishing a Gitflow feature, release, or hotfix, reducing missed review steps. Configurable items let users tailor the checklist to their workflow.

Output: Zustand store with Tauri persistence, ReviewChecklist component in FinishFlowDialog, ReviewSettings tab in SettingsBlade.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/stores/branchMetadata.ts (follow this exact persistence pattern)
@src/stores/settings.ts (extend SettingsCategory type)
@src/components/gitflow/FinishFlowDialog.tsx (insert checklist here)
@src/components/blades/SettingsBlade.tsx (add review tab)
@src/App.tsx (add initChecklist to startup)
@src/lib/store.ts (getStore helper)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create review checklist store and UI component</name>
  <files>
    src/stores/reviewChecklist.ts
    src/components/gitflow/ReviewChecklist.tsx
  </files>
  <action>
    **Create `src/stores/reviewChecklist.ts`:**

    Follow the exact pattern from `branchMetadata.ts` for Tauri store persistence.

    - Define `ChecklistItem` interface: `{ id: string; label: string; checked: boolean }`
    - Define `FlowType = "feature" | "release" | "hotfix"`
    - Define `DEFAULT_CHECKLIST` record with per-flow-type items:
      - feature: "All tests pass", "No debug/console.log statements", "Code has been self-reviewed"
      - release: "Changelog is up to date", "Version number has been bumped", "All tests pass", "Documentation is current"
      - hotfix: "Fix has been verified", "Regression test added", "No unintended side effects"
    - Store key: `"review-checklist-items"`
    - State: `customItems: Record<FlowType, Omit<ChecklistItem, "checked">[]>` (only label+id stored, checked state is ephemeral)
    - Actions:
      - `initChecklist()` — loads from Tauri store (follow `initMetadata` pattern exactly: `const store = await getStore(); const saved = await store.get<...>(STORE_KEY)`)
      - `getItems(flowType)` — returns custom items if any exist for that type, otherwise falls back to `DEFAULT_CHECKLIST[flowType]`
      - `updateItems(flowType, items)` — persists to store (`await store.set(key, data); await store.save()`) then updates Zustand state
      - `resetToDefaults(flowType)` — clears custom items for a flow type (sets to empty array, which triggers default fallback)
    - Export `useReviewChecklistStore` and `DEFAULT_CHECKLIST`

    **Create `src/components/gitflow/ReviewChecklist.tsx`:**

    - Props: `{ flowType: "feature" | "release" | "hotfix" }`
    - Local state: `checked: Record<string, boolean>` (ephemeral, not persisted — reset each dialog open)
    - Use `useReviewChecklistStore().getItems(flowType)` to get item list
    - Render a collapsible section with `ClipboardCheck` icon from lucide-react and "Review checklist" header
    - Each item is a `<label>` with `<input type="checkbox">` — styled with Catppuccin tokens (`bg-ctp-surface0`, `border-ctp-surface2`, `text-ctp-blue` for checked, `text-ctp-overlay1` for label)
    - Show checked count: "2/3 items checked" below the list in `text-ctp-overlay0` size `text-xs`
    - If no items (empty getItems result), render nothing (return null)
    - CRITICAL: The component is purely advisory — it does NOT pass any state up to FinishFlowDialog or affect the Finish button's disabled state
  </action>
  <verify>
    - `npx tsc --noEmit` passes without errors in `reviewChecklist.ts` and `ReviewChecklist.tsx`
    - Store exports `useReviewChecklistStore` with all 4 actions (initChecklist, getItems, updateItems, resetToDefaults)
    - Component renders checkboxes from default items when no custom items are stored
  </verify>
  <done>
    Review checklist store persists to Tauri store following branchMetadata.ts pattern. ReviewChecklist component renders per-flow-type checkbox items with ephemeral checked state. No items block the merge flow.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate checklist into FinishFlowDialog, add Settings tab, wire initialization</name>
  <files>
    src/components/gitflow/FinishFlowDialog.tsx
    src/components/settings/ReviewSettings.tsx
    src/components/blades/SettingsBlade.tsx
    src/stores/settings.ts
    src/App.tsx
  </files>
  <action>
    **Modify `src/components/gitflow/FinishFlowDialog.tsx`:**

    - Import `ReviewChecklist` from `./ReviewChecklist`
    - Insert `<ReviewChecklist flowType={flowType} />` in the form between the description paragraph (`<p className="text-sm text-ctp-overlay1">...`) and the `{needsTagMessage && ...}` block
    - Do NOT modify the submit button or disabled logic — checklist is purely visual/advisory
    - No other changes to this file

    **Create `src/components/settings/ReviewSettings.tsx`:**

    - Import `useReviewChecklistStore` and `DEFAULT_CHECKLIST`
    - Allow user to manage checklist items for each flow type (feature, release, hotfix)
    - UI structure: 3 sections (one per flow type), each with:
      - Section header with flow type name (capitalized) and a "Reset to defaults" button (`text-ctp-blue text-xs hover:underline`)
      - List of current items with delete button (Trash2 icon, `text-ctp-red` on hover)
      - "Add item" row: text input + Plus icon button to add a new item
    - When adding: generate id as `custom-{Date.now()}`, call `updateItems(flowType, [...currentItems, newItem])`
    - When deleting: call `updateItems(flowType, currentItems.filter(i => i.id !== id))`
    - When resetting: call `resetToDefaults(flowType)`
    - Style consistently with existing settings panels (GeneralSettings, GitSettings) — use same heading sizes, spacing, input styles

    **Modify `src/stores/settings.ts`:**

    - Add `"review"` to the `SettingsCategory` type union: `type SettingsCategory = "general" | "git" | "appearance" | "integrations" | "review"`
    - No other changes needed — the Settings store just needs the type to include the new category

    **Modify `src/components/blades/SettingsBlade.tsx`:**

    - Import `ReviewSettings` from `../settings/ReviewSettings`
    - Import `ClipboardCheck` from `lucide-react`
    - Add a new tab to `settingsTabs` array AFTER "integrations" and BEFORE "appearance":
      ```
      { id: "review", label: "Review", icon: <ClipboardCheck className="w-4 h-4" />, panel: <ReviewSettings /> }
      ```

    **Modify `src/App.tsx`:**

    - Import `useReviewChecklistStore` from `./stores/reviewChecklist`
    - Add `const initChecklist = useReviewChecklistStore((s) => s.initChecklist);` alongside existing init hooks
    - Add `initChecklist();` to the startup useEffect body (after `initMetadata()`)
    - Add `initChecklist` to the useEffect dependency array
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - SettingsBlade renders 5 tabs (General, Git, Integrations, Review, Appearance)
    - FinishFlowDialog includes `<ReviewChecklist>` in its form JSX
    - App.tsx calls `initChecklist()` on mount
  </verify>
  <done>
    FinishFlowDialog shows review checklist between description and tag message. Settings blade has a "Review" tab for managing checklist items per flow type with add/delete/reset. Checklist store initializes on app startup.
  </done>
</task>

</tasks>

<verification>
1. Open a repository with Gitflow initialized and an active feature branch
2. Click "Finish Feature" — the FinishFlowDialog should show a review checklist with 3 default items below the merge description
3. Check/uncheck items — the Finish button remains enabled regardless of checked state
4. Click Finish — the merge completes normally (checklist does not block)
5. Open Settings blade → Review tab — verify 3 flow type sections with their default items
6. Add a custom item to the feature checklist, close and reopen Settings — item persists
7. Start a new "Finish Feature" flow — the custom item appears in the checklist
8. Reset to defaults in Settings — default items are restored
9. Restart the app — custom items still persist (Tauri store)
</verification>

<success_criteria>
- FinishFlowDialog shows per-flow-type review checklist that never blocks the Finish button
- Settings blade has a "Review" tab for CRUD management of checklist items per flow type
- Checklist items persist across app restarts via Tauri plugin-store
- Default items are provided for feature (3 items), release (4 items), and hotfix (3 items)
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/24-code-review-guidance-documentation/24-01-SUMMARY.md`
</output>
