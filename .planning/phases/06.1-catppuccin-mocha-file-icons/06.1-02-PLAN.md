---
phase: 06.1-catppuccin-mocha-file-icons
plan: 02
type: execute
wave: 2
depends_on: ["06.1-01"]
files_modified:
  - src/components/staging/FileItem.tsx
  - src/components/staging/FileTreeView.tsx
autonomous: true

must_haves:
  truths:
    - "User sees file-type-specific icons next to each file in the changes view"
    - "Icons follow Catppuccin Mocha color palette"
    - "Common file types have distinct recognizable icons"
    - "Folder icons distinguish directories from files"
    - "Git status is still visible via colored dot indicator"
  artifacts:
    - path: "src/components/staging/FileItem.tsx"
      provides: "File item with type icon + status indicator"
      contains: "FileTypeIcon"
    - path: "src/components/staging/FileTreeView.tsx"
      provides: "Tree view with folder icons"
      contains: "FileTypeIcon"
  key_links:
    - from: "src/components/staging/FileItem.tsx"
      to: "src/components/icons/FileTypeIcon.tsx"
      via: "component import"
      pattern: "import.*FileTypeIcon.*from"
    - from: "src/components/staging/FileTreeView.tsx"
      to: "src/components/icons/FileTypeIcon.tsx"
      via: "component import"
      pattern: "import.*FileTypeIcon.*from"
---

<objective>
Integrate Catppuccin Mocha file icons into FileItem and FileTreeView components

Purpose: Replace generic Lucide status icons with file-type-specific Catppuccin icons while preserving git status visibility through a secondary indicator.

Output: Changes view displays file-type icons for all files, folder icons for directories, with git status shown via colored dot indicator.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.1-catppuccin-mocha-file-icons/06.1-RESEARCH.md
@.planning/phases/06.1-catppuccin-mocha-file-icons/06.1-01-SUMMARY.md
@src/components/staging/FileItem.tsx
@src/components/staging/FileTreeView.tsx
@src/components/icons/FileTypeIcon.tsx
@src/lib/file-icons.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update FileItem with file type icon and status dot</name>
  <files>
    - src/components/staging/FileItem.tsx
  </files>
  <action>
1. Add import for FileTypeIcon:
   ```typescript
   import { FileTypeIcon } from "@/components/icons/FileTypeIcon";
   ```

2. Create a status dot helper function to map git status to colors:
   ```typescript
   function getStatusDot(status: FileStatus): { color: string; title: string } {
     if (status === "added") return { color: "bg-green-500", title: "Added" };
     if (status === "deleted") return { color: "bg-red-500", title: "Deleted" };
     if (status === "modified") return { color: "bg-yellow-500", title: "Modified" };
     if (status === "untracked") return { color: "bg-blue-500", title: "Untracked" };
     if (typeof status === "object" && "renamed" in status) {
       return { color: "bg-purple-500", title: "Renamed" };
     }
     return { color: "bg-gray-500", title: "Unknown" };
   }
   ```

3. Replace the current icon rendering with a dual-icon approach:
   
   Current code (remove):
   ```tsx
   const StatusIcon = getStatusIcon(file.status);
   // ...
   <StatusIcon className="w-4 h-4 text-gray-400 shrink-0" />
   ```
   
   New code:
   ```tsx
   const statusDot = getStatusDot(file.status);
   // ...
   <div className="relative shrink-0">
     <FileTypeIcon path={file.path} className="w-4 h-4" />
     <span 
       className={cn(
         "absolute -bottom-0.5 -right-0.5 w-2 h-2 rounded-full border border-gray-900",
         statusDot.color
       )}
       title={statusDot.title}
     />
   </div>
   ```

4. Remove unused imports:
   - Remove: FilePlus, FileMinus, FileEdit, FileQuestion from lucide-react import
   - Keep: Check, X (still used for stage/unstage buttons)

5. Remove the getStatusIcon function (no longer needed).

6. Keep all other logic unchanged (staging/unstaging mutations, selection state, etc.)
  </action>
  <verify>
    - `npm run build` succeeds
    - `npx tsc --noEmit` shows no TypeScript errors
    - No unused imports warnings from linter
  </verify>
  <done>FileItem shows file type icon with status dot overlay for git status</done>
</task>

<task type="auto">
  <name>Task 2: Update FileTreeView with folder icons</name>
  <files>
    - src/components/staging/FileTreeView.tsx
  </files>
  <action>
1. Add import for FileTypeIcon:
   ```typescript
   import { FileTypeIcon } from "@/components/icons/FileTypeIcon";
   ```

2. In the TreeNode component, replace the Lucide Folder icon with FileTypeIcon:
   
   Current code (in the directory rendering section):
   ```tsx
   <Folder className="w-4 h-4 text-blue-400" />
   ```
   
   Replace with:
   ```tsx
   <FileTypeIcon 
     path={node.path} 
     isDirectory={true} 
     isOpen={expanded} 
   />
   ```

3. Update imports:
   - Remove: Folder from lucide-react import
   - Keep: ChevronDown, ChevronRight (still used for expand/collapse arrows)
   
   The import line should become:
   ```typescript
   import { ChevronDown, ChevronRight } from "lucide-react";
   ```

4. The FileItem component used within TreeNode will automatically show file type icons since we updated it in Task 1.
  </action>
  <verify>
    - `npm run build` succeeds
    - `npx tsc --noEmit` shows no TypeScript errors
    - Folder icons change when expanded/collapsed
  </verify>
  <done>FileTreeView displays Catppuccin folder icons with open/closed states</done>
</task>

</tasks>

<verification>
1. Build check: `npm run build` completes successfully
2. Type check: `npx tsc --noEmit` shows no errors
3. Lint check: `npm run check` passes (Biome)
4. Visual verification (with `npm run tauri dev`):
   - Create or modify files of various types (.ts, .tsx, .rs, .json, .md, .py)
   - Verify each file shows appropriate file type icon
   - Verify git status dot shows correct color:
     - Green = added/new files
     - Yellow = modified files
     - Red = deleted files
     - Blue = untracked files
     - Purple = renamed files
   - Switch to tree view mode
   - Verify folders show folder icons
   - Expand/collapse folders and verify icon changes (open vs closed folder)
</verification>

<success_criteria>
- FileItem displays file-type-specific icons from Catppuccin Mocha theme
- Git status visible via small colored dot indicator overlaying the icon
- Status dot colors: green=added, yellow=modified, red=deleted, blue=untracked, purple=renamed
- FileTreeView folders display Catppuccin folder icons
- Folder icons change based on expanded/collapsed state
- Build succeeds with no TypeScript errors
- No visual regression in staging panel functionality (stage/unstage still works)
- Lucide icon imports cleaned up (no unused imports)
</success_criteria>

<output>
After completion, create `.planning/phases/06.1-catppuccin-mocha-file-icons/06.1-02-SUMMARY.md`
</output>
