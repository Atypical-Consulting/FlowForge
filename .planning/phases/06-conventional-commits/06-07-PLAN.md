---
phase: 06-conventional-commits
plan: 07
type: execute
wave: 4
depends_on: ["06-05"]
files_modified:
  - src/components/commit/CommitForm.tsx
  - src/views/RepositoryView.tsx
autonomous: false

must_haves:
  truths:
    - "Existing commit form replaced with ConventionalCommitForm"
    - "Commit flow uses conventional commit validation"
    - "User experience is seamless for committing"
  artifacts:
    - path: "src/components/commit/CommitForm.tsx"
      provides: "Updated commit form using conventional commits"
  key_links:
    - from: "src/components/commit/CommitForm.tsx"
      to: "src/components/commit/ConventionalCommitForm.tsx"
      via: "import and render"
      pattern: "ConventionalCommitForm"
---

<objective>
Integrate the ConventionalCommitForm into the existing commit workflow.

Purpose: Replace or enhance the existing commit form with conventional commit support.
Output: Seamless integration where committing uses the new form with validation and suggestions.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-conventional-commits/06-05-SUMMARY.md
@src/components/commit/CommitForm.tsx
@src/views/RepositoryView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update CommitForm to use ConventionalCommitForm</name>
  <files>src/components/commit/CommitForm.tsx</files>
  <action>
1. Read the existing `src/components/commit/CommitForm.tsx` to understand current structure.

2. Modify CommitForm to either:
   
   **Option A - Full replacement:**
   Replace the form content with ConventionalCommitForm:
   ```typescript
   import { ConventionalCommitForm } from './ConventionalCommitForm';
   import { useCommit } from '../../hooks/useCommit'; // or similar
   
   export function CommitForm() {
     const { commit, isCommitting } = useCommit();
     
     const handleCommit = async (message: string) => {
       await commit(message);
     };
     
     return (
       <div className="p-4">
         <h3 className="text-lg font-semibold mb-4">Commit Changes</h3>
         <ConventionalCommitForm
           onCommit={handleCommit}
           disabled={isCommitting}
         />
       </div>
     );
   }
   ```
   
   **Option B - Toggle between modes:**
   Add a toggle to switch between simple and conventional:
   ```typescript
   const [useConventional, setUseConventional] = useState(true);
   
   return (
     <div className="p-4">
       <div className="flex items-center justify-between mb-4">
         <h3 className="text-lg font-semibold">Commit Changes</h3>
         <label className="flex items-center gap-2 text-sm">
           <input
             type="checkbox"
             checked={useConventional}
             onChange={(e) => setUseConventional(e.target.checked)}
           />
           Conventional Commits
         </label>
       </div>
       
       {useConventional ? (
         <ConventionalCommitForm onCommit={handleCommit} disabled={isCommitting} />
       ) : (
         <SimpleCommitForm onCommit={handleCommit} disabled={isCommitting} />
       )}
     </div>
   );
   ```

3. Ensure the commit action from existing code is wired to ConventionalCommitForm's onCommit callback.

4. Handle loading states and errors from the commit operation.
  </action>
  <verify>
    - CommitForm renders ConventionalCommitForm
    - Commit action works end-to-end
    - TypeScript compiles
  </verify>
  <done>CommitForm updated to use conventional commits</done>
</task>

<task type="auto">
  <name>Task 2: Verify integration in RepositoryView</name>
  <files>src/views/RepositoryView.tsx</files>
  <action>
1. Check how CommitForm is used in RepositoryView or parent components.

2. Ensure the integration is correct:
   - CommitForm receives necessary props
   - Commit success triggers refresh of staging/history
   - Error handling shows user feedback

3. If CommitForm is in a panel or collapsible section, ensure it has enough space for the expanded conventional form (with suggestions, validation, etc.).

4. Test the flow:
   - Stage files
   - Open commit form
   - See type suggestion appear
   - See scope suggestion/autocomplete
   - Write description
   - See validation
   - Commit
   - See changes reflected in history
  </action>
  <verify>
    - Full commit flow works in RepositoryView
    - UI has adequate space for form
    - Refresh after commit works
  </verify>
  <done>Integration verified in repository view</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete conventional commit integration:
    - Type suggestion based on staged files
    - Scope autocomplete from commit history
    - Real-time validation with errors/warnings
    - Breaking change support
    - Preview of formatted message
    - Integrated into main commit workflow
  </what-built>
  <how-to-verify>
    1. Open the app with `npm run tauri dev`
    2. Open a Git repository
    3. Make some changes and stage them
    4. Open the commit form
    5. Verify you see type suggestions
    6. Select a type from dropdown
    7. Try scope autocomplete (type and see suggestions)
    8. Enter a description
    9. Check the validation status
    10. Toggle breaking change and see footer input
    11. Review the preview
    12. Commit and verify it works
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
```bash
# Type check
npm run typecheck || pnpm typecheck

# Build
npm run build || pnpm build

# Dev server for manual testing
npm run tauri dev
```
</verification>

<success_criteria>
- [ ] CommitForm uses ConventionalCommitForm
- [ ] Type suggestions appear for staged files
- [ ] Scope autocomplete works
- [ ] Validation shows errors/warnings in real-time
- [ ] Breaking change toggle works
- [ ] Preview shows formatted message
- [ ] Commit creates proper conventional commit
- [ ] UI verified by user
</success_criteria>

<output>
After completion, create `.planning/phases/06-conventional-commits/06-07-SUMMARY.md`
</output>
