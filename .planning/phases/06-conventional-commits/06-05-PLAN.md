---
phase: 06-conventional-commits
plan: 05
type: execute
wave: 3
depends_on: ["06-03", "06-04"]
files_modified:
  - src/components/commit/ConventionalCommitForm.tsx
  - src/components/commit/TypeSelector.tsx
  - src/components/commit/ScopeAutocomplete.tsx
  - src/components/commit/BreakingChangeSection.tsx
  - src/components/commit/ValidationErrors.tsx
autonomous: true

must_haves:
  truths:
    - "User can select commit type from dropdown with suggestions"
    - "User can enter scope with autocomplete from history"
    - "User sees real-time validation errors"
    - "User can mark breaking change with footer"
  artifacts:
    - path: "src/components/commit/ConventionalCommitForm.tsx"
      provides: "Main conventional commit form component"
      exports: ["ConventionalCommitForm"]
    - path: "src/components/commit/TypeSelector.tsx"
      provides: "Commit type dropdown with suggestions"
      exports: ["TypeSelector"]
    - path: "src/components/commit/ScopeAutocomplete.tsx"
      provides: "Scope input with autocomplete"
      exports: ["ScopeAutocomplete"]
    - path: "src/components/commit/ValidationErrors.tsx"
      provides: "Validation error display"
      exports: ["ValidationErrors"]
  key_links:
    - from: "src/components/commit/ConventionalCommitForm.tsx"
      to: "src/hooks/useConventionalCommit.ts"
      via: "hook usage"
      pattern: "useConventionalCommit"
---

<objective>
Create the conventional commit form UI components.

Purpose: Provide a user-friendly interface for composing conventional commits with suggestions and validation.
Output: React components for the commit form with type selection, scope autocomplete, and validation display.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-conventional-commits/06-04-SUMMARY.md
@src/components/commit/CommitForm.tsx
@src/components/ui/
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TypeSelector and ScopeAutocomplete components</name>
  <files>src/components/commit/TypeSelector.tsx, src/components/commit/ScopeAutocomplete.tsx</files>
  <action>
1. Create `src/components/commit/TypeSelector.tsx`:

```typescript
import { type CommitType, COMMIT_TYPES } from '../../stores/conventionalStore';
import type { TypeSuggestion } from '../../stores/conventionalStore';

interface TypeSelectorProps {
  value: CommitType | '';
  onChange: (type: CommitType) => void;
  suggestion: TypeSuggestion | null;
  onApplySuggestion: () => void;
}

const TYPE_LABELS: Record<CommitType, { label: string; emoji: string; description: string }> = {
  feat: { label: 'feat', emoji: '‚ú®', description: 'A new feature' },
  fix: { label: 'fix', emoji: 'üêõ', description: 'A bug fix' },
  docs: { label: 'docs', emoji: 'üìö', description: 'Documentation only changes' },
  style: { label: 'style', emoji: 'üíÑ', description: 'Formatting, white-space, etc' },
  refactor: { label: 'refactor', emoji: '‚ôªÔ∏è', description: 'Code change that neither fixes a bug nor adds a feature' },
  perf: { label: 'perf', emoji: '‚ö°', description: 'A code change that improves performance' },
  test: { label: 'test', emoji: '‚úÖ', description: 'Adding missing tests' },
  chore: { label: 'chore', emoji: 'üîß', description: 'Other changes that don\'t modify src or test' },
  ci: { label: 'ci', emoji: 'üë∑', description: 'CI configuration changes' },
  build: { label: 'build', emoji: 'üì¶', description: 'Build system or dependencies' },
  revert: { label: 'revert', emoji: '‚è™', description: 'Reverts a previous commit' },
};

export function TypeSelector({ value, onChange, suggestion, onApplySuggestion }: TypeSelectorProps) {
  return (
    <div className="space-y-2">
      <label className="text-sm font-medium text-foreground">Type *</label>
      
      {/* Suggestion banner */}
      {suggestion && !value && (
        <div className="flex items-center gap-2 p-2 bg-blue-500/10 border border-blue-500/20 rounded text-sm">
          <span>Suggested: <strong>{suggestion.suggested_type}</strong></span>
          <span className="text-muted-foreground">({suggestion.confidence} confidence)</span>
          <button
            type="button"
            onClick={onApplySuggestion}
            className="ml-auto text-blue-400 hover:text-blue-300"
          >
            Apply
          </button>
        </div>
      )}
      
      {/* Type dropdown */}
      <select
        value={value}
        onChange={(e) => onChange(e.target.value as CommitType)}
        className="w-full p-2 bg-background border border-border rounded focus:border-primary focus:outline-none"
      >
        <option value="">Select type...</option>
        {COMMIT_TYPES.map((type) => (
          <option key={type} value={type}>
            {TYPE_LABELS[type].emoji} {type} - {TYPE_LABELS[type].description}
          </option>
        ))}
      </select>
    </div>
  );
}
```

2. Create `src/components/commit/ScopeAutocomplete.tsx`:

```typescript
import { useState, useRef, useEffect } from 'react';
import type { ScopeSuggestion } from '../../stores/conventionalStore';

interface ScopeAutocompleteProps {
  value: string;
  onChange: (scope: string) => void;
  suggestions: ScopeSuggestion[];
  inferredScope: string | null;
  onApplySuggestion: (scope: string) => void;
}

export function ScopeAutocomplete({
  value,
  onChange,
  suggestions,
  inferredScope,
  onApplySuggestion,
}: ScopeAutocompleteProps) {
  const [isOpen, setIsOpen] = useState(false);
  const [highlightedIndex, setHighlightedIndex] = useState(-1);
  const inputRef = useRef<HTMLInputElement>(null);
  const listRef = useRef<HTMLUListElement>(null);
  
  // Filter suggestions based on input
  const filteredSuggestions = suggestions.filter(s =>
    s.scope.toLowerCase().includes(value.toLowerCase())
  );
  
  // Handle keyboard navigation
  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (!isOpen) {
      if (e.key === 'ArrowDown') {
        setIsOpen(true);
        setHighlightedIndex(0);
      }
      return;
    }
    
    switch (e.key) {
      case 'ArrowDown':
        e.preventDefault();
        setHighlightedIndex(i => Math.min(i + 1, filteredSuggestions.length - 1));
        break;
      case 'ArrowUp':
        e.preventDefault();
        setHighlightedIndex(i => Math.max(i - 1, 0));
        break;
      case 'Enter':
        e.preventDefault();
        if (highlightedIndex >= 0) {
          onApplySuggestion(filteredSuggestions[highlightedIndex].scope);
          setIsOpen(false);
        }
        break;
      case 'Escape':
        setIsOpen(false);
        break;
    }
  };
  
  // Close on click outside
  useEffect(() => {
    const handleClickOutside = (e: MouseEvent) => {
      if (!inputRef.current?.contains(e.target as Node) && 
          !listRef.current?.contains(e.target as Node)) {
        setIsOpen(false);
      }
    };
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);
  
  return (
    <div className="space-y-2 relative">
      <label className="text-sm font-medium text-foreground">Scope (optional)</label>
      
      {/* Inferred scope banner */}
      {inferredScope && !value && (
        <div className="flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/20 rounded text-sm">
          <span>Inferred from files: <strong>{inferredScope}</strong></span>
          <button
            type="button"
            onClick={() => onApplySuggestion(inferredScope)}
            className="ml-auto text-green-400 hover:text-green-300"
          >
            Apply
          </button>
        </div>
      )}
      
      <input
        ref={inputRef}
        type="text"
        value={value}
        onChange={(e) => {
          onChange(e.target.value);
          setIsOpen(true);
        }}
        onFocus={() => setIsOpen(true)}
        onKeyDown={handleKeyDown}
        placeholder="e.g., auth, api, ui"
        className="w-full p-2 bg-background border border-border rounded focus:border-primary focus:outline-none"
      />
      
      {/* Autocomplete dropdown */}
      {isOpen && filteredSuggestions.length > 0 && (
        <ul
          ref={listRef}
          className="absolute z-10 w-full mt-1 bg-background border border-border rounded shadow-lg max-h-48 overflow-y-auto"
        >
          {filteredSuggestions.map((s, i) => (
            <li
              key={s.scope}
              className={`px-3 py-2 cursor-pointer flex justify-between ${
                i === highlightedIndex ? 'bg-accent' : 'hover:bg-accent/50'
              }`}
              onClick={() => {
                onApplySuggestion(s.scope);
                setIsOpen(false);
              }}
            >
              <span>{s.scope}</span>
              <span className="text-muted-foreground text-sm">{s.usage_count} uses</span>
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}
```
  </action>
  <verify>
    - TypeScript compiles without errors
    - Components render correctly
  </verify>
  <done>TypeSelector and ScopeAutocomplete components created</done>
</task>

<task type="auto">
  <name>Task 2: Create BreakingChangeSection and ValidationErrors components</name>
  <files>src/components/commit/BreakingChangeSection.tsx, src/components/commit/ValidationErrors.tsx</files>
  <action>
1. Create `src/components/commit/BreakingChangeSection.tsx`:

```typescript
interface BreakingChangeSectionProps {
  isBreaking: boolean;
  onBreakingChange: (breaking: boolean) => void;
  description: string;
  onDescriptionChange: (desc: string) => void;
}

export function BreakingChangeSection({
  isBreaking,
  onBreakingChange,
  description,
  onDescriptionChange,
}: BreakingChangeSectionProps) {
  return (
    <div className="space-y-3">
      <label className="flex items-center gap-2 cursor-pointer">
        <input
          type="checkbox"
          checked={isBreaking}
          onChange={(e) => onBreakingChange(e.target.checked)}
          className="w-4 h-4 rounded border-border bg-background text-primary focus:ring-primary"
        />
        <span className="text-sm font-medium text-foreground">
          ‚ö†Ô∏è Breaking Change
        </span>
      </label>
      
      {isBreaking && (
        <div className="pl-6 space-y-2">
          <label className="text-sm text-muted-foreground">
            Describe the breaking change *
          </label>
          <textarea
            value={description}
            onChange={(e) => onDescriptionChange(e.target.value)}
            placeholder="What breaks and how to migrate..."
            rows={3}
            className="w-full p-2 bg-background border border-orange-500/30 rounded focus:border-orange-500 focus:outline-none resize-none"
          />
          <p className="text-xs text-muted-foreground">
            This will be added as a BREAKING CHANGE footer
          </p>
        </div>
      )}
    </div>
  );
}
```

2. Create `src/components/commit/ValidationErrors.tsx`:

```typescript
import type { ValidationResult } from '../../stores/conventionalStore';

interface ValidationErrorsProps {
  validation: ValidationResult | null;
  isValidating: boolean;
}

export function ValidationErrors({ validation, isValidating }: ValidationErrorsProps) {
  if (isValidating) {
    return (
      <div className="text-sm text-muted-foreground animate-pulse">
        Validating...
      </div>
    );
  }
  
  if (!validation) return null;
  
  return (
    <div className="space-y-2">
      {/* Errors */}
      {validation.errors.length > 0 && (
        <div className="space-y-1">
          {validation.errors.map((error, i) => (
            <div
              key={i}
              className="flex items-start gap-2 p-2 bg-red-500/10 border border-red-500/20 rounded text-sm"
            >
              <span className="text-red-400">‚úó</span>
              <div>
                <p className="text-red-400">{error.message}</p>
                {error.suggestion && (
                  <p className="text-muted-foreground mt-1">
                    üí° {error.suggestion}
                  </p>
                )}
              </div>
            </div>
          ))}
        </div>
      )}
      
      {/* Warnings */}
      {validation.warnings.length > 0 && (
        <div className="space-y-1">
          {validation.warnings.map((warning, i) => (
            <div
              key={i}
              className="flex items-start gap-2 p-2 bg-yellow-500/10 border border-yellow-500/20 rounded text-sm"
            >
              <span className="text-yellow-400">‚ö†</span>
              <p className="text-yellow-400">{warning.message}</p>
            </div>
          ))}
        </div>
      )}
      
      {/* Success */}
      {validation.is_valid && validation.errors.length === 0 && (
        <div className="flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/20 rounded text-sm">
          <span className="text-green-400">‚úì</span>
          <span className="text-green-400">Valid conventional commit</span>
        </div>
      )}
    </div>
  );
}
```
  </action>
  <verify>
    - TypeScript compiles without errors
    - Components render correctly
  </verify>
  <done>BreakingChangeSection and ValidationErrors components created</done>
</task>

<task type="auto">
  <name>Task 3: Create ConventionalCommitForm main component</name>
  <files>src/components/commit/ConventionalCommitForm.tsx</files>
  <action>
1. Create `src/components/commit/ConventionalCommitForm.tsx`:

```typescript
import { useConventionalCommit } from '../../hooks/useConventionalCommit';
import { TypeSelector } from './TypeSelector';
import { ScopeAutocomplete } from './ScopeAutocomplete';
import { BreakingChangeSection } from './BreakingChangeSection';
import { ValidationErrors } from './ValidationErrors';

interface ConventionalCommitFormProps {
  onCommit: (message: string) => void;
  onCancel?: () => void;
  disabled?: boolean;
}

export function ConventionalCommitForm({ onCommit, onCancel, disabled }: ConventionalCommitFormProps) {
  const {
    commitType,
    scope,
    description,
    body,
    isBreaking,
    breakingDescription,
    typeSuggestion,
    scopeSuggestions,
    inferredScope,
    validation,
    isValidating,
    canCommit,
    currentMessage,
    setCommitType,
    setScope,
    setDescription,
    setBody,
    setIsBreaking,
    setBreakingDescription,
    applyTypeSuggestion,
    applyScopeSuggestion,
    reset,
  } = useConventionalCommit();
  
  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (canCommit && !disabled) {
      onCommit(currentMessage);
      reset();
    }
  };
  
  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      {/* Type Selector */}
      <TypeSelector
        value={commitType}
        onChange={setCommitType}
        suggestion={typeSuggestion}
        onApplySuggestion={applyTypeSuggestion}
      />
      
      {/* Scope Autocomplete */}
      <ScopeAutocomplete
        value={scope}
        onChange={setScope}
        suggestions={scopeSuggestions}
        inferredScope={inferredScope}
        onApplySuggestion={applyScopeSuggestion}
      />
      
      {/* Description */}
      <div className="space-y-2">
        <label className="text-sm font-medium text-foreground">Description *</label>
        <input
          type="text"
          value={description}
          onChange={(e) => setDescription(e.target.value)}
          placeholder="Concise description of the change"
          maxLength={72}
          className="w-full p-2 bg-background border border-border rounded focus:border-primary focus:outline-none"
        />
        <div className="text-xs text-muted-foreground text-right">
          {description.length}/72
        </div>
      </div>
      
      {/* Body */}
      <div className="space-y-2">
        <label className="text-sm font-medium text-foreground">Body (optional)</label>
        <textarea
          value={body}
          onChange={(e) => setBody(e.target.value)}
          placeholder="Detailed description of the change..."
          rows={4}
          className="w-full p-2 bg-background border border-border rounded focus:border-primary focus:outline-none resize-none"
        />
      </div>
      
      {/* Breaking Change */}
      <BreakingChangeSection
        isBreaking={isBreaking}
        onBreakingChange={setIsBreaking}
        description={breakingDescription}
        onDescriptionChange={setBreakingDescription}
      />
      
      {/* Validation */}
      <ValidationErrors
        validation={validation}
        isValidating={isValidating}
      />
      
      {/* Preview */}
      {description && (
        <div className="space-y-2">
          <label className="text-sm font-medium text-muted-foreground">Preview</label>
          <pre className="p-3 bg-muted/30 border border-border rounded text-sm font-mono whitespace-pre-wrap">
            {currentMessage}
          </pre>
        </div>
      )}
      
      {/* Actions */}
      <div className="flex gap-2 pt-2">
        <button
          type="submit"
          disabled={!canCommit || disabled}
          className="flex-1 py-2 px-4 bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Commit
        </button>
        {onCancel && (
          <button
            type="button"
            onClick={onCancel}
            className="py-2 px-4 border border-border rounded hover:bg-accent"
          >
            Cancel
          </button>
        )}
      </div>
    </form>
  );
}
```

2. Create index file for exports:

```typescript
// src/components/commit/index.ts
export { ConventionalCommitForm } from './ConventionalCommitForm';
export { TypeSelector } from './TypeSelector';
export { ScopeAutocomplete } from './ScopeAutocomplete';
export { BreakingChangeSection } from './BreakingChangeSection';
export { ValidationErrors } from './ValidationErrors';
```
  </action>
  <verify>
    - TypeScript compiles without errors
    - Form renders all components
    - Commit button disabled until valid
  </verify>
  <done>ConventionalCommitForm integrates all components with validation</done>
</task>

</tasks>

<verification>
```bash
# Type check
npm run typecheck || pnpm typecheck

# Check component files exist
ls -la src/components/commit/*.tsx

# Build to verify no errors
npm run build || pnpm build
```
</verification>

<success_criteria>
- [ ] TypeSelector.tsx created with dropdown and suggestion banner
- [ ] ScopeAutocomplete.tsx created with keyboard navigation
- [ ] BreakingChangeSection.tsx created with conditional footer input
- [ ] ValidationErrors.tsx created with error/warning/success states
- [ ] ConventionalCommitForm.tsx integrates all components
- [ ] Form validates before enabling commit button
- [ ] Preview shows formatted message
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-conventional-commits/06-05-SUMMARY.md`
</output>
