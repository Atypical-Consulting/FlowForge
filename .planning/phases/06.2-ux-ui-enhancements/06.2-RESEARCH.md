# Phase 6.2: UX/UI Enhancements - Research

**Researched:** 2026-02-04
**Domain:** React UX/UI, Typography, Animations, Theming, Layout
**Confidence:** HIGH

## Summary

This phase elevates the FlowForge visual design through eight interconnected improvement areas: typography and brand identity, welcome view redesign, full Catppuccin Mocha color system integration, spatial layout enhancements, micro-interactions, commit form UX improvements, file tree enhancements, and topology view polish.

The existing codebase uses Tailwind CSS v4 with the `@tailwindcss/vite` plugin, React 19, @xyflow/react for topology visualization, and Zustand for state management. The current UI uses standard gray-* Tailwind colors rather than Catppuccin, presenting an opportunity to unify the color system established in Phase 6.1's file icons.

The recommended approach is to use the official `@catppuccin/tailwindcss` plugin (v1.0.0-beta.1 for Tailwind v4), Fontsource packages for JetBrains Mono and Geist fonts, `react-resizable-panels` for layout flexibility, `framer-motion` for animations, and `react-hotkeys-hook` for keyboard shortcuts.

**Primary recommendation:** Implement changes in layers - first typography and color system foundation, then spatial layout, then micro-interactions, finally feature-specific enhancements (commit form, file tree, topology).

## Standard Stack

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| @catppuccin/tailwindcss | 1.0.0-beta.1 | Full Catppuccin theme for Tailwind CSS v4 | Official plugin, supports v4, exposes all palette colors |
| @fontsource-variable/jetbrains-mono | latest | Monospace font for code/technical content | Variable font, lighter bundle, developer-focused |
| @fontsource-variable/geist | latest | Sans-serif font for UI text | Variable font, modern aesthetic, pairs well with JetBrains Mono |
| framer-motion | 12.x | Animation library for React | Industry standard, stagger support, layout animations |
| react-resizable-panels | 2.x | Resizable panel layouts | 2.7M weekly downloads, shadcn/ui compatible, accessibility support |
| react-hotkeys-hook | 4.x | Keyboard shortcuts | Active maintenance, scoped hotkeys, modern React support |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| react-arborist | latest | Virtual tree component | If file tree needs virtualization for large repos |
| @react-spring/web | latest | Physics-based animations | Alternative to framer-motion for specific use cases |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| framer-motion | Motion One | Smaller bundle but less React integration |
| framer-motion | CSS animations only | More manual work, no stagger orchestration |
| react-resizable-panels | custom CSS resize | Missing persistence, accessibility, constraints |
| @catppuccin/tailwindcss | manual CSS variables | More setup, no automatic class generation |

**Installation:**
```bash
npm install @catppuccin/tailwindcss@1.0.0-beta.1 @fontsource-variable/jetbrains-mono @fontsource-variable/geist framer-motion react-resizable-panels react-hotkeys-hook
```

## Architecture Patterns

### Recommended Project Structure
```
src/
├── index.css                    # Tailwind + Catppuccin imports, font imports, keyframes
├── lib/
│   ├── animations.ts            # Framer motion variants and stagger configs
│   └── hotkeys.ts               # Keyboard shortcut definitions
├── components/
│   ├── layout/
│   │   ├── ResizablePanelLayout.tsx  # Main app layout with panels
│   │   └── CollapsibleSidebar.tsx    # Sidebar with toggle
│   ├── welcome/
│   │   └── AnimatedGradientBg.tsx    # Gradient background component
│   ├── commit/
│   │   ├── VisualTypeSelector.tsx    # Icon-based type selector
│   │   └── CharacterProgress.tsx     # Progress bar counter
│   └── staging/
│       ├── FileTreeSearch.tsx        # Search/filter component
│       └── IndentGuides.tsx          # Tree indent visualization
```

### Pattern 1: Catppuccin Tailwind CSS v4 Integration
**What:** Configure Catppuccin plugin with Tailwind v4 CSS-first approach
**When to use:** Global styling setup
**Example:**
```css
/* src/index.css */
@import "tailwindcss";
@import "@catppuccin/tailwindcss/mocha.css";
@import "@fontsource-variable/jetbrains-mono";
@import "@fontsource-variable/geist";

@theme {
  --font-sans: "Geist Variable", system-ui, sans-serif;
  --font-mono: "JetBrains Mono Variable", ui-monospace, monospace;
  
  /* Custom animations */
  --animate-gradient: gradient-shift 8s ease infinite;
  --animate-stagger-fade: stagger-fade 0.3s ease-out;
}

@keyframes gradient-shift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

@keyframes stagger-fade {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}
```

### Pattern 2: Stagger Animation with Framer Motion
**What:** Animate list items with cascading delays
**When to use:** File lists, commit history, branch lists on load
**Example:**
```typescript
// src/lib/animations.ts
import { type Variants, stagger } from "framer-motion";

export const listContainerVariants: Variants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.05,
      delayChildren: 0.1,
    },
  },
};

export const listItemVariants: Variants = {
  hidden: { opacity: 0, y: 8 },
  visible: { 
    opacity: 1, 
    y: 0,
    transition: { duration: 0.2, ease: "easeOut" }
  },
};

// Usage in component:
// <motion.ul variants={listContainerVariants} initial="hidden" animate="visible">
//   {items.map(item => (
//     <motion.li key={item.id} variants={listItemVariants}>
//       {item.content}
//     </motion.li>
//   ))}
// </motion.ul>
```

### Pattern 3: Resizable Panel Layout
**What:** Three-panel layout with persistent sizing
**When to use:** Main RepositoryView layout
**Example:**
```typescript
// src/components/layout/ResizablePanelLayout.tsx
import { Panel, PanelGroup, PanelResizeHandle } from "react-resizable-panels";

export function ResizablePanelLayout() {
  return (
    <PanelGroup direction="horizontal" autoSaveId="main-layout">
      <Panel defaultSize={20} minSize={15} maxSize={35} collapsible>
        {/* Left sidebar */}
      </Panel>
      <PanelResizeHandle className="w-1 bg-ctp-surface0 hover:bg-ctp-blue transition-colors" />
      <Panel defaultSize={25} minSize={20}>
        {/* Middle panel */}
      </Panel>
      <PanelResizeHandle className="w-1 bg-ctp-surface0 hover:bg-ctp-blue transition-colors" />
      <Panel minSize={30}>
        {/* Right panel */}
      </Panel>
    </PanelGroup>
  );
}
```

### Pattern 4: Backdrop Blur Header
**What:** Sticky header with glass-morphism effect
**When to use:** Header component
**Example:**
```typescript
// Header with backdrop blur
<header className="sticky top-0 z-50 h-14 px-4 border-b border-ctp-surface0 
  bg-ctp-base/80 backdrop-blur-lg flex items-center justify-between">
  {/* Header content */}
</header>
```

### Pattern 5: Visual Type Selector (Commit Form)
**What:** Grid of icon buttons instead of dropdown
**When to use:** Commit type selection
**Example:**
```typescript
// src/components/commit/VisualTypeSelector.tsx
const typeIcons = {
  feat: { icon: Sparkles, color: "text-ctp-green", bg: "bg-ctp-green/10" },
  fix: { icon: Bug, color: "text-ctp-red", bg: "bg-ctp-red/10" },
  docs: { icon: FileText, color: "text-ctp-sapphire", bg: "bg-ctp-sapphire/10" },
  // ... more types
};

export function VisualTypeSelector({ value, onChange }) {
  return (
    <div className="grid grid-cols-4 gap-2">
      {COMMIT_TYPES.map((type) => {
        const { icon: Icon, color, bg } = typeIcons[type];
        const isSelected = value === type;
        return (
          <button
            key={type}
            onClick={() => onChange(type)}
            className={cn(
              "flex flex-col items-center gap-1 p-2 rounded-lg transition-all",
              isSelected ? `${bg} ring-2 ring-ctp-blue` : "hover:bg-ctp-surface0",
              color
            )}
          >
            <Icon className="w-5 h-5" />
            <span className="text-xs font-medium">{type}</span>
          </button>
        );
      })}
    </div>
  );
}
```

### Pattern 6: Character Counter Progress Bar
**What:** Visual progress indicator for commit message length
**When to use:** Commit form subject line
**Example:**
```typescript
// src/components/commit/CharacterProgress.tsx
export function CharacterProgress({ current, recommended = 50, max = 72 }) {
  const percentage = Math.min((current / max) * 100, 100);
  const color = current <= recommended 
    ? "bg-ctp-green" 
    : current <= max 
      ? "bg-ctp-yellow" 
      : "bg-ctp-red";
  
  return (
    <div className="relative h-1 bg-ctp-surface0 rounded-full overflow-hidden">
      <div 
        className={cn("absolute inset-y-0 left-0 transition-all duration-200", color)}
        style={{ width: `${percentage}%` }}
      />
      {/* Recommended marker at 50 chars */}
      <div 
        className="absolute top-0 bottom-0 w-px bg-ctp-overlay0"
        style={{ left: `${(recommended / max) * 100}%` }}
      />
    </div>
  );
}
```

### Pattern 7: Keyboard Shortcuts with react-hotkeys-hook
**What:** Scoped keyboard shortcuts for common actions
**When to use:** Commit form, file staging, navigation
**Example:**
```typescript
// src/hooks/useCommitFormHotkeys.ts
import { useHotkeys } from "react-hotkeys-hook";

export function useCommitFormHotkeys({ onCommit, onStageAll, canCommit }) {
  // Cmd/Ctrl + Enter to commit
  useHotkeys("mod+enter", onCommit, { 
    enabled: canCommit,
    enableOnFormTags: true 
  });
  
  // Cmd/Ctrl + Shift + A to stage all
  useHotkeys("mod+shift+a", onStageAll, { 
    enableOnFormTags: true 
  });
}
```

### Pattern 8: File Tree Indent Guides
**What:** Vertical lines showing hierarchy depth
**When to use:** FileTreeView component
**Example:**
```typescript
// Indent guides in tree node
function TreeNode({ depth, isLast, ...props }) {
  return (
    <div className="relative flex items-center">
      {/* Indent guides */}
      {Array.from({ length: depth }).map((_, i) => (
        <div
          key={i}
          className="absolute top-0 bottom-0 w-px bg-ctp-surface1"
          style={{ left: `${i * 16 + 8}px` }}
        />
      ))}
      {/* Node content */}
      <div style={{ paddingLeft: `${depth * 16}px` }}>
        {/* ... */}
      </div>
    </div>
  );
}
```

### Anti-Patterns to Avoid
- **Mixing Tailwind gray-* with Catppuccin colors:** Use only ctp-* colors for consistency
- **Over-animating:** Respect prefers-reduced-motion, keep animations subtle (200-300ms)
- **Blocking animations:** Never prevent user interaction during animation
- **Hardcoded panel sizes:** Always use react-resizable-panels with autoSaveId

## Don't Hand-Roll

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Panel resizing | Custom CSS/JS resize logic | react-resizable-panels | Accessibility, persistence, constraints |
| Stagger animations | Manual setTimeout delays | framer-motion staggerChildren | Declarative, handles cleanup, variants |
| Keyboard shortcuts | document.addEventListener | react-hotkeys-hook | Scoping, cleanup, modifier key handling |
| Theme colors | Custom CSS variables | @catppuccin/tailwindcss | Official plugin, all colors included |
| Font loading | Manual @font-face | @fontsource packages | Optimized, variable fonts, easy setup |
| Virtual lists | Intersection Observer DIY | react-virtuoso (already installed) | Already in project, proven |

**Key insight:** The existing codebase already has react-virtuoso for virtualization. Leverage it for any new scrollable lists (file tree search results, etc.).

## Common Pitfalls

### Pitfall 1: Catppuccin Color Migration Breaking UI
**What goes wrong:** Replacing all gray-* with ctp-* breaks contrast or readability
**Why it happens:** Direct 1:1 color replacement without considering semantic meaning
**How to avoid:** Map semantically - gray-950 -> ctp-base, gray-900 -> ctp-mantle, gray-800 -> ctp-surface0, etc.
**Warning signs:** Text unreadable, insufficient contrast, accessibility issues

### Pitfall 2: Animation Performance on Large Lists
**What goes wrong:** Stagger animations cause jank on 100+ item lists
**Why it happens:** Framer motion animating too many elements simultaneously
**How to avoid:** Use virtualization (react-virtuoso) with animations only on visible items; limit stagger to first 10-15 items
**Warning signs:** Frame drops, CPU spike when loading file lists

### Pitfall 3: Font Loading Flash (FOUT/FOIT)
**What goes wrong:** Text flickers or shows system font briefly
**Why it happens:** Variable fonts loading asynchronously
**How to avoid:** Use `font-display: swap` (Fontsource default), preload critical fonts, provide fallback stack
**Warning signs:** Layout shift when fonts load

### Pitfall 4: Panel Size Persistence Conflicts
**What goes wrong:** Panel sizes reset unexpectedly or conflict between views
**Why it happens:** Same autoSaveId used for different layout contexts
**How to avoid:** Use unique autoSaveId per layout context (e.g., "repo-layout", "welcome-layout")
**Warning signs:** Panel sizes changing when switching between views

### Pitfall 5: Backdrop Blur on Nested Elements
**What goes wrong:** Backdrop blur stops working when elements are nested
**Why it happens:** Browser backdrop-filter limitation with stacking contexts
**How to avoid:** Apply backdrop-blur to pseudo-element (::before) positioned behind content
**Warning signs:** Header appears solid instead of frosted glass effect

### Pitfall 6: Keyboard Shortcut Conflicts with Input Fields
**What goes wrong:** Shortcuts trigger while typing in inputs
**Why it happens:** Default react-hotkeys-hook behavior ignores form elements
**How to avoid:** Use `enableOnFormTags: true` only for form-specific shortcuts; use different shortcuts for global actions
**Warning signs:** Commit message typing triggers unintended actions

## Code Examples

### Complete Catppuccin Color Migration (index.css)
```css
/* src/index.css - Complete setup */
@import "tailwindcss";
@import "@catppuccin/tailwindcss/mocha.css";
@import "@fontsource-variable/jetbrains-mono";
@import "@fontsource-variable/geist";

@theme {
  /* Font families */
  --font-sans: "Geist Variable", system-ui, -apple-system, sans-serif;
  --font-mono: "JetBrains Mono Variable", ui-monospace, "SF Mono", monospace;
  
  /* Custom animations */
  --animate-gradient: gradient-shift 8s ease infinite;
  --animate-fade-in: fade-in 0.2s ease-out;
  --animate-slide-up: slide-up 0.2s ease-out;
}

@keyframes gradient-shift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slide-up {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* React Flow overrides with Catppuccin */
.react-flow__controls {
  background: var(--ctp-surface0);
  border: 1px solid var(--ctp-surface1);
}

.react-flow__controls-button {
  background: var(--ctp-surface0);
  border-bottom: 1px solid var(--ctp-surface1);
  fill: var(--ctp-subtext0);
}

.react-flow__controls-button:hover {
  background: var(--ctp-surface1);
  fill: var(--ctp-text);
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}
```

### Animated Welcome View Background
```typescript
// src/components/welcome/AnimatedGradientBg.tsx
import { motion } from "framer-motion";

export function AnimatedGradientBg() {
  return (
    <div className="absolute inset-0 overflow-hidden">
      <motion.div
        className="absolute inset-0 bg-gradient-to-br from-ctp-mauve/20 via-ctp-blue/20 to-ctp-sapphire/20 bg-[length:400%_400%] animate-gradient"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ duration: 1 }}
      />
      {/* Subtle noise overlay */}
      <div className="absolute inset-0 bg-ctp-crust/50 mix-blend-overlay" />
    </div>
  );
}
```

### Collapsible Sidebar Hook
```typescript
// src/hooks/useSidebar.ts
import { create } from "zustand";
import { persist } from "zustand/middleware";

interface SidebarStore {
  isCollapsed: boolean;
  toggle: () => void;
  setCollapsed: (collapsed: boolean) => void;
}

export const useSidebar = create<SidebarStore>()(
  persist(
    (set) => ({
      isCollapsed: false,
      toggle: () => set((s) => ({ isCollapsed: !s.isCollapsed })),
      setCollapsed: (isCollapsed) => set({ isCollapsed }),
    }),
    { name: "sidebar-state" }
  )
);
```

### React Flow Edge Animation
```typescript
// src/components/topology/AnimatedEdge.tsx
import { BaseEdge, type EdgeProps, getSmoothStepPath } from "@xyflow/react";

export function AnimatedEdge({
  sourceX, sourceY, targetX, targetY,
  sourcePosition, targetPosition,
  style = {},
  markerEnd,
}: EdgeProps) {
  const [edgePath] = getSmoothStepPath({
    sourceX, sourceY, targetX, targetY,
    sourcePosition, targetPosition,
  });

  return (
    <>
      <BaseEdge path={edgePath} markerEnd={markerEnd} style={style} />
      <circle r="3" fill="var(--ctp-blue)">
        <animateMotion dur="2s" repeatCount="indefinite" path={edgePath} />
      </circle>
    </>
  );
}
```

## Catppuccin Mocha Color Mapping Reference

| UI Element | Current | Catppuccin Replacement |
|------------|---------|------------------------|
| Base background | gray-950 (#030712) | ctp-base (#1e1e2e) |
| Secondary bg | gray-900 (#111827) | ctp-mantle (#181825) |
| Borders | gray-800 (#1f2937) | ctp-surface0 (#313244) |
| Subtle borders | gray-700 (#374151) | ctp-surface1 (#45475a) |
| Primary text | white (#ffffff) | ctp-text (#cdd6f4) |
| Secondary text | gray-400 (#9ca3af) | ctp-subtext0 (#a6adc8) |
| Muted text | gray-500 (#6b7280) | ctp-overlay0 (#6c7086) |
| Primary accent | blue-500 (#3b82f6) | ctp-blue (#89b4fa) |
| Success | green-500 (#22c55e) | ctp-green (#a6e3a1) |
| Warning | yellow-500 (#eab308) | ctp-yellow (#f9e2af) |
| Error | red-500 (#ef4444) | ctp-red (#f38ba8) |
| Hover states | gray-800/50 | ctp-surface0/50 |

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| Tailwind config.js | Tailwind CSS v4 @theme | 2024 | CSS-first, faster builds |
| Static fonts | Variable fonts | 2023+ | Smaller bundles, flexibility |
| CSS-only animations | Framer motion variants | 2022+ | Declarative, orchestration |
| Fixed layouts | Resizable panels | 2023+ | User preference, persistence |
| Manual keyboard handling | react-hotkeys-hook | 2022+ | Safer, scoped, accessible |

**Deprecated/outdated:**
- `tailwind.config.js` for Tailwind v4 (use CSS @theme)
- Static font weights (use variable fonts)
- `react-spring` for simple animations (framer-motion is more comprehensive)

## Open Questions

1. **Animation intensity preference:**
   - What we know: Some users prefer minimal animations
   - What's unclear: Should we expose animation toggle in settings?
   - Recommendation: Respect prefers-reduced-motion; optionally add "Reduce animations" toggle

2. **Sidebar collapse behavior:**
   - What we know: Need collapsible sidebar
   - What's unclear: Icon-only mode vs complete hide?
   - Recommendation: Icon-only mode (common in IDEs like VSCode)

3. **Topology edge animation scope:**
   - What we know: Can animate paths with SVG animateMotion
   - What's unclear: Animate all edges or only selected/active?
   - Recommendation: Animate only on hover/selection for performance

4. **File tree virtualization threshold:**
   - What we know: react-virtuoso already in project
   - What's unclear: At what file count should virtualization kick in?
   - Recommendation: Always virtualize (performance cost is low, benefit is high)

## Sources

### Primary (HIGH confidence)
- [Catppuccin Tailwind CSS Plugin](https://github.com/catppuccin/tailwindcss) - Official integration
- [Catppuccin Palette](https://catppuccin.com/palette/) - Official color values
- [Fontsource JetBrains Mono](https://fontsource.org/fonts/jetbrains-mono/install) - Font installation
- [Fontsource Geist](https://fontsource.org/fonts/geist/install) - Font installation
- [react-resizable-panels](https://github.com/bvaughn/react-resizable-panels) - Official repo
- [Framer Motion stagger](https://www.framer.com/motion/stagger/) - Official docs
- [react-hotkeys-hook](https://github.com/JohannesKlauss/react-hotkeys-hook) - Official repo
- [React Flow Animating Edges](https://reactflow.dev/examples/edges/animating-edges) - Official example

### Secondary (MEDIUM confidence)
- [Tailwind CSS backdrop-blur](https://tailwindcss.com/docs/backdrop-blur) - Official docs
- [HyperUI Animated Border Gradient](https://www.hyperui.dev/blog/animated-border-gradient-with-tailwindcss/) - Pattern reference
- [Framer Motion vs Motion One](https://reactlibraries.com/blog/framer-motion-vs-motion-one-mobile-animation-performance-in-2025) - Comparison

### Tertiary (LOW confidence)
- [react-arborist](https://github.com/brimdata/react-arborist) - Tree component option
- [DronaHQ React Animation Libraries](https://www.dronahq.com/react-animation-libraries/) - Overview

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - Official documentation verified for all libraries
- Architecture: HIGH - Patterns based on official docs and existing codebase analysis
- Pitfalls: MEDIUM - Based on general React/animation best practices and documented issues
- Color migration: HIGH - Official Catppuccin palette with exact hex values

**Research date:** 2026-02-04
**Valid until:** 2026-03-04 (stable libraries, 30 days)
