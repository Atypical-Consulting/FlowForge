---
phase: 06.2-ux-ui-enhancements
plan: 07
type: execute
wave: 4
depends_on: ["06.2-02", "06.2-04"]
files_modified:
  - src/components/commit/TypeSelector.tsx
  - src/components/commit/ConventionalCommitForm.tsx
  - src/components/commit/CharacterProgress.tsx
  - src/components/ui/Toast.tsx
  - src/hooks/useKeyboardShortcuts.ts
autonomous: true

must_haves:
  truths:
    - "Type selector displays as visual icon grid instead of dropdown"
    - "Character counter shows as progress bar with color feedback"
    - "Commit form uses Catppuccin colors consistently"
    - "Success toast appears after successful commit"
    - "Ctrl+Enter submits commit form, Esc clears form"
  artifacts:
    - path: "src/components/commit/TypeSelector.tsx"
      provides: "Visual icon-based type selector"
      contains: "grid"
    - path: "src/components/commit/CharacterProgress.tsx"
      provides: "Progress bar character counter"
      exports: ["CharacterProgress"]
  key_links:
    - from: "src/components/commit/ConventionalCommitForm.tsx"
      to: "src/components/commit/CharacterProgress.tsx"
      via: "component import"
      pattern: "CharacterProgress"
    - from: "src/components/commit/ConventionalCommitForm.tsx"
      to: "src/components/ui/Toast.tsx"
      via: "component import"
      pattern: "Toast"
    - from: "src/components/commit/ConventionalCommitForm.tsx"
      to: "src/hooks/useKeyboardShortcuts.ts"
      via: "hook import"
      pattern: "useKeyboardShortcuts"
---

<objective>
Enhance the commit form with visual type selector, character progress bar, and improved Catppuccin styling.

Purpose: Make committing more intuitive and visually engaging with better feedback.
Output: Redesigned commit form with icon-based type selector and progress bar counter.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.2-ux-ui-enhancements/06.2-RESEARCH.md
@.planning/phases/06.2-ux-ui-enhancements/06.2-02-SUMMARY.md
@.planning/phases/06.2-ux-ui-enhancements/06.2-04-SUMMARY.md
@src/components/commit/TypeSelector.tsx
@src/components/commit/ConventionalCommitForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CharacterProgress component</name>
  <files>src/components/commit/CharacterProgress.tsx</files>
  <action>
Create a visual progress bar for character count.

```tsx
import { motion } from "framer-motion";
import { cn } from "../../lib/utils";

interface CharacterProgressProps {
  current: number;
  max: number;
  warningThreshold?: number;
}

export function CharacterProgress({
  current,
  max,
  warningThreshold = 10,
}: CharacterProgressProps) {
  const remaining = max - current;
  const percentage = Math.min((current / max) * 100, 100);
  const isOverLimit = remaining < 0;
  const isWarning = remaining >= 0 && remaining <= warningThreshold;

  const getColor = () => {
    if (isOverLimit) return "bg-ctp-red";
    if (isWarning) return "bg-ctp-yellow";
    return "bg-ctp-green";
  };

  const getTextColor = () => {
    if (isOverLimit) return "text-ctp-red";
    if (isWarning) return "text-ctp-yellow";
    return "text-ctp-subtext0";
  };

  return (
    <div className="flex items-center gap-2">
      <div className="flex-1 h-1 bg-ctp-surface0 rounded-full overflow-hidden">
        <motion.div
          className={cn("h-full rounded-full", getColor())}
          initial={{ width: 0 }}
          animate={{ width: `${percentage}%` }}
          transition={{ type: "spring", stiffness: 300, damping: 30 }}
        />
      </div>
      <span className={cn("text-xs font-mono tabular-nums min-w-[3rem] text-right", getTextColor())}>
        {remaining}
      </span>
    </div>
  );
}
```
  </action>
  <verify>
File exists: src/components/commit/CharacterProgress.tsx
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>CharacterProgress component created with animated progress bar and color feedback.</done>
</task>

<task type="auto">
  <name>Task 2: Redesign TypeSelector with icon grid</name>
  <files>src/components/commit/TypeSelector.tsx</files>
  <action>
Replace the dropdown with a visual icon grid.

```tsx
import { motion } from "framer-motion";
import {
  Bug,
  FileText,
  Hammer,
  Package,
  Paintbrush,
  Rocket,
  Settings,
  Sparkles,
  TestTube,
  Undo,
  Zap,
} from "lucide-react";
import type { TypeSuggestion } from "../../bindings";
import { cn } from "../../lib/utils";
import {
  COMMIT_TYPES,
  COMMIT_TYPE_LABELS,
  type CommitType,
} from "../../stores/conventional";

const TYPE_ICONS: Record<CommitType, React.ElementType> = {
  feat: Sparkles,
  fix: Bug,
  docs: FileText,
  style: Paintbrush,
  refactor: Hammer,
  perf: Zap,
  test: TestTube,
  chore: Settings,
  ci: Rocket,
  build: Package,
  revert: Undo,
};

const TYPE_COLORS: Record<CommitType, string> = {
  feat: "text-ctp-green bg-ctp-green/10 border-ctp-green/30 hover:bg-ctp-green/20",
  fix: "text-ctp-red bg-ctp-red/10 border-ctp-red/30 hover:bg-ctp-red/20",
  docs: "text-ctp-blue bg-ctp-blue/10 border-ctp-blue/30 hover:bg-ctp-blue/20",
  style: "text-ctp-pink bg-ctp-pink/10 border-ctp-pink/30 hover:bg-ctp-pink/20",
  refactor: "text-ctp-peach bg-ctp-peach/10 border-ctp-peach/30 hover:bg-ctp-peach/20",
  perf: "text-ctp-yellow bg-ctp-yellow/10 border-ctp-yellow/30 hover:bg-ctp-yellow/20",
  test: "text-ctp-teal bg-ctp-teal/10 border-ctp-teal/30 hover:bg-ctp-teal/20",
  chore: "text-ctp-lavender bg-ctp-lavender/10 border-ctp-lavender/30 hover:bg-ctp-lavender/20",
  ci: "text-ctp-sky bg-ctp-sky/10 border-ctp-sky/30 hover:bg-ctp-sky/20",
  build: "text-ctp-maroon bg-ctp-maroon/10 border-ctp-maroon/30 hover:bg-ctp-maroon/20",
  revert: "text-ctp-mauve bg-ctp-mauve/10 border-ctp-mauve/30 hover:bg-ctp-mauve/20",
};

interface TypeSelectorProps {
  value: CommitType | "";
  onChange: (type: CommitType) => void;
  suggestion: TypeSuggestion | null;
  onApplySuggestion: () => void;
}

export function TypeSelector({
  value,
  onChange,
  suggestion,
  onApplySuggestion,
}: TypeSelectorProps) {
  return (
    <div className="space-y-2">
      <label className="text-sm font-medium text-ctp-subtext1">Type *</label>

      {/* Suggestion banner */}
      {suggestion && !value && (
        <motion.div 
          initial={{ opacity: 0, y: -10 }}
          animate={{ opacity: 1, y: 0 }}
          className="flex items-center gap-2 p-2 bg-ctp-blue/10 border border-ctp-blue/20 rounded text-sm"
        >
          <span className="text-ctp-subtext1">
            Suggested:{" "}
            <strong className="text-ctp-blue">
              {suggestion.suggestedType}
            </strong>
          </span>
          <span className="text-ctp-overlay0">
            ({suggestion.confidence})
          </span>
          <button
            type="button"
            onClick={onApplySuggestion}
            className="ml-auto text-ctp-blue hover:text-ctp-sapphire text-sm font-medium"
          >
            Apply
          </button>
        </motion.div>
      )}

      {/* Type grid */}
      <div className="grid grid-cols-4 gap-2">
        {COMMIT_TYPES.map((type) => {
          const Icon = TYPE_ICONS[type];
          const isSelected = value === type;
          return (
            <motion.button
              key={type}
              type="button"
              onClick={() => onChange(type)}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              className={cn(
                "flex flex-col items-center gap-1 p-2 rounded-lg border transition-colors",
                isSelected
                  ? TYPE_COLORS[type]
                  : "border-ctp-surface1 text-ctp-subtext0 hover:border-ctp-surface2 hover:text-ctp-subtext1",
                isSelected && "ring-1 ring-offset-1 ring-offset-ctp-base"
              )}
              style={isSelected ? { ringColor: `var(--ctp-${type === 'feat' ? 'green' : type === 'fix' ? 'red' : 'blue'})` } : undefined}
            >
              <Icon className="w-5 h-5" />
              <span className="text-xs font-medium">{type}</span>
            </motion.button>
          );
        })}
      </div>
    </div>
  );
}
```
  </action>
  <verify>
1. Run `npm run tauri dev`
2. Open a repository with staged files
3. TypeSelector displays as icon grid
4. Clicking a type selects it with colored highlight
5. Suggestion banner appears when applicable
  </verify>
  <done>TypeSelector redesigned with visual icon grid and Catppuccin colors.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate CharacterProgress into ConventionalCommitForm</name>
  <files>src/components/commit/ConventionalCommitForm.tsx</files>
  <action>
Update ConventionalCommitForm to use CharacterProgress and Catppuccin colors.

1. Import CharacterProgress:
```tsx
import { CharacterProgress } from "./CharacterProgress";
```

2. Replace the character counter span with CharacterProgress:
```tsx
{/* Description input */}
<div className="space-y-2">
  <div className="flex justify-between items-center">
    <label className="text-sm font-medium text-ctp-subtext1">
      Description *
    </label>
  </div>
  <input
    type="text"
    value={description}
    onChange={(e) => setDescription(e.target.value)}
    placeholder="A brief description of the change"
    className={cn(
      "w-full px-3 py-2 text-sm bg-ctp-surface0 border rounded",
      "text-ctp-text placeholder:text-ctp-overlay0",
      "focus:outline-none focus:ring-1",
      isDescriptionOverLimit
        ? "border-ctp-red focus:border-ctp-red focus:ring-ctp-red"
        : "border-ctp-surface1 focus:border-ctp-blue focus:ring-ctp-blue",
    )}
  />
  <CharacterProgress 
    current={description.length} 
    max={MAX_DESCRIPTION_LENGTH} 
    warningThreshold={10}
  />
</div>
```

3. Update all other color classes:
- text-gray-300 -> text-ctp-subtext1
- text-gray-500 -> text-ctp-overlay0
- bg-gray-800 -> bg-ctp-surface0
- border-gray-700 -> border-ctp-surface1
- focus:border-blue-500 -> focus:border-ctp-blue
- focus:ring-blue-500 -> focus:ring-ctp-blue
- bg-gray-900 -> bg-ctp-mantle
- text-gray-300 (preview) -> text-ctp-subtext1
- bg-gray-700 -> bg-ctp-surface1
- hover:bg-gray-600 -> hover:bg-ctp-surface0
- bg-blue-600 -> bg-ctp-blue
- hover:bg-blue-500 -> hover:bg-ctp-sapphire
  </action>
  <verify>
1. Run `npm run tauri dev`
2. Stage some files and view the commit form
3. Description field has progress bar below it
4. Progress bar animates as you type
5. Bar turns yellow near limit, red when exceeded
6. All form elements use Catppuccin colors
  </verify>
  <done>ConventionalCommitForm uses CharacterProgress and Catppuccin styling throughout.</done>
</task>

<task type="auto">
  <name>Task 4: Add Toast component and keyboard shortcuts</name>
  <files>src/components/ui/Toast.tsx, src/hooks/useKeyboardShortcuts.ts, src/components/commit/ConventionalCommitForm.tsx</files>
  <action>
Create success feedback toast and keyboard shortcuts for commit form.

**src/components/ui/Toast.tsx:**
```tsx
import { motion, AnimatePresence } from "framer-motion";
import { CheckCircle, X } from "lucide-react";
import { useEffect } from "react";
import { cn } from "../../lib/utils";

interface ToastProps {
  message: string;
  type?: "success" | "error" | "info";
  isVisible: boolean;
  onClose: () => void;
  duration?: number;
}

export function Toast({
  message,
  type = "success",
  isVisible,
  onClose,
  duration = 3000,
}: ToastProps) {
  useEffect(() => {
    if (isVisible && duration > 0) {
      const timer = setTimeout(onClose, duration);
      return () => clearTimeout(timer);
    }
  }, [isVisible, duration, onClose]);

  const typeStyles = {
    success: "bg-ctp-green/10 border-ctp-green/30 text-ctp-green",
    error: "bg-ctp-red/10 border-ctp-red/30 text-ctp-red",
    info: "bg-ctp-blue/10 border-ctp-blue/30 text-ctp-blue",
  };

  return (
    <AnimatePresence>
      {isVisible && (
        <motion.div
          initial={{ opacity: 0, y: 50, scale: 0.9 }}
          animate={{ opacity: 1, y: 0, scale: 1 }}
          exit={{ opacity: 0, y: 20, scale: 0.9 }}
          transition={{ type: "spring", stiffness: 400, damping: 25 }}
          className={cn(
            "fixed bottom-4 right-4 z-50",
            "flex items-center gap-3 px-4 py-3 rounded-lg border",
            "shadow-lg backdrop-blur-sm",
            typeStyles[type]
          )}
        >
          <CheckCircle className="w-5 h-5" />
          <span className="text-sm font-medium">{message}</span>
          <button
            type="button"
            onClick={onClose}
            className="p-1 hover:bg-ctp-surface0 rounded"
          >
            <X className="w-4 h-4" />
          </button>
        </motion.div>
      )}
    </AnimatePresence>
  );
}
```

**src/hooks/useKeyboardShortcuts.ts:**
```tsx
import { useEffect, useCallback } from "react";

interface ShortcutConfig {
  key: string;
  ctrl?: boolean;
  shift?: boolean;
  handler: () => void;
}

export function useKeyboardShortcuts(shortcuts: ShortcutConfig[]) {
  const handleKeyDown = useCallback(
    (event: KeyboardEvent) => {
      for (const shortcut of shortcuts) {
        const ctrlMatch = shortcut.ctrl ? event.ctrlKey || event.metaKey : !event.ctrlKey && !event.metaKey;
        const shiftMatch = shortcut.shift ? event.shiftKey : !event.shiftKey;
        const keyMatch = event.key.toLowerCase() === shortcut.key.toLowerCase();

        if (ctrlMatch && shiftMatch && keyMatch) {
          event.preventDefault();
          shortcut.handler();
          return;
        }
      }
    },
    [shortcuts]
  );

  useEffect(() => {
    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [handleKeyDown]);
}
```

**Update ConventionalCommitForm.tsx:**
```tsx
import { useState } from "react";
import { Toast } from "../ui/Toast";
import { useKeyboardShortcuts } from "../../hooks/useKeyboardShortcuts";

// Inside the component:
const [showToast, setShowToast] = useState(false);
const [toastMessage, setToastMessage] = useState("");

// Add keyboard shortcuts
useKeyboardShortcuts([
  {
    key: "Enter",
    ctrl: true,
    handler: () => {
      if (canSubmit) {
        handleCommit();
      }
    },
  },
  {
    key: "Escape",
    handler: () => {
      setType("");
      setScope("");
      setDescription("");
      setBody("");
      setBreakingChange(false);
    },
  },
]);

// Update handleCommit to show toast:
const handleCommit = async () => {
  // ... existing commit logic
  try {
    await commitChanges(message);
    setToastMessage("Commit created successfully!");
    setShowToast(true);
    // Clear form
    setType("");
    setScope("");
    setDescription("");
    setBody("");
    setBreakingChange(false);
  } catch (error) {
    // ... error handling
  }
};

// Add Toast at end of return:
return (
  <div>
    {/* ... existing form content */}
    <Toast
      message={toastMessage}
      type="success"
      isVisible={showToast}
      onClose={() => setShowToast(false)}
    />
  </div>
);
```
  </action>
  <verify>
1. Run `npm run tauri dev`
2. Stage files and fill out commit form
3. Press Ctrl+Enter (or Cmd+Enter on Mac) - form submits
4. Success toast appears in bottom-right corner
5. Toast auto-dismisses after 3 seconds
6. Press Escape - form fields are cleared
7. Toast has Catppuccin green styling
  </verify>
  <done>Toast component and keyboard shortcuts (Ctrl+Enter submit, Esc clear) integrated into commit form.</done>
</task>

</tasks>

<verification>
1. `npm run tauri dev` - app launches without errors
2. Type selector displays as icon grid with colored selection states
3. Character progress bar animates smoothly
4. Progress bar changes color based on remaining characters
5. All commit form elements use Catppuccin colors
6. Build succeeds: `npm run build`
</verification>

<success_criteria>
- TypeSelector is a visual icon grid instead of dropdown
- CharacterProgress shows animated progress bar
- Color feedback (green/yellow/red) for character count
- All commit form elements use Catppuccin colors
</success_criteria>

<output>
After completion, create `.planning/phases/06.2-ux-ui-enhancements/06.2-07-SUMMARY.md`
</output>
