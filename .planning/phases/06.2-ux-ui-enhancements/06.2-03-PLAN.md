---
phase: 06.2-ux-ui-enhancements
plan: 03
type: execute
wave: 2
depends_on: ["06.2-02"]
files_modified:
  - package.json
  - src/components/RepositoryView.tsx
  - src/components/layout/ResizablePanelLayout.tsx
  - src/components/layout/CollapsibleSidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can drag panel borders to resize sidebar and middle panel"
    - "Panel sizes persist across sessions (stored in localStorage)"
    - "Panels have sensible min/max constraints preventing unusable sizes"
    - "User can collapse/expand sidebar with toggle button"
    - "Sidebar collapsed state persists in localStorage"
  artifacts:
    - path: "src/components/layout/ResizablePanelLayout.tsx"
      provides: "Reusable resizable panel wrapper"
      exports: ["ResizablePanelLayout"]
    - path: "src/components/layout/CollapsibleSidebar.tsx"
      provides: "Sidebar with collapse toggle"
      exports: ["CollapsibleSidebar"]
    - path: "src/components/RepositoryView.tsx"
      provides: "Repository view with resizable panels"
      contains: "PanelGroup"
  key_links:
    - from: "src/components/RepositoryView.tsx"
      to: "react-resizable-panels"
      via: "PanelGroup, Panel, PanelResizeHandle imports"
      pattern: "import.*react-resizable-panels"
    - from: "src/components/RepositoryView.tsx"
      to: "src/components/layout/CollapsibleSidebar.tsx"
      via: "CollapsibleSidebar import"
      pattern: "CollapsibleSidebar"
---

<objective>
Implement resizable panel layout for the repository view, allowing users to customize sidebar and panel widths.

Purpose: Give users control over their workspace layout, improving productivity for different workflows.
Output: Repository view with draggable panel borders and persisted sizes.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.2-ux-ui-enhancements/06.2-RESEARCH.md
@.planning/phases/06.2-ux-ui-enhancements/06.2-02-SUMMARY.md
@src/components/RepositoryView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-resizable-panels and create wrapper component</name>
  <files>package.json, src/components/layout/ResizablePanelLayout.tsx</files>
  <action>
1. Install the library:
```bash
npm install react-resizable-panels
```

2. Create src/components/layout/ResizablePanelLayout.tsx:
```tsx
import { PanelGroup, Panel, PanelResizeHandle } from "react-resizable-panels";
import type { ReactNode } from "react";
import { cn } from "../../lib/utils";

interface ResizablePanelLayoutProps {
  autoSaveId: string;
  direction?: "horizontal" | "vertical";
  children: ReactNode;
}

export function ResizablePanelLayout({
  autoSaveId,
  direction = "horizontal",
  children,
}: ResizablePanelLayoutProps) {
  return (
    <PanelGroup
      autoSaveId={autoSaveId}
      direction={direction}
      className="h-full"
    >
      {children}
    </PanelGroup>
  );
}

interface ResizablePanelProps {
  defaultSize?: number;
  minSize?: number;
  maxSize?: number;
  children: ReactNode;
  className?: string;
}

export function ResizablePanel({
  defaultSize,
  minSize = 10,
  maxSize,
  children,
  className,
}: ResizablePanelProps) {
  return (
    <Panel
      defaultSize={defaultSize}
      minSize={minSize}
      maxSize={maxSize}
      className={cn("overflow-hidden", className)}
    >
      {children}
    </Panel>
  );
}

export function ResizeHandle({ className }: { className?: string }) {
  return (
    <PanelResizeHandle
      className={cn(
        "w-1 bg-ctp-surface0 hover:bg-ctp-blue transition-colors cursor-col-resize",
        "data-[resize-handle-active]:bg-ctp-blue",
        className
      )}
    />
  );
}
```

3. Create src/components/layout/index.ts:
```tsx
export { ResizablePanelLayout, ResizablePanel, ResizeHandle } from "./ResizablePanelLayout";
```
  </action>
  <verify>
Files exist:
- src/components/layout/ResizablePanelLayout.tsx
- src/components/layout/index.ts
  </verify>
  <done>Resizable panel wrapper components created with Catppuccin-styled resize handle.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate resizable panels into RepositoryView</name>
  <files>src/components/RepositoryView.tsx</files>
  <action>
Refactor RepositoryView to use resizable panels.

Replace the current hardcoded width divs with Panel components:

```tsx
import { ResizablePanelLayout, ResizablePanel, ResizeHandle } from "./layout";

// In the return statement, replace the current flex layout:

return (
  <ResizablePanelLayout autoSaveId="repo-layout" direction="horizontal">
    {/* Left sidebar - Branches, Stash, Tags */}
    <ResizablePanel defaultSize={20} minSize={15} maxSize={30}>
      <div className="h-full border-r border-ctp-surface0 bg-ctp-base overflow-y-auto">
        {/* ... existing sidebar content (details elements for branches, stash, tags, gitflow) */}
      </div>
    </ResizablePanel>
    
    <ResizeHandle />
    
    {/* Middle panel - Changes/History */}
    <ResizablePanel defaultSize={25} minSize={20} maxSize={40}>
      <div className="h-full border-r border-ctp-surface0 bg-ctp-base overflow-hidden flex flex-col">
        {/* ... existing tabs and tab content */}
      </div>
    </ResizablePanel>
    
    <ResizeHandle />
    
    {/* Right panel - Diff/Commit Details/Topology */}
    <ResizablePanel defaultSize={55}>
      <div className="h-full bg-ctp-mantle">
        {/* ... existing right panel content */}
      </div>
    </ResizablePanel>
  </ResizablePanelLayout>
);
```

Remove the fixed `w-64` and `w-80` classes from sidebar and middle panel.
Update border and bg colors to use Catppuccin (border-ctp-surface0, bg-ctp-base, bg-ctp-mantle).

Keep all the existing state and event handlers unchanged.
  </action>
  <verify>
1. Run `npm run tauri dev`
2. Open a repository
3. Drag the border between sidebar and middle panel - both should resize
4. Drag the border between middle and right panel - both should resize
5. Refresh the page - panel sizes should persist
6. Resize to extremes - min/max constraints should prevent unusable sizes
  </verify>
  <done>RepositoryView has resizable panels with persisted sizes.</done>
</task>

<task type="auto">
  <name>Task 3: Create CollapsibleSidebar component</name>
  <files>src/components/layout/CollapsibleSidebar.tsx, src/components/layout/index.ts</files>
  <action>
Create a sidebar wrapper component with collapse/expand toggle.

**src/components/layout/CollapsibleSidebar.tsx:**
```tsx
import { motion, AnimatePresence } from "framer-motion";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { type ReactNode, useState, useEffect } from "react";
import { cn } from "../../lib/utils";

interface CollapsibleSidebarProps {
  children: ReactNode;
  defaultCollapsed?: boolean;
  storageKey?: string;
}

export function CollapsibleSidebar({
  children,
  defaultCollapsed = false,
  storageKey = "sidebar-collapsed",
}: CollapsibleSidebarProps) {
  const [collapsed, setCollapsed] = useState(() => {
    const stored = localStorage.getItem(storageKey);
    return stored ? JSON.parse(stored) : defaultCollapsed;
  });

  useEffect(() => {
    localStorage.setItem(storageKey, JSON.stringify(collapsed));
  }, [collapsed, storageKey]);

  return (
    <div className="relative h-full flex">
      <AnimatePresence initial={false}>
        {!collapsed && (
          <motion.div
            initial={{ width: 0, opacity: 0 }}
            animate={{ width: "auto", opacity: 1 }}
            exit={{ width: 0, opacity: 0 }}
            transition={{ duration: 0.2, ease: "easeInOut" }}
            className="h-full overflow-hidden"
          >
            {children}
          </motion.div>
        )}
      </AnimatePresence>

      <button
        type="button"
        onClick={() => setCollapsed(!collapsed)}
        className={cn(
          "absolute top-2 -right-3 z-10",
          "w-6 h-6 rounded-full",
          "bg-ctp-surface0 border border-ctp-surface1",
          "flex items-center justify-center",
          "text-ctp-subtext0 hover:text-ctp-text",
          "hover:bg-ctp-surface1 transition-colors",
          "shadow-md"
        )}
        title={collapsed ? "Expand sidebar" : "Collapse sidebar"}
      >
        {collapsed ? (
          <ChevronRight className="w-4 h-4" />
        ) : (
          <ChevronLeft className="w-4 h-4" />
        )}
      </button>
    </div>
  );
}
```

**Update src/components/layout/index.ts:**
```tsx
export { ResizablePanelLayout, ResizablePanel, ResizeHandle } from "./ResizablePanelLayout";
export { CollapsibleSidebar } from "./CollapsibleSidebar";
```

**Update RepositoryView.tsx to wrap left sidebar:**
```tsx
import { CollapsibleSidebar } from "./layout";

// Wrap the left sidebar panel content:
<ResizablePanel defaultSize={20} minSize={15} maxSize={30}>
  <CollapsibleSidebar storageKey="repo-sidebar-collapsed">
    <div className="h-full border-r border-ctp-surface0 bg-ctp-base overflow-y-auto">
      {/* ... existing sidebar content */}
    </div>
  </CollapsibleSidebar>
</ResizablePanel>
```
  </action>
  <verify>
1. Run `npm run tauri dev`
2. Click the collapse button on the sidebar edge
3. Sidebar collapses with smooth animation
4. Click expand button - sidebar expands back
5. Refresh page - collapsed state persists
6. Check localStorage for "repo-sidebar-collapsed" key
  </verify>
  <done>CollapsibleSidebar created with animated collapse/expand and localStorage persistence.</done>
</task>

</tasks>

<verification>
1. `npm run tauri dev` - app launches without errors
2. Panel resize handles visible as subtle 1px borders
3. Dragging resize handles smoothly resizes panels
4. Panel sizes persist across page refresh (check localStorage for "repo-layout")
5. Min/max constraints prevent panels from being too small or too large
6. Build succeeds: `npm run build`
</verification>

<success_criteria>
- Resizable panels working in RepositoryView
- Panel sizes persist across sessions
- Resize handles styled with Catppuccin colors
- No layout issues at extreme panel sizes
</success_criteria>

<output>
After completion, create `.planning/phases/06.2-ux-ui-enhancements/06.2-03-SUMMARY.md`
</output>
