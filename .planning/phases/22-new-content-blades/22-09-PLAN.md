---
phase: 22
plan: 22-09
title: Gitflow Cheatsheet Blade — SVG Diagram, "You Are Here" Indicator, Action Cards, Branch Reference
wave: 3
depends_on: [22-02, 22-03]
files_modified:
  - src/components/blades/GitflowCheatsheetBlade.tsx
  - src/components/gitflow/GitflowDiagram.tsx (new)
  - src/components/gitflow/GitflowActionCards.tsx (new)
  - src/components/gitflow/GitflowBranchReference.tsx (new)
autonomous: true
---

# Gitflow Cheatsheet Blade — SVG Diagram, "You Are Here" Indicator, Action Cards, Branch Reference

## Goal

Replace the placeholder GitflowCheatsheetBlade with a comprehensive Gitflow reference guide that includes an inline SVG workflow diagram with Catppuccin-themed branch lanes, a "You are here" indicator highlighting the current branch type, contextual next-action suggestion cards, and a full branch type reference section. This fulfills requirements CONTENT-05 and CONTENT-06.

## must_haves

- SVG diagram shows all 5 Gitflow lanes (main, develop, feature, release, hotfix) with Catppuccin accent colors
- The current branch type lane is highlighted (full opacity, wider stroke, glow effect)
- Inactive lanes are dimmed (opacity 0.4)
- "You are here" badge pulses on the highlighted lane using `motion-safe:animate-gentle-pulse`
- Below the diagram: "You are on `feature/add-login`" with the branch name in code font
- 1-3 contextual action cards based on current branch type (informational only, no execute buttons)
- Full branch type reference cards for all 5 types (always shown, current type emphasized)
- Each reference card shows: description, naming convention, branches from/merges to, typical workflow
- When current branch does not match any gitflow pattern, "You are here" says "not a gitflow branch"
- The cheatsheet consumes `useGitflowStore` and `useRepositoryStore` for branch state
- The blade scrolls vertically, SVG diagram scales proportionally (responsive)

## Tasks

<task id="1" title="Create GitflowDiagram SVG component">

**File**: Create `src/components/gitflow/GitflowDiagram.tsx`

This is a static SVG React component with dynamic highlighting based on the current branch type.

```tsx
import type { GitflowBranchType } from "../../lib/branchClassifier";
import { BRANCH_TYPE_COLORS } from "../../lib/branchClassifier";

interface GitflowDiagramProps {
  /** Which lane to highlight. undefined = no highlight. */
  highlightedLane?: GitflowBranchType;
}

const LANE_Y: Record<string, number> = {
  hotfix: 60,
  release: 130,
  main: 200,
  develop: 270,
  feature: 340,
};

const LANE_LABELS: Record<string, string> = {
  main: "main",
  develop: "develop",
  feature: "feature/*",
  release: "release/*",
  hotfix: "hotfix/*",
};

/**
 * Gitflow branching workflow diagram rendered as inline SVG.
 * Uses Catppuccin CSS variable colors for branch lanes.
 * The highlighted lane gets full opacity, wider stroke, and a glow effect.
 */
export function GitflowDiagram({ highlightedLane }: GitflowDiagramProps) {
  const laneOrder: GitflowBranchType[] = [
    "hotfix",
    "release",
    "main",
    "develop",
    "feature",
  ];

  return (
    <svg
      viewBox="0 0 800 400"
      className="w-full h-auto"
      role="img"
      aria-label="Gitflow branching workflow diagram"
    >
      {/* Background */}
      <rect width="800" height="400" fill="var(--ctp-mantle)" rx="8" />

      {/* Lane lines and labels */}
      {laneOrder.map((lane) => {
        const isActive = highlightedLane === lane;
        const color = BRANCH_TYPE_COLORS[lane];
        const y = LANE_Y[lane];

        return (
          <g key={lane} opacity={isActive ? 1 : 0.4}>
            {/* Lane line */}
            <line
              x1={120}
              y1={y}
              x2={750}
              y2={y}
              stroke={color}
              strokeWidth={isActive ? 3 : 2}
              strokeLinecap="round"
              {...(isActive && {
                filter: "url(#glow)",
              })}
            />

            {/* Lane label */}
            <text
              x={15}
              y={y + 4}
              fill={color}
              fontSize={12}
              fontFamily="var(--font-mono)"
              fontWeight={isActive ? "bold" : "normal"}
            >
              {LANE_LABELS[lane]}
            </text>

            {/* Example commit dots */}
            {[200, 350, 500, 650].map((cx) => (
              <circle
                key={cx}
                cx={cx}
                cy={y}
                r={isActive ? 5 : 4}
                fill={color}
              />
            ))}
          </g>
        );
      })}

      {/* Branch/merge arrows (simplified illustration) */}
      {/* Feature branches from develop */}
      <path
        d="M 250 270 Q 250 305 300 340"
        fill="none"
        stroke={BRANCH_TYPE_COLORS.feature}
        strokeWidth={1.5}
        strokeDasharray="4 4"
        opacity={highlightedLane === "feature" ? 0.8 : 0.3}
      />
      <path
        d="M 550 340 Q 600 305 600 270"
        fill="none"
        stroke={BRANCH_TYPE_COLORS.feature}
        strokeWidth={1.5}
        strokeDasharray="4 4"
        opacity={highlightedLane === "feature" ? 0.8 : 0.3}
      />

      {/* Release branches from develop, merge to main and develop */}
      <path
        d="M 350 270 Q 350 200 400 130"
        fill="none"
        stroke={BRANCH_TYPE_COLORS.release}
        strokeWidth={1.5}
        strokeDasharray="4 4"
        opacity={highlightedLane === "release" ? 0.8 : 0.3}
      />
      <path
        d="M 550 130 Q 575 165 575 200"
        fill="none"
        stroke={BRANCH_TYPE_COLORS.release}
        strokeWidth={1.5}
        strokeDasharray="4 4"
        opacity={highlightedLane === "release" ? 0.8 : 0.3}
      />

      {/* Hotfix branches from main, merge to main and develop */}
      <path
        d="M 400 200 Q 400 130 450 60"
        fill="none"
        stroke={BRANCH_TYPE_COLORS.hotfix}
        strokeWidth={1.5}
        strokeDasharray="4 4"
        opacity={highlightedLane === "hotfix" ? 0.8 : 0.3}
      />
      <path
        d="M 600 60 Q 625 130 625 200"
        fill="none"
        stroke={BRANCH_TYPE_COLORS.hotfix}
        strokeWidth={1.5}
        strokeDasharray="4 4"
        opacity={highlightedLane === "hotfix" ? 0.8 : 0.3}
      />

      {/* Glow filter for active lane */}
      <defs>
        <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
          <feGaussianBlur stdDeviation="3" result="blur" />
          <feMerge>
            <feMergeNode in="blur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>

      {/* "You are here" indicator */}
      {highlightedLane && highlightedLane !== "other" && (
        <g className="motion-safe:animate-gentle-pulse">
          {/* Outer glow circle */}
          <circle
            cx={700}
            cy={LANE_Y[highlightedLane]}
            r={10}
            fill={BRANCH_TYPE_COLORS[highlightedLane]}
            opacity={0.25}
          />
          {/* Inner dot */}
          <circle
            cx={700}
            cy={LANE_Y[highlightedLane]}
            r={5}
            fill={BRANCH_TYPE_COLORS[highlightedLane]}
          />
          {/* Label */}
          <text
            x={700}
            y={LANE_Y[highlightedLane] - 18}
            fill={BRANCH_TYPE_COLORS[highlightedLane]}
            fontSize={10}
            fontWeight="bold"
            textAnchor="middle"
          >
            YOU ARE HERE
          </text>
        </g>
      )}
    </svg>
  );
}
```

</task>

<task id="2" title="Create GitflowActionCards component">

**File**: Create `src/components/gitflow/GitflowActionCards.tsx`

```tsx
import { ArrowRight, GitBranch, GitMerge, Rocket, Tag } from "lucide-react";
import type { GitflowBranchType } from "../../lib/branchClassifier";
import { BRANCH_TYPE_COLORS } from "../../lib/branchClassifier";
import type { LucideIcon } from "lucide-react";

interface ActionCard {
  icon: LucideIcon;
  title: string;
  description: string;
  command?: string;
}

const ACTION_MAP: Record<GitflowBranchType, ActionCard[]> = {
  feature: [
    {
      icon: GitMerge,
      title: "Finish feature",
      description: "Merge your feature branch back into develop",
      command: "git flow feature finish",
    },
    {
      icon: Rocket,
      title: "Push to remote",
      description: "Share your feature branch with the team",
      command: "git push -u origin feature/<name>",
    },
  ],
  develop: [
    {
      icon: GitBranch,
      title: "Start a feature",
      description: "Create a new feature branch from develop",
      command: "git flow feature start <name>",
    },
    {
      icon: Tag,
      title: "Start a release",
      description: "Begin preparing a new release from develop",
      command: "git flow release start <version>",
    },
  ],
  release: [
    {
      icon: GitMerge,
      title: "Finish release",
      description: "Merge into main and develop, create a version tag",
      command: "git flow release finish <version>",
    },
  ],
  hotfix: [
    {
      icon: GitMerge,
      title: "Finish hotfix",
      description: "Merge the fix into main and develop, create a patch tag",
      command: "git flow hotfix finish <name>",
    },
  ],
  main: [
    {
      icon: GitBranch,
      title: "Start a hotfix",
      description: "Create a hotfix branch if a production issue is found",
      command: "git flow hotfix start <name>",
    },
    {
      icon: Tag,
      title: "Review tags",
      description: "Check release tags and version history",
      command: "git tag -l",
    },
  ],
  other: [
    {
      icon: ArrowRight,
      title: "Switch to a gitflow branch",
      description:
        "This branch does not follow gitflow conventions. Consider switching to develop or creating a feature branch.",
    },
  ],
};

interface GitflowActionCardsProps {
  branchType: GitflowBranchType;
}

export function GitflowActionCards({ branchType }: GitflowActionCardsProps) {
  const cards = ACTION_MAP[branchType];
  return (
    <div className="space-y-3">
      <h3 className="text-sm font-semibold text-ctp-subtext1">
        Suggested next actions
      </h3>
      {cards.map((card) => (
        <div
          key={card.title}
          className="bg-ctp-surface0/50 hover:bg-ctp-surface0 border border-ctp-surface1 rounded-lg p-4 transition-colors"
        >
          <div className="flex items-start gap-3">
            <card.icon className="w-5 h-5 shrink-0 mt-0.5" style={{ color: BRANCH_TYPE_COLORS[branchType] }} />
            <div className="min-w-0">
              <p className="text-sm font-medium text-ctp-text">
                {card.title}
              </p>
              <p className="text-sm text-ctp-subtext0 mt-0.5">
                {card.description}
              </p>
              {card.command && (
                <code className="inline-block mt-2 text-xs bg-ctp-crust text-ctp-peach px-2 py-1 rounded font-mono">
                  {card.command}
                </code>
              )}
            </div>
          </div>
        </div>
      ))}
    </div>
  );
}
```

</task>

<task id="3" title="Create GitflowBranchReference component">

**File**: Create `src/components/gitflow/GitflowBranchReference.tsx`

```tsx
import type { GitflowBranchType } from "../../lib/branchClassifier";
import { BRANCH_TYPE_COLORS } from "../../lib/branchClassifier";

interface BranchTypeInfo {
  type: GitflowBranchType;
  name: string;
  description: string;
  naming: string;
  branchesFrom: string;
  mergesTo: string;
  workflow: string;
}

const BRANCH_TYPES: BranchTypeInfo[] = [
  {
    type: "main",
    name: "Main (Production)",
    description:
      "Always reflects the current production-ready state. Every commit on main is a release.",
    naming: "main or master",
    branchesFrom: "—",
    mergesTo: "—",
    workflow:
      "Never commit directly. Receives merges from release and hotfix branches only.",
  },
  {
    type: "develop",
    name: "Develop (Integration)",
    description:
      "Integration branch for features. Contains the latest development changes for the next release.",
    naming: "develop",
    branchesFrom: "main (initial setup)",
    mergesTo: "—",
    workflow:
      "Receives completed features. Used as the base for release and feature branches.",
  },
  {
    type: "feature",
    name: "Feature Branches",
    description:
      "Short-lived branches for developing individual features or enhancements.",
    naming: "feature/<descriptive-name>",
    branchesFrom: "develop",
    mergesTo: "develop",
    workflow:
      "Create from develop, implement the feature, then merge back into develop when complete.",
  },
  {
    type: "release",
    name: "Release Branches",
    description:
      "Preparation branches for a new production release. Allows final bug fixes and version bumping.",
    naming: "release/<version>",
    branchesFrom: "develop",
    mergesTo: "main and develop",
    workflow:
      "Create from develop when ready to release. Fix last-minute issues, bump version, then merge into both main and develop.",
  },
  {
    type: "hotfix",
    name: "Hotfix Branches",
    description:
      "Emergency fix branches created from main to address critical production issues.",
    naming: "hotfix/<name>",
    branchesFrom: "main",
    mergesTo: "main and develop",
    workflow:
      "Create from main, apply the fix, then merge into both main (for immediate deployment) and develop (to include the fix in future releases).",
  },
];

interface GitflowBranchReferenceProps {
  currentBranchType: GitflowBranchType;
}

export function GitflowBranchReference({
  currentBranchType,
}: GitflowBranchReferenceProps) {
  return (
    <div className="space-y-3">
      <h3 className="text-sm font-semibold text-ctp-subtext1">
        Branch type reference
      </h3>
      {BRANCH_TYPES.map((info) => {
        const isCurrent = info.type === currentBranchType;
        const color = BRANCH_TYPE_COLORS[info.type];

        return (
          <div
            key={info.type}
            className={`
              border rounded-lg p-4 transition-colors
              ${
                isCurrent
                  ? "bg-ctp-surface0/30"
                  : "border-ctp-surface1 bg-ctp-surface0/20"
              }
            `}
            style={isCurrent ? { borderColor: color } : undefined}
          >
            <div className="flex items-center gap-2 mb-2">
              <div
                className="w-3 h-3 rounded-full shrink-0"
                style={{ backgroundColor: color }}
              />
              <h4 className={`text-sm font-semibold ${isCurrent ? "text-ctp-text" : "text-ctp-subtext1"}`}>
                {info.name}
              </h4>
              {isCurrent && (
                <span
                  className="text-xs font-medium px-2 py-0.5 rounded-full"
                  style={{ backgroundColor: `${color}33`, color }}
                >
                  You are here
                </span>
              )}
            </div>
            <p className="text-xs text-ctp-subtext0 mb-2">{info.description}</p>
            <div className="grid grid-cols-2 gap-x-4 gap-y-1 text-xs">
              <div>
                <span className="text-ctp-overlay0">Naming: </span>
                <code className="text-ctp-peach font-mono">{info.naming}</code>
              </div>
              <div>
                <span className="text-ctp-overlay0">Branches from: </span>
                <span className="text-ctp-subtext1">{info.branchesFrom}</span>
              </div>
              <div>
                <span className="text-ctp-overlay0">Merges to: </span>
                <span className="text-ctp-subtext1">{info.mergesTo}</span>
              </div>
              <div>
                <span className="text-ctp-overlay0">Workflow: </span>
                <span className="text-ctp-subtext1">{info.workflow}</span>
              </div>
            </div>
          </div>
        );
      })}
    </div>
  );
}
```

</task>

<task id="4" title="Replace GitflowCheatsheetBlade with full implementation" depends_on="1,2,3">

**File**: `src/components/blades/GitflowCheatsheetBlade.tsx`

Replace the entire file:

```tsx
import { GitMerge } from "lucide-react";
import { useGitflowStore } from "../../stores/gitflow";
import { useRepositoryStore } from "../../stores/repository";
import { classifyBranch, BRANCH_TYPE_COLORS } from "../../lib/branchClassifier";
import type { GitflowBranchType } from "../../lib/branchClassifier";
import { GitflowDiagram } from "../gitflow/GitflowDiagram";
import { GitflowActionCards } from "../gitflow/GitflowActionCards";
import { GitflowBranchReference } from "../gitflow/GitflowBranchReference";

export function GitflowCheatsheetBlade() {
  const { status } = useGitflowStore();
  const { currentBranch } = useRepositoryStore();

  // Determine branch type from current branch name
  const branchName = status?.currentBranch || currentBranch || "";
  const branchType: GitflowBranchType = branchName
    ? classifyBranch(branchName)
    : "other";

  return (
    <div className="flex-1 overflow-y-auto h-full bg-ctp-base">
      <div className="p-6 max-w-3xl mx-auto space-y-6">
        {/* Header */}
        <div className="flex items-center gap-3 mb-2">
          <GitMerge className="w-6 h-6 text-ctp-mauve" />
          <div>
            <h1 className="text-lg font-bold text-ctp-text">
              Gitflow Workflow Guide
            </h1>
            <p className="text-xs text-ctp-subtext0">
              A branching model for structured release management
            </p>
          </div>
        </div>

        {/* SVG Diagram */}
        <div className="shrink-0">
          <GitflowDiagram
            highlightedLane={branchType !== "other" ? branchType : undefined}
          />
        </div>

        {/* "You are here" section */}
        <div className="bg-ctp-surface0/30 border border-ctp-surface1 rounded-lg p-4">
          {branchName ? (
            <>
              <div className="flex items-center gap-2">
                <div
                  className="w-2.5 h-2.5 rounded-full motion-safe:animate-gentle-pulse"
                  style={{ backgroundColor: BRANCH_TYPE_COLORS[branchType] }}
                />
                <p className="text-sm text-ctp-text">
                  You are on{" "}
                  <code className="bg-ctp-crust text-ctp-peach px-1.5 py-0.5 rounded text-xs font-mono">
                    {branchName}
                  </code>
                </p>
              </div>
              {branchType === "other" && (
                <p className="text-xs text-ctp-overlay0 mt-1 ml-5">
                  This branch does not match a gitflow naming pattern
                </p>
              )}
            </>
          ) : (
            <p className="text-sm text-ctp-overlay0">
              No branch detected — open a repository to see your position
            </p>
          )}
        </div>

        {/* Action Cards */}
        <GitflowActionCards branchType={branchType} />

        {/* Branch Reference */}
        <GitflowBranchReference currentBranchType={branchType} />
      </div>
    </div>
  );
}
```

**Notes**:

1. The blade consumes `useGitflowStore` for `status.currentBranch` and falls back to `useRepositoryStore.currentBranch` if gitflow status is not loaded.

2. The `classifyBranch` utility determines the branch type from the branch name prefix.

3. All dynamic colors use inline `style` props with `BRANCH_TYPE_COLORS` CSS variable values instead of dynamic Tailwind classes (Tailwind v4 JIT does not support string-interpolated class names like `text-${colorClass}`).

</task>

## Verification

- [ ] Opening the Gitflow Guide shows the SVG diagram with 5 branch lanes
- [ ] The current branch type lane is highlighted (full opacity, wider stroke, glow)
- [ ] Inactive lanes are dimmed (opacity 0.4)
- [ ] The "You are here" indicator pulses gently on the highlighted lane (respects reduced motion)
- [ ] Below the diagram: "You are on `feature/xyz`" with the branch name in code font
- [ ] When on a non-gitflow branch (e.g., `my-branch`): "This branch does not match a gitflow naming pattern"
- [ ] 1-3 action cards appear below the status, relevant to the current branch type
- [ ] Action cards show git commands in code font
- [ ] All 5 branch type reference cards are displayed below the action cards
- [ ] The current branch type card has a "You are here" badge and highlighted border
- [ ] The blade scrolls vertically when content exceeds the viewport
- [ ] The SVG diagram scales proportionally to the blade width (responsive)
- [ ] When no repository is open, the blade shows "No branch detected" message
- [ ] `npx tsc --noEmit` completes with no new errors
