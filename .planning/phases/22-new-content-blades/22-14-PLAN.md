---
phase: 22-new-content-blades
plan: 14
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/blades/RepoBrowserBlade.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Backspace navigates to parent directory in repo browser"
    - "Keyboard navigation works immediately after navigating into a directory"
  artifacts:
    - path: "src/components/blades/RepoBrowserBlade.tsx"
      provides: "RepoBrowserBlade with reliable focus management"
      modified_lines: "46-48, 155"
  key_links:
    - from: "useEffect focus logic"
      to: "FileRow focus"
      via: "entries dependency"
      pattern: "useEffect.*\\[.*entries.*\\]"
---

<objective>
Fix Backspace key navigation in repo browser

Purpose: Resolve UAT Test 28 (major) — Backspace should navigate to parent directory but currently doesn't work because focus is never established after navigating into subdirectories
Output: RepoBrowserBlade.tsx with corrected focus dependency and defensive tabIndex fallback
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/debug/backspace-nav-repo-browser.md
@src/components/blades/RepoBrowserBlade.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix focus effect dependencies and add defensive tabIndex</name>
  <files>src/components/blades/RepoBrowserBlade.tsx</files>
  <action>
Fix two issues preventing Backspace navigation:

**Issue 1 (lines 46-48):** useEffect missing `entries` dependency
- Current dependency array: `[focusedIndex]`
- Update to: `[focusedIndex, entries]`
- Root cause: Effect runs on mount before query data loads, itemRefs.current[0] is null. When data arrives and FileRows render, focusedIndex is still 0 (unchanged) so effect doesn't re-run. No FileRow gets focus. Without focus on any element inside the listbox, the onKeyDown handler is unreachable.

**Issue 2 (line 155):** Listbox div lacks tabIndex
- Find the listbox div with `onKeyDown={handleKeyDown}` (around line 155-160)
- Add `tabIndex={0}` to the div
- This provides a defensive fallback: if focus logic fails or user clicks outside, the container itself can receive focus and keyboard events

After these changes, the focus effect will re-fire when entries populate, establishing focus on the first FileRow. The tabIndex ensures the container is focusable even if the effect timing fails.
  </action>
  <verify>
Open repo browser at root → navigate into a subdirectory → immediately press Backspace (without manually clicking/tabbing) → should navigate to parent directory. Repeat with nested directories (root → src/ → components/ → press Backspace twice).
  </verify>
  <done>
Backspace navigates to parent directory immediately after entering a subdirectory; focus is programmatically established on first FileRow after data loads; listbox div is focusable as fallback
  </done>
</task>

</tasks>

<verification>
Manual keyboard navigation test: Browse Files → enter subdirectory → press Backspace → should return to parent. Test with arrow keys (Up/Down), Enter to open, and Backspace to go back.
</verification>

<success_criteria>
- UAT Test 28 passes: Backspace navigates to parent directory
- UAT Tests 26-27 remain working: Arrow key navigation and Enter to open
- Keyboard navigation works immediately after navigating into any directory without requiring manual click/tab
</success_criteria>

<output>
After completion, create `.planning/phases/22-new-content-blades/22-14-SUMMARY.md`
</output>
