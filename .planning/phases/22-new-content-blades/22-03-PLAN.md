---
phase: 22
plan: 22-03
title: Dependencies & Theme — Install rehype-sanitize, @catppuccin/highlightjs, gentle-pulse animation
wave: 1
depends_on: []
files_modified:
  - package.json
  - package-lock.json
  - src/index.css
  - src/types/model-viewer.d.ts (new)
autonomous: true
---

# Dependencies & Theme — Install rehype-sanitize, @catppuccin/highlightjs, gentle-pulse animation

## Goal

Install the two new npm packages needed for Phase 22, add the `gentle-pulse` CSS animation for the Gitflow "You are here" indicator, and create the TypeScript type declaration for the `<model-viewer>` web component. These are prerequisites for the blade implementation plans that follow.

## must_haves

- `rehype-sanitize@6.0.0` is installed and importable
- `@catppuccin/highlightjs@1.0.1` is installed and its CSS file is importable
- `highlight.js` is available as a transitive dependency (verify after install)
- `gentle-pulse` keyframe animation is defined in `src/index.css`
- `model-viewer.d.ts` provides JSX IntrinsicElements augmentation for `<model-viewer>`
- TypeScript compiles without errors after these changes

## Tasks

<task id="1" title="Install new npm packages">

Run the following command from the project root:

```bash
npm install rehype-sanitize@6.0.0 @catppuccin/highlightjs@1.0.1
```

After installation, verify:
1. `package.json` has both new entries in `dependencies`
2. Run `npm ls highlight.js` to confirm highlight.js is available (it's a transitive dependency of `rehype-highlight`)
3. Run `npm ls rehype-sanitize` to confirm version 6.0.0

Do NOT modify any lock file manually — let `npm install` handle it.

</task>

<task id="2" title="Add gentle-pulse animation to index.css" depends_on="1">

**File**: `src/index.css`

1. Add the `gentle-pulse` animation variable to the `@theme` block (alongside the existing `--animate-dirty-pulse`):

   ```css
   @theme {
       --font-sans:
           "Geist Variable", system-ui, -apple-system, BlinkMacSystemFont,
           "Segoe UI", Roboto, sans-serif;
       --font-mono:
           "JetBrains Mono Variable", ui-monospace, "SF Mono", "Monaco",
           "Cascadia Code", "Consolas", monospace;
       --animate-dirty-pulse: dirty-pulse 2s ease-in-out infinite;
       --animate-gentle-pulse: gentle-pulse 3s ease-in-out infinite;
   }
   ```

2. Add the `gentle-pulse` keyframe definition after the existing `dirty-pulse` keyframes:

   ```css
   @keyframes gentle-pulse {
       0%,
       100% {
           opacity: 1;
       }
       50% {
           opacity: 0.6;
       }
   }
   ```

Place this immediately after the closing `}` of the `@keyframes dirty-pulse` block.

The animation is used as `motion-safe:animate-gentle-pulse` in the Gitflow cheatsheet's "You are here" indicator. The `motion-safe:` prefix respects the OS `prefers-reduced-motion` setting.

</task>

<task id="3" title="Create model-viewer TypeScript type declaration">

**File**: Create `src/types/model-viewer.d.ts`

```ts
/**
 * JSX type declarations for @google/model-viewer web component.
 *
 * model-viewer ships with TypeScript types for HTMLElementTagNameMap but
 * does NOT declare JSX.IntrinsicElements. This file bridges the gap
 * so <model-viewer> can be used in React/JSX without type errors.
 */

declare namespace JSX {
  interface IntrinsicElements {
    "model-viewer": React.DetailedHTMLProps<
      React.HTMLAttributes<HTMLElement> & {
        src?: string;
        alt?: string;
        poster?: string;
        loading?: "auto" | "lazy" | "eager";
        reveal?: "auto" | "manual";
        "camera-controls"?: boolean;
        "auto-rotate"?: boolean;
        "auto-rotate-delay"?: number;
        "rotation-per-second"?: string;
        "shadow-intensity"?: string;
        "shadow-softness"?: string;
        "environment-image"?: string;
        exposure?: string;
        "camera-orbit"?: string;
        "camera-target"?: string;
        "field-of-view"?: string;
        "min-camera-orbit"?: string;
        "max-camera-orbit"?: string;
        "interaction-prompt"?: "auto" | "none";
        "touch-action"?: string;
        ar?: boolean;
        "ar-modes"?: string;
      },
      HTMLElement
    >;
  }
}
```

This file is automatically included by TypeScript because `tsconfig.json` has `"include": ["src"]` and this file is under `src/types/`. No tsconfig changes needed.

</task>

<task id="4" title="Verify all imports work" depends_on="1,2,3">

Create a temporary test to verify the imports resolve:

1. Verify these imports compile (don't need to actually create a file — just run tsc):
   - `import rehypeSanitize, { defaultSchema } from "rehype-sanitize"` — should resolve
   - `import "@catppuccin/highlightjs/css/catppuccin-mocha.css"` — should resolve (CSS import)

2. Verify `src/types/model-viewer.d.ts` is picked up by TypeScript — in any TSX file, `<model-viewer src="test" />` should not produce a type error.

3. Run `npx tsc --noEmit` to confirm no regressions.

</task>

## Verification

- [ ] `node -e "require('rehype-sanitize')"` succeeds (package is installed)
- [ ] `npm ls @catppuccin/highlightjs` shows `@catppuccin/highlightjs@1.0.1`
- [ ] `npm ls highlight.js` shows highlight.js as a transitive dependency
- [ ] `src/index.css` contains both `--animate-dirty-pulse` and `--animate-gentle-pulse` in the `@theme` block
- [ ] `src/index.css` contains the `@keyframes gentle-pulse` definition
- [ ] `src/types/model-viewer.d.ts` exists and declares `JSX.IntrinsicElements["model-viewer"]`
- [ ] `npx tsc --noEmit` completes with no new errors
- [ ] `npm run dev` starts without errors
