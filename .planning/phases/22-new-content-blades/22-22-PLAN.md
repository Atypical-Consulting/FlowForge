---
phase: 22-new-content-blades
plan: 22
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/gitflow/GitflowDiagram.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Gitflow SVG diagram shows 5 clearly visible colored branch lanes on dark background"
    - "Branch/merge curves are smooth S-shaped transitions resembling GitKraken-style git graphs"
    - "Branch-out and merge-back curves visually originate from and terminate at commit dots"
    - "All lanes are readable without any lane being highlighted"
  artifacts:
    - path: "src/components/gitflow/GitflowDiagram.tsx"
      provides: "Redesigned SVG Gitflow diagram"
      contains: "C "
  key_links:
    - from: "src/components/gitflow/GitflowDiagram.tsx"
      to: "src/lib/branchClassifier.ts"
      via: "BRANCH_TYPE_COLORS import"
      pattern: "BRANCH_TYPE_COLORS"
---

<objective>
Redesign the Gitflow SVG diagram with proper opacity, smooth cubic Bezier curves, and commit-aligned geometry to fix the "too dark colors and strange curves" issue.

Purpose: Close gap 2 (major) from 22-wave7-UAT.md. Three compounding issues: (1) opacity 0.3-0.4 on near-black background makes pastel colors invisible, (2) quadratic Bezier Q curves produce awkward arcs instead of smooth S-curves, (3) branch/merge paths don't connect to commit dots.
Output: Visually clear, GitKraken-inspired Gitflow diagram with readable colors and smooth curves.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/debug/gitflow-svg-wave7.md
@src/components/gitflow/GitflowDiagram.tsx
@src/lib/branchClassifier.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign GitflowDiagram SVG with proper colors, curves, and geometry</name>
  <files>src/components/gitflow/GitflowDiagram.tsx</files>
  <action>
    Rewrite the SVG content in GitflowDiagram.tsx with these specific changes. Keep the same component interface (`GitflowDiagramProps` with `highlightedLane`), the same imports, and the same overall structure (SVG with lanes, labels, dots, curves, "You are here" indicator, glow filter).

    **A. Fix opacity (PRIMARY -- addresses "too dark"):**
    - Non-highlighted lane lines: change opacity from `0.4` to `0.7`
    - Non-highlighted lane labels: change to same opacity `0.7`
    - Non-highlighted commit dots: change to same opacity `0.7`
    - Non-highlighted branch/merge paths: change opacity from `0.3` to `0.55`
    - Highlighted lane: keep at `1.0` with glow filter (current behavior is correct)
    - Highlighted branch/merge paths: keep at `0.9` (slight increase from 0.8)
    - When NO lane is highlighted (highlightedLane is undefined or "other"): all lanes at `0.7`, all paths at `0.55` -- this ensures the diagram is always readable

    **B. Fix curve geometry (addresses "strange curves"):**

    Replace ALL quadratic Bezier (Q) curves with cubic Bezier (C) curves for smooth S-shaped transitions. The S-curve pattern: horizontal departure from source lane, smooth transition, horizontal arrival at target lane.

    Redesign the commit dot positions so branch/merge curves originate FROM and terminate AT specific commit dots. Use these commit dot X positions per lane:

    ```
    main:     [200, 350, 500, 650]  (unchanged)
    develop:  [200, 300, 450, 600, 700]  (5 dots, more activity)
    feature:  [350, 450, 500]  (3 dots -- shorter-lived branch)
    release:  [400, 500, 550]  (3 dots -- shorter-lived branch)
    hotfix:   [450, 550]  (2 dots -- very short-lived)
    ```

    The lane Y positions stay the same:
    ```
    hotfix: 60, release: 130, main: 200, develop: 270, feature: 340
    ```

    **Branch/merge curves using cubic Bezier C command:**

    Feature branch-out (develop -> feature):
    - Start at develop commit dot at x=300 (develop's 2nd dot)
    - End at feature's first dot at x=350
    - Path: `M 300 270 C 300 305, 350 305, 350 340`
    - This creates a smooth S-curve: departs horizontally from develop, arrives horizontally at feature

    Feature merge-back (feature -> develop):
    - Start at feature's last dot at x=500
    - End at develop commit dot at x=600 (develop's 4th dot)
    - Path: `M 500 340 C 500 305, 600 305, 600 270`
    - Smooth S-curve going back up

    Release branch-out (develop -> release):
    - Start at develop commit dot at x=450 (develop's 3rd dot)
    - End at release's first dot at x=400
    - Path: `M 450 270 C 450 200, 400 200, 400 130`
    - Note: release is ABOVE develop (y=130 < y=270), so curve goes UP

    Release merge to main (release -> main):
    - Start at release's last dot at x=550
    - End at main commit dot at x=500 (main's 3rd dot)
    - Path: `M 550 130 C 550 165, 500 165, 500 200`

    Release merge back to develop (release -> develop):
    - Start at release's last dot at x=550
    - End at develop commit dot at x=600 (develop's 4th dot)
    - Path: `M 550 130 C 550 200, 600 200, 600 270`

    Hotfix branch-out (main -> hotfix):
    - Start at main commit dot at x=350 (main's 2nd dot)
    - End at hotfix's first dot at x=450
    - Path: `M 350 200 C 350 130, 450 130, 450 60`

    Hotfix merge to main (hotfix -> main):
    - Start at hotfix's last dot at x=550
    - End at main commit dot at x=650 (main's 4th dot)
    - Path: `M 550 60 C 550 130, 650 130, 650 200`

    Hotfix merge to develop (hotfix -> develop):
    - Start at hotfix's last dot at x=550
    - End at develop commit dot at x=700 (develop's 5th dot)
    - Path: `M 550 60 C 550 165, 700 165, 700 270`

    **C. Improve stroke styling:**
    - Branch/merge paths: `strokeWidth={2.5}`, NO `strokeDasharray` (solid lines, not dashed)
    - `strokeLinecap="round"` and `strokeLinejoin="round"` on all paths
    - Lane lines: `strokeWidth` stays at 2 (non-highlighted) / 3 (highlighted)

    **D. Add merge/branch point markers:**
    At each curve start and end point, add a small filled circle (r=3) in the curve's color at the curve's opacity. These visually connect the curves to the lanes. They sit ON TOP of the lane commit dots, reinforcing the connection.

    **E. Update commit dots per lane:**
    Instead of the fixed `[200, 350, 500, 650]` for all lanes, use the per-lane positions defined above. Each lane renders its own set of commit dots. Main and develop get more dots (they're long-lived), feature/release/hotfix get fewer.

    **F. Adjust viewBox if needed:**
    The current `viewBox="0 0 800 400"` should still work. If the "You are here" indicator at x=700 overlaps with the last develop dot, move the indicator to x=740 or slightly adjust.

    **G. Keep these elements unchanged:**
    - Background rect with `fill="var(--catppuccin-color-mantle)"`
    - Lane labels on the left (x=15)
    - Glow filter definition in `<defs>`
    - "You are here" indicator (pulsing dot + label) -- adjust x position if needed
    - `BRANCH_TYPE_COLORS` import and usage
    - Component interface and props

    **Implementation approach:**
    To keep the code clean, define the curves as data (array of objects with `from`, `to`, `path`, `color`, `type` fields) and render them in a loop, rather than hardcoding each `<path>` individually. This makes the code more maintainable. Define per-lane commit positions as a Record like `LANE_COMMITS`.
  </action>
  <verify>
    1. `npx tsc --noEmit 2>&1 | grep -v "bindings.ts"` -- no TypeScript errors
    2. Visual inspection: Open Gitflow cheatsheet blade
    3. All 5 lanes clearly visible and distinguishable on the dark background (no "too dark" issue)
    4. Branch/merge curves are smooth S-shapes, not steep diagonals or awkward arcs
    5. Curves connect to commit dots (not floating in space between dots)
    6. Test with highlighted lane (be on a main/develop/feature branch) -- highlighted lane is bright, others dimmed but still readable
    7. Test with no highlight (non-gitflow branch) -- all lanes visible at 0.7 opacity
  </verify>
  <done>Gitflow SVG diagram shows 5 clearly visible colored lanes with smooth cubic Bezier S-curves connecting commit dots. Readable in all highlight states.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit 2>&1 | grep -v "bindings.ts"` -- no new errors
2. Open Gitflow cheatsheet blade -- 5 colored lanes clearly visible
3. Colors are bright pastel Catppuccin colors, NOT muddy/dark
4. Branch/merge curves are smooth S-shapes resembling GitKraken-style graphs
5. Curves start and end at commit dot positions
6. "You are here" indicator works on gitflow branches
7. No visual overlap or clipping issues
</verification>

<success_criteria>
- All 5 Gitflow branch lanes are clearly visible on the dark Catppuccin background
- Branch/merge curves use cubic Bezier for smooth S-shaped transitions
- Curves are solid (not dashed), 2.5px wide, with round linecaps
- Non-highlighted lanes at 0.7 opacity are easily readable
- Branch/merge paths connect to actual commit dot positions
- Diagram resembles a GitKraken-style commit graph layout
</success_criteria>

<output>
After completion, create `.planning/phases/22-new-content-blades/22-22-SUMMARY.md`
</output>
