---
phase: 22-new-content-blades
plan: 26
type: execute
wave: 10
depends_on: []
files_modified:
  - src/components/gitflow/GitflowDiagram.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All 5 branch types (main, hotfix, release, develop, feature) have their own dedicated horizontal line at a distinct Y position"
    - "All branch/merge connections use straight vertical lines (no cubic Bezier curves, no C commands in path data)"
    - "Short-lived branches (feature, release, hotfix) have horizontal line segments spanning only from branch-point to merge-point"
    - "Version labels (v1.0, v2.0, v2.0.1) appear above the main lane"
    - "You Are Here indicator positions use the new lane Y values"
  artifacts:
    - path: "src/components/gitflow/GitflowDiagram.tsx"
      provides: "Mermaid gitgraph-style SVG with 5 horizontal lanes and straight-line connectors"
      contains: "LANE_Y"
  key_links:
    - from: "GitflowDiagram.tsx LANE_Y"
      to: "SVG line elements"
      via: "5 horizontal lines using LANE_Y.main through LANE_Y.feature"
    - from: "GitflowDiagram.tsx CONNECTORS"
      to: "SVG line elements"
      via: "Straight vertical lines replacing FLOW_CURVES Bezier paths"
    - from: "GitflowDiagram.tsx INDICATOR_Y"
      to: "LANE_Y"
      via: "Indicator positions derived from lane Y positions"
---

<objective>
Redesign GitflowDiagram.tsx to use mermaid gitgraph visual style: 5 horizontal branch lanes with straight vertical connectors replacing all cubic Bezier curves. This addresses UAT tests 6 (invisible rows) and 7 (wrong style — user wants typical gitgraph, not curves).

Purpose: User explicitly requested mermaid gitgraph style with straight horizontal lines per branch and straight vertical connectors. The current arc-based design shows only 2 horizontal rows (main, develop) with short-lived branches as curved arcs, making them appear "invisible". All 5 branch types must be visible as distinct horizontal rows.

Output: Completely rewritten GitflowDiagram.tsx with gitgraph-style layout
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/debug/gitflow-svg-round5.md
@src/components/gitflow/GitflowDiagram.tsx
@src/lib/branchClassifier.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite GitflowDiagram.tsx with mermaid gitgraph-style layout</name>
  <files>src/components/gitflow/GitflowDiagram.tsx</files>
  <action>
    Complete rewrite of GitflowDiagram.tsx. Remove the FLOW_CURVES Bezier approach entirely and replace with 5 horizontal lane lines and straight vertical connectors. Follow the design recommendation from `.planning/debug/gitflow-svg-round5.md`.

    **Layout constants (per debug file recommendation):**
    ```typescript
    // 5 horizontal lanes, evenly spaced — order matches mermaid gitgraph convention
    const LANE_Y = {
      main:    40,
      hotfix:  90,
      release: 140,
      develop: 190,
      feature: 240,
    } as const;

    const LANE_X_START = 100;
    const LANE_X_END   = 850;
    const SVG_WIDTH    = 950;
    const SVG_HEIGHT   = 290;
    ```

    **Core structure — replace FLOW_CURVES with CONNECTORS:**

    1. **Five branch labels on the left** (x=15) — text elements for all 5 branch types, at their respective LANE_Y positions. Use `fontFamily="var(--font-mono)"` and the branch color from BRANCH_TYPE_COLORS.

    2. **Five horizontal lane lines:**
       - Main and develop: full-width lines from LANE_X_START to LANE_X_END (permanent branches)
       - Feature: partial line from FEATURE_BRANCH_X to FEATURE_MERGE_X only (ephemeral)
       - Release: partial line from RELEASE_BRANCH_X to RELEASE_MERGE_X only (ephemeral)
       - Hotfix: partial line from HOTFIX_BRANCH_X to HOTFIX_MERGE_X only (ephemeral)
       - Short-lived branches should use `strokeDasharray="6 3"` to visually indicate they are ephemeral

    3. **Commit dots on ALL lanes** — circles placed ON the horizontal lines at specific X positions:
       - Main lane: commits at [160, 280, 510, 660, 780]
       - Develop lane: commits at [160, 240, 360, 530, 620, 700, 780]
       - Feature lane: commits at [260, 310, 350] (on the feature Y line)
       - Release lane: commits at [450, 490] (on the release Y line)
       - Hotfix lane: commits at [610] (on the hotfix Y line)

    4. **Connectors — straight vertical `<line>` elements** replacing all Bezier curves:

       Define a CONNECTORS array (replaces FLOW_CURVES):
       ```typescript
       interface Connector {
         type: GitflowBranchType;
         x: number;         // X position of vertical line
         fromY: number;     // Source lane Y
         toY: number;       // Target lane Y
         label?: string;    // Optional label (e.g., "branch", "merge")
       }
       ```

       The connectors needed:
       - **Feature branch-out**: x=FEATURE_BRANCH_X (e.g. 220), from develop Y to feature Y, color=feature
       - **Feature merge-back**: x=FEATURE_MERGE_X (e.g. 380), from feature Y to develop Y, color=feature
       - **Release branch-out**: x=RELEASE_BRANCH_X (e.g. 420), from develop Y to release Y, color=release
       - **Release merge to main**: x=RELEASE_MERGE_MAIN_X (e.g. 500), from release Y to main Y, color=release
       - **Release merge to develop**: x=RELEASE_MERGE_DEV_X (e.g. 520), from release Y to develop Y, color=release
       - **Hotfix branch-out**: x=HOTFIX_BRANCH_X (e.g. 580), from main Y to hotfix Y, color=hotfix
       - **Hotfix merge to main**: x=HOTFIX_MERGE_MAIN_X (e.g. 650), from hotfix Y to main Y, color=hotfix
       - **Hotfix merge to develop**: x=HOTFIX_MERGE_DEV_X (e.g. 660), from hotfix Y to develop Y, color=hotfix

       Choose X positions that create a clear left-to-right narrative flow:
       1. Feature branches from develop, does work, merges back
       2. Release branches from develop, merges to main AND develop
       3. Hotfix branches from main, merges to main AND develop

       Render each connector as a straight `<line>` element:
       ```tsx
       <line
         x1={connector.x} y1={connector.fromY}
         x2={connector.x} y2={connector.toY}
         stroke={BRANCH_TYPE_COLORS[connector.type]}
         strokeWidth={2}
       />
       ```

    5. **Junction dots** — small circles at each connector endpoint on BOTH source and target lanes, showing where connections touch the lane lines.

    6. **Version labels on main** — keep the existing VERSION_LABELS array. Render as rounded-rect badges above the main lane (y = LANE_Y.main - 26). Keep the same 3 labels: v1.0, v2.0, v2.0.1.

    7. **Arrowhead markers** — keep SVG `<marker>` defs for the 5 branch colors. Apply `markerEnd` to the vertical connector lines to show direction of flow (branch goes down/up, merge goes up/down). Arrow markers should point in the direction of the line.

    8. **"You Are Here" indicator** — update INDICATOR_Y to use the new LANE_Y values:
       ```typescript
       const INDICATOR_Y: Record<string, number> = {
         main:    LANE_Y.main,
         develop: LANE_Y.develop,
         feature: LANE_Y.feature,
         release: LANE_Y.release,
         hotfix:  LANE_Y.hotfix,
       };
       ```
       Position the indicator at x=820 (near end of lanes) on the highlighted lane.

    9. **Opacity and highlight** — preserve the existing getOpacity() and getStrokeWidth() functions. Base opacity 0.85, highlighted 1.0, dimmed 0.35.

    10. **Background** — keep the rounded rect with `fill="var(--catppuccin-color-mantle)"`.

    11. **Glow filter** — keep the existing glow filter for highlighted lanes.

    **CRITICAL CONSTRAINTS:**
    - NO cubic Bezier curves (no `C` command in any SVG path `d` attribute)
    - NO quadratic Bezier curves (no `Q` command)
    - All connections between lanes are STRAIGHT `<line>` elements (vertical lines)
    - All 5 branch types MUST have a visible horizontal line
    - Short-lived branch horizontal lines span ONLY from branch point to merge point
    - The SVG viewBox must contain all elements (no clipping)

    **Keep the same interface:** `GitflowDiagramProps` with `highlightedLane?: GitflowBranchType`. Keep the same imports from branchClassifier.ts.
  </action>
  <verify>
    Run `npx tsc --noEmit 2>&1 | grep -v 'bindings.ts'` — zero errors.

    Verify NO Bezier curves remain:
    ```bash
    grep -c " C " src/components/gitflow/GitflowDiagram.tsx
    # Should return 0 (or only in comments, not in path d= attributes)
    ```

    Verify 5 horizontal lines exist:
    ```bash
    grep -c "LANE_Y\." src/components/gitflow/GitflowDiagram.tsx
    # Should return many references across all 5 lane types
    ```

    Verify CONNECTORS replaced FLOW_CURVES:
    ```bash
    grep -c "FLOW_CURVES" src/components/gitflow/GitflowDiagram.tsx
    # Should return 0
    grep -c "CONNECTOR" src/components/gitflow/GitflowDiagram.tsx
    # Should return multiple
    ```
  </verify>
  <done>
    GitflowDiagram.tsx renders mermaid gitgraph-style SVG with:
    - 5 horizontal branch lanes at distinct Y positions (main, hotfix, release, develop, feature — top to bottom)
    - All branch labels visible on the left
    - Straight vertical line connectors (no curves)
    - Short-lived branch lines are partial-width and dashed
    - Commit dots on ALL 5 lanes
    - Junction dots at connector endpoints
    - Arrowheads on connectors showing flow direction
    - Version labels above main lane
    - "You Are Here" indicator using new lane Y positions
    - TypeScript compiles cleanly
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes (ignoring pre-existing bindings.ts error)
2. Zero `C ` (cubic Bezier) commands in any SVG path d= attribute in GitflowDiagram.tsx
3. FLOW_CURVES array is completely gone — replaced by CONNECTORS
4. All 5 branch types have `<line>` elements at distinct Y positions
5. INDICATOR_Y values match LANE_Y values
6. Short-lived branches have `strokeDasharray` (visually ephemeral)
7. No changes to branchClassifier.ts (colors are correct already)
</verification>

<success_criteria>
- All 5 branch lanes visible as distinct horizontal rows in the SVG
- Zero Bezier curves — all connections are straight vertical lines
- Short-lived branches span only from branch-point to merge-point (partial width)
- Version labels, arrowheads, "You Are Here" indicator all functional
- Visual style matches mermaid gitgraph paradigm (straight lines, not curves)
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/22-new-content-blades/22-26-SUMMARY.md`
</output>
