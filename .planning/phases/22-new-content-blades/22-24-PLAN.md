---
phase: 22-new-content-blades
plan: 24
type: execute
wave: 9
depends_on: []
files_modified:
  - src/components/gitflow/GitflowDiagram.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Gitflow SVG diagram is clear, readable, and follows standard gitflow conventions"
    - "Main branch is at the top of the diagram"
    - "Flow direction is unambiguous via arrowheads on curves"
    - "Short-lived branches appear as temporary arcs, not permanent lanes"
    - "Diagram is legible at default opacity without highlighting"
  artifacts:
    - path: "src/components/gitflow/GitflowDiagram.tsx"
      provides: "Redesigned Gitflow SVG with narrative flow layout"
      contains: "marker.*arrowhead"
  key_links:
    - from: "src/components/gitflow/GitflowDiagram.tsx"
      to: "../../lib/branchClassifier"
      via: "BRANCH_TYPE_COLORS import for lane colors"
      pattern: "BRANCH_TYPE_COLORS"
---

<objective>
Redesign the Gitflow SVG diagram to be clear, readable, and follow canonical gitflow layout conventions.

Purpose: Close UAT gap 3 — the current diagram is reported as "ugly and incomprehensible" due to 7 compounding design issues (no arrowheads, wrong lane order, spaghetti curves, low contrast, no temporal markers, wasted space, and misrepresentation of short-lived branches).
Output: A completely redesigned GitflowDiagram.tsx that follows nvie/Atlassian canonical gitflow visual conventions.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/debug/gitflow-svg-confusing.md
@src/components/gitflow/GitflowDiagram.tsx
@src/lib/branchClassifier.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign GitflowDiagram with canonical gitflow layout</name>
  <files>src/components/gitflow/GitflowDiagram.tsx</files>
  <action>
Completely rewrite the SVG layout in GitflowDiagram.tsx. Keep the same component interface (`GitflowDiagramProps` with `highlightedLane?: GitflowBranchType`), same imports from `branchClassifier`, and same "You Are Here" indicator concept. Replace everything else.

**DESIGN PRINCIPLES (follow the nvie canonical gitflow diagram):**

1. **Lane order top-to-bottom:** main (top), hotfix, release, develop, feature (bottom). This matches the standard convention where main is the most stable (top) and feature is most volatile (bottom).

2. **Horizontal time axis:** Time flows left to right. Main and develop are PERMANENT lanes spanning the full width. Feature, release, and hotfix are SHORT-LIVED — they branch off and merge back as visible arcs, NOT full-width lanes.

3. **Arrowheads:** Every curve MUST have a triangular arrowhead at its endpoint indicating flow direction. Use SVG `<marker>` elements in `<defs>`. Create one marker per branch color using `BRANCH_TYPE_COLORS`. Arrowheads should be small (roughly 8x6 units) and filled with the curve's color.

4. **Narrative flow (left to right):**
   - Start: main and develop lines begin at left edge
   - Feature: branches DOWN from develop, has 2-3 commits, merges back UP to develop
   - Release: branches UP from develop, has 1-2 commits, merges UP to main AND back DOWN to develop
   - Hotfix: branches DOWN from main, has 1 commit, merges DOWN to develop AND stays on main
   - End: main and develop lines continue to right edge

5. **Version labels on main:** Place version tags (e.g., "v1.0", "v2.0") at merge points on main to show temporal progression.

6. **Opacity:** Base opacity 0.85 for non-highlighted elements (NOT 0.55). Active/highlighted elements at 1.0. The diagram must be fully readable without any highlighting.

7. **ViewBox:** Use `0 0 900 340` (wider for narrative flow, less tall since short-lived branches are arcs not full lanes).

8. **Spacing:** Main at Y=50, hotfix at Y=50 (shares main's Y, arcs downward from it), release at Y=50 (same — arcs between develop and main), develop at Y=170, feature at Y=170 (shares develop's Y, arcs downward from it). Permanent lanes (main, develop) are separated by ~120px. Short-lived branch arcs dip 80px above or below their parent lane.

ACTUALLY, use this cleaner layout scheme:

- **Main:** Y=50, permanent lane, full width (x=100 to x=820)
- **Develop:** Y=200, permanent lane, full width (x=100 to x=820)
- **Hotfix arc:** Branches from main at ~x=550, arcs downward to Y=120, merges back to main at ~x=650, also merges down to develop at x=680
- **Release arc:** Branches from develop at ~x=380, arcs upward to Y=130, merges to main at ~x=500, also merges back to develop at ~x=520
- **Feature arc:** Branches from develop at ~x=180, arcs downward to Y=280, merges back to develop at ~x=350

This way:
- Main and develop are the clear spine
- Feature hangs BELOW develop
- Release rises BETWEEN develop and main
- Hotfix drops BETWEEN main and develop (or slightly below main)

**SPECIFIC SVG STRUCTURE:**

```
<defs>
  <!-- Arrow markers, one per color -->
  <marker id="arrow-main" viewBox="0 0 10 8" refX="10" refY="4" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
    <path d="M 0 0 L 10 4 L 0 8 z" fill={BRANCH_TYPE_COLORS.main} />
  </marker>
  <!-- ... same for develop, feature, release, hotfix -->
  <!-- Glow filter (keep existing) -->
</defs>

<!-- Background rect -->
<!-- Main permanent lane line + label + commits -->
<!-- Develop permanent lane line + label + commits -->

<!-- Feature arc: cubic bezier from develop down and back -->
<!-- Release arc: cubic bezier from develop up to main -->
<!-- Hotfix arc: cubic bezier from main down and back, plus merge to develop -->

<!-- Version labels on main (v1.0 at start, v2.0 after release merge, v2.0.1 after hotfix merge) -->
<!-- "You Are Here" indicator -->
```

**COMMIT DOTS:** Place 4-5 dots on main, 5-6 on develop. On each arc, place 2-3 dots along the curve path. Use commit dots with r=4 for normal, r=5 for highlighted.

**LABELS:** Branch labels at the LEFT end of each permanent lane (x=15). For short-lived branch arcs, place the label near the midpoint of the arc (e.g., "feature/*" below the feature arc, "release/*" above the release arc, "hotfix/*" below the hotfix arc).

**CURVE STYLE:** Use cubic Bezier curves (`C` command). Stroke width 2.5 for permanent lanes, 2 for arc curves. `stroke-linecap="round"`.

**KEEP INTACT:**
- `GitflowDiagramProps` interface
- Import of `GitflowBranchType` and `BRANCH_TYPE_COLORS` from branchClassifier
- "You Are Here" indicator concept (pulsing dot + label at right end of relevant lane/arc)
- `role="img"` and `aria-label` on the SVG element
- Glow filter for active lane
- `motion-safe:animate-gentle-pulse` on the indicator

**COLOR MAPPING (unchanged):**
- main: `var(--catppuccin-color-red)`
- develop: `var(--catppuccin-color-blue)`
- feature: `var(--catppuccin-color-green)`
- release: `var(--catppuccin-color-peach)`
- hotfix: `var(--catppuccin-color-mauve)`
  </action>
  <verify>
1. `cd /Users/phmatray/Repositories/github-phm/FlowForge && npx tsc --noEmit 2>&1 | grep -v "bindings.ts"` — no new type errors
2. Open the Gitflow cheatsheet blade in the app
3. Verify visually:
   - Main lane is at the TOP, develop below it
   - Feature branch arcs BELOW develop
   - Release branch arcs BETWEEN develop and main
   - Hotfix branch arcs BETWEEN main and develop
   - ALL curves have visible arrowheads showing flow direction
   - Version labels (v1.0, v2.0, v2.0.1) appear on main
   - Diagram is readable at base opacity (no squinting)
   - "You Are Here" indicator still works on the correct lane
4. Verify the SVG contains `<marker>` elements with arrowhead paths
  </verify>
  <done>Gitflow SVG diagram clearly shows the canonical branching model: main at top, develop below, temporary branch arcs between/below them, arrowheads on all curves, version labels on main, and 0.85+ base opacity for readability.</done>
</task>

</tasks>

<verification>
- GitflowDiagram renders without errors
- SVG layout follows nvie/Atlassian conventions (main at top)
- Arrowheads visible on all branching/merging curves
- Diagram fully readable without lane highlighting
- "You Are Here" indicator correctly positions on highlighted lane
- No TypeScript errors (excluding pre-existing bindings.ts TS2440)
</verification>

<success_criteria>
- UAT Test 7 re-passes: Gitflow SVG is clear, readable, and comprehensible
- Branch/merge direction is unambiguous via arrowheads
- Short-lived branches visually appear as temporary arcs
- Version markers provide temporal context on main
</success_criteria>

<output>
After completion, create `.planning/phases/22-new-content-blades/22-24-SUMMARY.md`
</output>
