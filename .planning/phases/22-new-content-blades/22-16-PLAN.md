---
phase: 22-new-content-blades
plan: 16
type: execute
wave: 2
depends_on: [22-12, 22-13, 22-14, 22-15]
files_modified:
  - src/components/blades/BladeBreadcrumb.tsx
  - src/components/blades/BladePanel.tsx
  - src/components/blades/RepoBrowserBlade.tsx
  - src/lib/bladeUtils.tsx
  - src/lib/bladeTypes.ts
  - src/components/blades/registrations/repo-browser.ts
  - src/components/blades/registrations/viewer-code.ts
  - src/components/blades/registrations/viewer-markdown.ts
  - src/components/blades/registrations/viewer-3d.ts
  - src/components/blades/registrations/viewer-image.ts
  - src/components/blades/registrations/diff.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Repo browser blade header merges back button and breadcrumb into one row"
    - "All viewer and diff blades use the same clickable breadcrumb pattern"
    - "Clicking breadcrumb segments navigates to parent directories"
  artifacts:
    - path: "src/components/blades/BladeBreadcrumb.tsx"
      provides: "Shared breadcrumb component with clickable segments"
      exports: ["BladeBreadcrumb"]
      min_lines: 40
    - path: "src/components/blades/BladePanel.tsx"
      provides: "BladePanel with breadcrumb in titleContent slot"
      exports: ["BladePanel"]
    - path: "src/lib/bladeUtils.tsx"
      provides: "renderPathBreadcrumb helper replacing renderPathTitle"
      exports: ["renderPathBreadcrumb"]
  key_links:
    - from: "BladeBreadcrumb component"
      to: "useBladeNavigation.replaceBlade"
      via: "onClick handlers on segments"
      pattern: "replaceBlade\\(.*repo-browser"
    - from: "blade registrations"
      to: "renderPathBreadcrumb"
      via: "titleContent field"
      pattern: "titleContent:.*renderPathBreadcrumb"
---

<objective>
Unify blade header breadcrumb UX across all blade types

Purpose: Resolve UAT Test 23 (minor) — eliminate the two-row header layout in repo browser; make all viewer and diff blades use consistent clickable breadcrumbs instead of static path display
Output: Shared BladeBreadcrumb component and updated blade registrations
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/debug/blade-header-breadcrumb-ux.md
@src/components/blades/BladePanel.tsx
@src/components/blades/RepoBrowserBlade.tsx
@src/lib/bladeUtils.tsx
@src/lib/bladeTypes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared BladeBreadcrumb component</name>
  <files>src/components/blades/BladeBreadcrumb.tsx</files>
  <action>
Create a new shared breadcrumb component at `src/components/blades/BladeBreadcrumb.tsx`:

```tsx
import { ChevronRight, Home } from "lucide-react";
import { useBladeNavigation } from "@/hooks/useBladeNavigation";

interface BladeBreadcrumbProps {
  path: string;
  className?: string;
}

export function BladeBreadcrumb({ path, className = "" }: BladeBreadcrumbProps) {
  const { replaceBlade } = useBladeNavigation();

  const segments = path.split("/").filter(Boolean);

  const navigateTo = (index: number) => {
    const targetPath = segments.slice(0, index + 1).join("/");
    replaceBlade("repo-browser", { path: targetPath });
  };

  const navigateToRoot = () => {
    replaceBlade("repo-browser", { path: "" });
  };

  return (
    <nav className={`flex items-center gap-1 text-sm ${className}`}>
      <button
        onClick={navigateToRoot}
        className="p-1 rounded hover:bg-ctp-surface0 transition-colors"
        aria-label="Go to repository root"
        title="Repository root"
      >
        <Home className="w-4 h-4" />
      </button>

      {segments.map((segment, index) => (
        <div key={index} className="flex items-center gap-1">
          <ChevronRight className="w-4 h-4 text-ctp-subtext0" />
          <button
            onClick={() => navigateTo(index)}
            className="px-1.5 py-0.5 rounded hover:bg-ctp-surface0 transition-colors"
            title={segments.slice(0, index + 1).join("/")}
          >
            {segment}
          </button>
        </div>
      ))}
    </nav>
  );
}
```

This component:
- Takes a file path as prop
- Renders a Home icon for root navigation
- Splits path into segments with ChevronRight separators
- Each segment is clickable and navigates to that ancestor directory via replaceBlade
- Uses consistent Catppuccin styling matching existing UI
  </action>
  <verify>
Component file exists and exports BladeBreadcrumb; TypeScript compiles without errors
  </verify>
  <done>
BladeBreadcrumb.tsx created with clickable path segments, Home icon, and replaceBlade integration
  </done>
</task>

<task type="auto">
  <name>Task 2: Create renderPathBreadcrumb helper and update registrations</name>
  <files>
    src/lib/bladeUtils.tsx
    src/components/blades/registrations/repo-browser.ts
    src/components/blades/registrations/viewer-code.ts
    src/components/blades/registrations/viewer-markdown.ts
    src/components/blades/registrations/viewer-3d.ts
    src/components/blades/registrations/viewer-image.ts
    src/components/blades/registrations/diff.ts
  </files>
  <action>
**Step 1:** In `src/lib/bladeUtils.tsx`, add new helper function `renderPathBreadcrumb`:

```tsx
import { BladeBreadcrumb } from "@/components/blades/BladeBreadcrumb";

export const renderPathBreadcrumb = (path: string) => {
  return <BladeBreadcrumb path={path} />;
};
```

Export this function alongside existing utilities. Keep `renderPathTitle` for now (we'll deprecate after confirming breadcrumb works).

**Step 2:** Update ALL blade registrations to use breadcrumbs in titleContent:

In each registration file (repo-browser.ts, viewer-code.ts, viewer-markdown.ts, viewer-3d.ts, viewer-image.ts, diff.ts):
- Find the `titleContent` field
- Replace `renderPathTitle(props.path)` with `renderPathBreadcrumb(props.path)`
- For diff.ts, use `renderPathBreadcrumb(props.filePath)` (matches its prop name)

This applies the breadcrumb to all file/path-based blades consistently.
  </action>
  <verify>
TypeScript compiles; all blade types using file paths have breadcrumbs defined in registrations
  </verify>
  <done>
renderPathBreadcrumb helper exists in bladeUtils.tsx; all viewer and diff blade registrations updated to use breadcrumbs in titleContent
  </done>
</task>

<task type="auto">
  <name>Task 3: Remove separate BladeToolbar breadcrumb from RepoBrowserBlade</name>
  <files>src/components/blades/RepoBrowserBlade.tsx</files>
  <action>
RepoBrowserBlade currently renders `<BladeToolbar><Breadcrumbs /></BladeToolbar>` as a child, creating a second row below the BladePanel header. Remove this.

Find the BladeToolbar section containing Breadcrumbs (should be near the top of the component's return statement). Delete the entire BladeToolbar wrapper and its Breadcrumbs child.

The breadcrumb will now come from the registration's `titleContent` field (set in Task 2), appearing in the BladePanel header row alongside the back button — achieving the one-row layout.

Also remove the Breadcrumbs import if no longer used, and the BladeToolbar import if this was the only usage.
  </action>
  <verify>
RepoBrowserBlade.tsx no longer contains BladeToolbar or Breadcrumbs in its render; TypeScript compiles; no unused imports remain
  </verify>
  <done>
RepoBrowserBlade no longer renders separate toolbar breadcrumb; breadcrumb appears in header via titleContent
  </done>
</task>

</tasks>

<verification>
Open repo browser → breadcrumb should appear in same row as back button (not separate row). Click Home icon → navigates to root. Click breadcrumb segment → navigates to that directory. Open any viewer blade (.md, .tsx, .glb) → breadcrumb in header, same one-row layout. Open diff blade → breadcrumb in header.
</verification>

<success_criteria>
- UAT Test 23 passes: Repo browser blade header is a single row with back button and breadcrumb merged
- All viewer blades (code, markdown, 3D, image) use clickable breadcrumbs instead of static path display
- DiffBlade uses clickable breadcrumbs for file path
- Clicking breadcrumb segments navigates to ancestor directories
- Home icon navigates to repository root
- No visual regressions in blade headers
</success_criteria>

<output>
After completion, create `.planning/phases/22-new-content-blades/22-16-SUMMARY.md`
</output>
