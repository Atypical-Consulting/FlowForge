---
phase: 45-init-repo-extraction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/extensions/init-repo/index.ts
  - src/extensions/init-repo/store.ts
  - src/extensions/init-repo/components/index.ts
  - src/extensions/init-repo/components/InitRepoBlade.tsx
  - src/extensions/init-repo/components/InitRepoForm.tsx
  - src/extensions/init-repo/components/InitRepoPreview.tsx
  - src/extensions/init-repo/components/TemplatePicker.tsx
  - src/extensions/init-repo/components/TemplateChips.tsx
  - src/extensions/init-repo/components/CategoryFilter.tsx
  - src/extensions/init-repo/components/ProjectDetectionBanner.tsx
  - src/App.tsx
  - src/blades/_discovery.ts
autonomous: true

must_haves:
  truths:
    - "Init Repo extension activates at app mount via registerBuiltIn before any repository is opened"
    - "Init Repo blade type 'init-repo' appears in BladeRegistry with coreOverride (no ext: prefix)"
    - "Init Repo command 'Initialize Repository' appears in command palette when extension is active"
    - "Init Repo blade store lives at src/extensions/init-repo/store.ts (not in src/blades/)"
    - "No files remain in src/blades/init-repo/ directory after extraction"
    - "Store resets when extension is disabled via api.onDispose"
  artifacts:
    - path: "src/extensions/init-repo/index.ts"
      provides: "Extension entry point with onActivate/onDeactivate"
      exports: ["onActivate", "onDeactivate"]
    - path: "src/extensions/init-repo/store.ts"
      provides: "Zustand blade store for Init Repo"
      exports: ["useInitRepoStore"]
    - path: "src/extensions/init-repo/components/InitRepoBlade.tsx"
      provides: "Main Init Repo blade component"
      exports: ["InitRepoBlade"]
    - path: "src/extensions/init-repo/components/index.ts"
      provides: "Barrel export for components"
  key_links:
    - from: "src/extensions/init-repo/index.ts"
      to: "src/lib/bladeRegistry.ts"
      via: "api.registerBlade({ type: 'init-repo', coreOverride: true })"
      pattern: "registerBlade.*init-repo.*coreOverride"
    - from: "src/App.tsx"
      to: "src/extensions/init-repo/index.ts"
      via: "registerBuiltIn({ id: 'init-repo', activate: initRepoActivate })"
      pattern: "registerBuiltIn.*init-repo"
    - from: "src/extensions/init-repo/components/InitRepoBlade.tsx"
      to: "src/extensions/init-repo/store.ts"
      via: "useInitRepoStore import"
      pattern: "useInitRepoStore"
---

<objective>
Extract the Init Repo blade from core (`src/blades/init-repo/`) into a toggleable built-in extension (`src/extensions/init-repo/`), register it via `registerBuiltIn()` in App.tsx for early activation, and clean up the old directory.

Purpose: Moves Init Repo to the extension system so users can toggle it on/off from Extension Manager, consistent with the "Extensions Everywhere" architecture. This is unique because Init Repo must activate before any repository is open (WelcomeView context).

Output: Complete `src/extensions/init-repo/` extension directory with entry point, store, and all components. Old `src/blades/init-repo/` directory deleted.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Extension pattern reference
@src/extensions/conventional-commits/index.ts
@src/extensions/worktrees/index.tsx

# Current Init Repo files (source of truth for content)
@src/blades/init-repo/registration.ts
@src/blades/init-repo/store.ts
@src/blades/init-repo/InitRepoBlade.tsx
@src/blades/init-repo/components/InitRepoForm.tsx
@src/blades/init-repo/components/InitRepoPreview.tsx
@src/blades/init-repo/components/TemplatePicker.tsx
@src/blades/init-repo/components/TemplateChips.tsx
@src/blades/init-repo/components/CategoryFilter.tsx
@src/blades/init-repo/components/ProjectDetectionBanner.tsx

# Integration points
@src/App.tsx
@src/blades/_discovery.ts
@src/components/WelcomeView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create extension entry point, move store and components</name>
  <files>
    src/extensions/init-repo/index.ts
    src/extensions/init-repo/store.ts
    src/extensions/init-repo/components/index.ts
    src/extensions/init-repo/components/InitRepoBlade.tsx
    src/extensions/init-repo/components/InitRepoForm.tsx
    src/extensions/init-repo/components/InitRepoPreview.tsx
    src/extensions/init-repo/components/TemplatePicker.tsx
    src/extensions/init-repo/components/TemplateChips.tsx
    src/extensions/init-repo/components/CategoryFilter.tsx
    src/extensions/init-repo/components/ProjectDetectionBanner.tsx
  </files>
  <action>
    Create the Init Repo extension directory and all files:

    1. **Create `src/extensions/init-repo/index.ts`** -- Extension entry point following the conventional-commits pattern:
       - Import `lazy` from "react", `FolderGit2` from "lucide-react", `ExtensionAPI` type from "../ExtensionAPI"
       - `onActivate(api)`:
         - Create lazy component: `const InitRepoBlade = lazy(() => import("./components/InitRepoBlade").then(m => ({ default: m.InitRepoBlade })))`
         - `api.registerBlade({ type: "init-repo", title: "Initialize Repository", component: InitRepoBlade, singleton: true, lazy: true, coreOverride: true })` -- coreOverride preserves the "init-repo" type string so WelcomeView's `useBladeRegistry(s => s.blades.get("init-repo"))` continues working
         - Register command: `api.registerCommand({ id: "init-repository", title: "Initialize Repository", description: "Set up a new Git repository with .gitignore templates, README, and initial commit", category: "Repository", icon: FolderGit2, keywords: ["init", "initialize", "new", "repository", "git", "create"], action: async () => { /* open directory picker, check isGitRepository, open blade via openBlade if not a repo */ } })`
         - For the command action: lazy-import `open` from "@tauri-apps/plugin-dialog", `commands` from "../../bindings", `openBlade` from "../../lib/bladeOpener". Open directory picker, check `commands.isGitRepository(selected)`, if not a repo call `openBlade("init-repo", { directoryPath: selected })`
         - `api.onDispose(() => { import("./store").then(m => m.useInitRepoStore.getState().reset()) })` to reset store on extension disable
       - `onDeactivate()`: empty body (api.cleanup() handles all unregistrations)

    2. **Move `src/blades/init-repo/store.ts` to `src/extensions/init-repo/store.ts`** -- Copy exact content. Import path `../../stores/createBladeStore` stays the same (same directory depth: `src/extensions/init-repo/` vs `src/blades/init-repo/`). No content changes needed.

    3. **Move `src/blades/init-repo/InitRepoBlade.tsx` to `src/extensions/init-repo/components/InitRepoBlade.tsx`** -- This file moves one level deeper (from blade root to components/). Update imports:
       - `../../bindings` becomes `../../../bindings`
       - `../../hooks/useGitignoreTemplates` becomes `../../../hooks/useGitignoreTemplates`
       - `./store` becomes `../store`
       - `../../components/layout/SplitPaneLayout` becomes `../../../components/layout/SplitPaneLayout`
       - `./components/InitRepoForm` becomes `./InitRepoForm`
       - `./components/InitRepoPreview` becomes `./InitRepoPreview`

    4. **Move all 6 component files** from `src/blades/init-repo/components/` to `src/extensions/init-repo/components/`:
       - `InitRepoForm.tsx`, `InitRepoPreview.tsx`, `TemplatePicker.tsx`, `TemplateChips.tsx`, `CategoryFilter.tsx`, `ProjectDetectionBanner.tsx`
       - Import paths using `../store` remain `../store` (same relative depth)
       - Import paths using `../../../` (reaching `src/`) remain `../../../` (same: `src/extensions/init-repo/components/` has same depth as `src/blades/init-repo/components/`)
       - **No import path changes needed for these 6 files**

    5. **Create `src/extensions/init-repo/components/index.ts`** -- Barrel export:
       ```typescript
       export { InitRepoBlade } from "./InitRepoBlade";
       ```
  </action>
  <verify>
    - All 10 files exist in `src/extensions/init-repo/`
    - `npx tsc --noEmit 2>&1 | grep -v "TS2440"` shows no new TypeScript errors from the extension files
    - `grep -r "coreOverride" src/extensions/init-repo/index.ts` returns the blade registration with coreOverride: true
    - `grep "registerCommand" src/extensions/init-repo/index.ts` returns the command registration
  </verify>
  <done>
    Extension directory at `src/extensions/init-repo/` contains entry point with onActivate/onDeactivate, store with useInitRepoStore, and all 7 component files with correct import paths. Blade registered with coreOverride: true, command registered under "Repository" category.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire extension into App.tsx, clean up old directory, update _discovery.ts</name>
  <files>
    src/App.tsx
    src/blades/_discovery.ts
  </files>
  <action>
    1. **Update `src/App.tsx`**:
       - Add import: `import { onActivate as initRepoActivate, onDeactivate as initRepoDeactivate } from "./extensions/init-repo";`
       - Add `registerBuiltIn` call in the first useEffect block (after the worktrees registration, before the github registration):
         ```typescript
         registerBuiltIn({
           id: "init-repo",
           name: "Init Repository",
           version: "1.0.0",
           activate: initRepoActivate,
           deactivate: initRepoDeactivate,
         });
         ```
       - This activates Init Repo at app mount (before any repository is open), which is critical for WelcomeView's BladeRegistry lookup

    2. **Update `src/blades/_discovery.ts`**:
       - Remove `"init-repo"` from the EXPECTED_TYPES array (line 20). The blade type is now registered by the extension, not by a `registration.ts` file. The array should become:
         ```typescript
         const EXPECTED_TYPES: string[] = [
           "staging-changes", "topology-graph", "commit-details", "diff",
           "viewer-nupkg", "viewer-image", "viewer-plaintext", "repo-browser", "settings",
           "extension-manager", "extension-detail",
         ];
         ```

    3. **Delete the entire `src/blades/init-repo/` directory** -- all files have been moved to the extension. Delete:
       - `src/blades/init-repo/registration.ts`
       - `src/blades/init-repo/index.ts`
       - `src/blades/init-repo/store.ts`
       - `src/blades/init-repo/InitRepoBlade.tsx`
       - `src/blades/init-repo/components/InitRepoForm.tsx`
       - `src/blades/init-repo/components/InitRepoPreview.tsx`
       - `src/blades/init-repo/components/TemplatePicker.tsx`
       - `src/blades/init-repo/components/TemplateChips.tsx`
       - `src/blades/init-repo/components/CategoryFilter.tsx`
       - `src/blades/init-repo/components/ProjectDetectionBanner.tsx`
       - `src/blades/init-repo/components/` directory
       - `src/blades/init-repo/` directory
  </action>
  <verify>
    - `ls src/blades/init-repo 2>&1` returns "No such file or directory"
    - `grep "init-repo" src/App.tsx` shows the registerBuiltIn call with id "init-repo"
    - `grep "init-repo" src/blades/_discovery.ts` returns NO matches (removed from EXPECTED_TYPES)
    - `npx tsc --noEmit 2>&1 | grep -v "TS2440"` shows no new TypeScript errors
  </verify>
  <done>
    App.tsx registers Init Repo as a built-in extension via registerBuiltIn. Old src/blades/init-repo/ directory is completely removed. _discovery.ts no longer expects "init-repo" in EXPECTED_TYPES. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit 2>&1 | grep -v "TS2440"` -- TypeScript compiles with no new errors
2. `ls src/extensions/init-repo/` -- Extension directory exists with index.ts, store.ts, components/
3. `ls src/blades/init-repo 2>&1` -- Old directory is deleted
4. `grep "registerBuiltIn" src/App.tsx | grep "init-repo"` -- Extension registered in App.tsx
5. `grep "init-repo" src/blades/_discovery.ts` -- Not in EXPECTED_TYPES
6. `grep "coreOverride" src/extensions/init-repo/index.ts` -- Blade uses coreOverride: true
</verification>

<success_criteria>
- Init Repo extension exists at src/extensions/init-repo/ with entry point, store, and all components
- Extension activates via registerBuiltIn in App.tsx first useEffect (early activation)
- Blade registered with coreOverride: true preserving "init-repo" type
- Command "Initialize Repository" registered in palette under "Repository" category
- Store reset on dispose via api.onDispose
- Old src/blades/init-repo/ directory fully deleted
- _discovery.ts updated to remove "init-repo" from EXPECTED_TYPES
- TypeScript compiles cleanly (ignoring pre-existing TS2440)
</success_criteria>

<output>
After completion, create `.planning/phases/45-init-repo-extraction/45-01-SUMMARY.md`
</output>
