---
phase: 45-init-repo-extraction
plan: 02
type: execute
wave: 2
depends_on: ["45-01"]
files_modified:
  - src/components/WelcomeView.tsx
  - src/components/welcome/GitInitFallbackBanner.tsx
autonomous: true

must_haves:
  truths:
    - "WelcomeView renders Init Repo blade via BladeRegistry lookup when extension is enabled"
    - "WelcomeView shows a 'Run git init' fallback button when Init Repo extension is disabled"
    - "Fallback button calls commands.gitInit(path, 'main') then opens the repository"
    - "If user is viewing Init Repo blade when extension is disabled, WelcomeView resets to show fallback banner"
    - "Fallback banner includes info text about enabling the Init Repo extension"
  artifacts:
    - path: "src/components/welcome/GitInitFallbackBanner.tsx"
      provides: "Fallback banner for when Init Repo extension is disabled"
      exports: ["GitInitFallbackBanner"]
    - path: "src/components/WelcomeView.tsx"
      provides: "Updated WelcomeView with fallback handling"
  key_links:
    - from: "src/components/WelcomeView.tsx"
      to: "src/lib/bladeRegistry.ts"
      via: "useBladeRegistry((s) => s.blades.get('init-repo'))"
      pattern: "blades\\.get.*init-repo"
    - from: "src/components/WelcomeView.tsx"
      to: "src/components/welcome/GitInitFallbackBanner.tsx"
      via: "conditional render when initRepoRegistration is undefined"
      pattern: "GitInitFallbackBanner"
    - from: "src/components/welcome/GitInitFallbackBanner.tsx"
      to: "src/bindings.ts"
      via: "commands.gitInit call for basic initialization"
      pattern: "commands\\.gitInit"
---

<objective>
Add WelcomeView fallback UI for when the Init Repo extension is disabled, ensuring graceful degradation from the full Init Repo blade to a simple "Run git init" button.

Purpose: Users who disable the Init Repo extension should still be able to initialize a basic git repository. The fallback provides minimal but functional git init capability with an info tip about enabling the extension for the full experience.

Output: GitInitFallbackBanner component and updated WelcomeView with fallback rendering logic.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/45-init-repo-extraction/45-01-SUMMARY.md

# Key source files
@src/components/WelcomeView.tsx
@src/components/welcome/GitInitBanner.tsx
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitInitFallbackBanner and update WelcomeView fallback logic</name>
  <files>
    src/components/welcome/GitInitFallbackBanner.tsx
    src/components/WelcomeView.tsx
  </files>
  <action>
    1. **Create `src/components/welcome/GitInitFallbackBanner.tsx`**:
       - A banner component shown when a non-git folder is selected AND the Init Repo extension is disabled
       - Props: `{ path: string; onDismiss: () => void; onComplete: (path: string) => void }`
       - Visual design matching GitInitBanner (same container: `bg-ctp-surface0/50 backdrop-blur-sm border border-ctp-surface1 rounded-lg p-4`, same `fadeInUp` framer-motion animation)
       - Content:
         - GitBranch icon (ctp-blue) + title "This folder is not a Git repository"
         - Description: Initialize "[folderName]" as a Git repository.
         - Two buttons: "Run git init" (primary, sm, with FolderGit2 icon) and "Dismiss" (ghost, sm)
         - Info text below buttons: `<Info className="w-3.5 h-3.5" />` + "Enable the Init Repo extension in Settings > Extensions for .gitignore templates, README setup, and more." using `text-ctp-overlay0 text-xs`
       - Button behavior:
         - "Run git init" button: `useState` for `isInitializing` loading state
         - On click: set `isInitializing(true)`, call `commands.gitInit(path, "main")`, on success call `onComplete(path)`, on error show error state with `text-ctp-red` message, set `isInitializing(false)`
         - Loading state: show `<Loader2 className="w-4 h-4 animate-spin" />` with text "Initializing..." (same pattern as InitRepoForm)
       - Accessibility: `role="region"` with `aria-label="Git repository initialization"`, `aria-busy={isInitializing}` on the button during init
       - Import from: `framer-motion`, `lucide-react` (GitBranch, FolderGit2, Info, Loader2), `../../lib/animations` (fadeInUp), `../../bindings` (commands), `../ui/button` (Button)

    2. **Update `src/components/WelcomeView.tsx`**:

       a. **Import GitInitFallbackBanner:**
          Add to the imports from `./welcome`: `import { AnimatedGradientBg, GitInitBanner, GitInitFallbackBanner } from "./welcome";`
          This requires updating the `src/components/welcome/index.ts` barrel to export GitInitFallbackBanner (create this if it doesn't exist, or update the existing one).

       b. **Add mid-session disable recovery:**
          Add a `useEffect` after the existing `initRepoRegistration` line (around line 25). When `showInitRepo` is true AND `initRepoRegistration` becomes `undefined`, reset `showInitRepo` to false so the user isn't stuck on the "Preparing repository setup..." screen:
          ```typescript
          useEffect(() => {
            if (showInitRepo && !initRepoRegistration) {
              setShowInitRepo(false);
            }
          }, [showInitRepo, initRepoRegistration]);
          ```
          This handles the case where a user is viewing the Init Repo blade and the extension is disabled mid-session.

       c. **Update the banner conditional rendering:**
          Change the `pendingInitPath && !error && !showInitRepo` block (line 255-261) to conditionally render GitInitBanner or GitInitFallbackBanner based on extension availability:
          ```typescript
          {pendingInitPath && !error && !showInitRepo && (
            initRepoRegistration ? (
              <GitInitBanner
                path={pendingInitPath}
                onDismiss={() => setPendingInitPath(null)}
                onSetup={() => setShowInitRepo(true)}
              />
            ) : (
              <GitInitFallbackBanner
                path={pendingInitPath}
                onDismiss={() => setPendingInitPath(null)}
                onComplete={async (path) => {
                  await openRepository(path);
                  await addRecentRepo(path);
                  setPendingInitPath(null);
                }}
              />
            )
          )}
          ```

       d. **Update the welcome barrel export** at `src/components/welcome/index.ts` (if it exists) to include `GitInitFallbackBanner`. If no barrel exists and GitInitBanner is imported directly, adjust the import path accordingly.
  </action>
  <verify>
    - `grep "GitInitFallbackBanner" src/components/WelcomeView.tsx` returns the conditional render
    - `grep "commands.gitInit" src/components/welcome/GitInitFallbackBanner.tsx` returns the git init call
    - `grep "showInitRepo.*initRepoRegistration" src/components/WelcomeView.tsx` returns the mid-session disable useEffect
    - `npx tsc --noEmit 2>&1 | grep -v "TS2440"` shows no new TypeScript errors
    - GitInitFallbackBanner component exists with correct props, loading state, and info text
  </verify>
  <done>
    WelcomeView shows full GitInitBanner (with "Set Up Repository") when Init Repo extension is enabled, and GitInitFallbackBanner (with "Run git init") when extension is disabled. Mid-session disable resets showInitRepo to prevent stuck loading screen. Fallback calls commands.gitInit(path, "main") then opens the repository.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit 2>&1 | grep -v "TS2440"` -- TypeScript compiles with no new errors
2. GitInitFallbackBanner component exists at `src/components/welcome/GitInitFallbackBanner.tsx`
3. WelcomeView conditionally renders GitInitBanner vs GitInitFallbackBanner based on `initRepoRegistration`
4. Mid-session disable useEffect resets `showInitRepo` when `initRepoRegistration` becomes undefined
5. Fallback banner has correct styling (matches GitInitBanner visual design), info text, and loading state
</verification>

<success_criteria>
- GitInitFallbackBanner created with "Run git init" button that calls commands.gitInit(path, "main")
- WelcomeView renders GitInitBanner when extension enabled, GitInitFallbackBanner when disabled
- Mid-session extension disable resets showInitRepo to prevent stuck state
- Fallback banner matches Catppuccin Mocha theme and GitInitBanner styling
- Info text guides users to Settings > Extensions for full experience
- Loading state with spinner during git init operation
- TypeScript compiles cleanly (ignoring pre-existing TS2440)
</success_criteria>

<output>
After completion, create `.planning/phases/45-init-repo-extraction/45-02-SUMMARY.md`
</output>
