---
phase: 17-hierarchical-view-commit-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/commit-type-theme.ts
  - src/components/icons/CommitTypeIcon.tsx
  - src/components/topology/CommitBadge.tsx
  - src/components/commit/TypeSelector.tsx
  - src/components/commit/CommitHistory.tsx
autonomous: true

must_haves:
  truths:
    - "Each conventional commit type (feat, fix, docs, etc.) displays its icon in a distinct, recognizable color in the topology graph"
    - "Each conventional commit type displays its icon in a distinct, recognizable color in the commit history list"
    - "The commit type color mapping is defined in exactly one shared module, not duplicated across components"
  artifacts:
    - path: "src/lib/commit-type-theme.ts"
      provides: "Single source of truth for commit type icons, colors, and badge styles"
      exports: ["COMMIT_TYPE_ICONS", "COMMIT_TYPE_COLORS", "COMMIT_TYPE_BADGE_COLORS", "ConventionalCommitType"]
    - path: "src/components/icons/CommitTypeIcon.tsx"
      provides: "Reusable commit type icon component with optional color"
      exports: ["CommitTypeIcon"]
    - path: "src/components/topology/CommitBadge.tsx"
      provides: "Topology commit badge with colored type icons"
    - path: "src/components/commit/CommitHistory.tsx"
      provides: "Commit history list with colored type icons per commit"
  key_links:
    - from: "src/lib/commit-type-theme.ts"
      to: "src/components/icons/CommitTypeIcon.tsx"
      via: "import COMMIT_TYPE_ICONS, COMMIT_TYPE_COLORS"
      pattern: "import.*commit-type-theme"
    - from: "src/components/icons/CommitTypeIcon.tsx"
      to: "src/components/commit/CommitHistory.tsx"
      via: "CommitTypeIcon component usage"
      pattern: "<CommitTypeIcon"
    - from: "src/lib/commit-type-theme.ts"
      to: "src/components/topology/CommitBadge.tsx"
      via: "import COMMIT_TYPE_ICONS, COMMIT_TYPE_COLORS"
      pattern: "import.*commit-type-theme"
---

<objective>
Create a shared commit-type theme module and apply colored conventional commit icons across the topology graph and commit history.

Purpose: Consolidate the duplicated commit type icon/color mappings (currently in TypeSelector.tsx and CommitBadge.tsx) into a single shared module, then apply distinct Catppuccin colors per commit type throughout the UI. This satisfies requirement CCMT-01 and provides the foundation for CCMT-02 (changelog icons in Plan 03).

Output: A shared `commit-type-theme.ts` module, a reusable `CommitTypeIcon` component, and colored commit type icons in the topology graph badges and commit history list.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-hierarchical-view-commit-enhancements/17-RESEARCH.md

@src/components/topology/CommitBadge.tsx
@src/components/commit/TypeSelector.tsx
@src/components/commit/CommitHistory.tsx
@src/components/topology/layoutUtils.ts
@src/stores/conventional.ts
@src/components/icons/FileTypeIcon.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared commit-type-theme module and CommitTypeIcon component</name>
  <files>src/lib/commit-type-theme.ts, src/components/icons/CommitTypeIcon.tsx</files>
  <action>
**Create `src/lib/commit-type-theme.ts`:**

Extract and consolidate the commit type icon/color mappings that currently exist in `TypeSelector.tsx` (TYPE_ICONS + TYPE_COLORS) and `CommitBadge.tsx` (ICON_MAP). This module becomes the single source of truth.

Define the following exports:

1. `ConventionalCommitType` - A TypeScript union type of all 11 conventional commit types: `"feat" | "fix" | "docs" | "style" | "refactor" | "perf" | "test" | "chore" | "ci" | "build" | "revert"`

2. `COMMIT_TYPE_ICONS: Record<ConventionalCommitType, ElementType>` - Maps each type to its Lucide icon:
   - feat: Sparkles, fix: Bug, docs: FileText, style: Paintbrush, refactor: Hammer, perf: Zap, test: TestTube, chore: Settings, ci: Rocket, build: Package, revert: Undo

3. `COMMIT_TYPE_COLORS: Record<ConventionalCommitType, string>` - Text-only color classes for icon coloring:
   - feat: "text-ctp-green", fix: "text-ctp-red", docs: "text-ctp-blue", style: "text-ctp-pink", refactor: "text-ctp-peach", perf: "text-ctp-yellow", test: "text-ctp-teal", chore: "text-ctp-lavender", ci: "text-ctp-sky", build: "text-ctp-maroon", revert: "text-ctp-mauve"

4. `COMMIT_TYPE_BADGE_COLORS: Record<ConventionalCommitType, string>` - Full badge styles (text + bg + border) for use in TypeSelector and similar badge contexts:
   - feat: "text-ctp-green bg-ctp-green/10 border-ctp-green/30" (and so on for each type -- identical to existing TYPE_COLORS in TypeSelector.tsx)

Import `ElementType` from "react" and all Lucide icons at the top.

**Create `src/components/icons/CommitTypeIcon.tsx`:**

A reusable component that renders the appropriate colored icon for a conventional commit type.

Props interface `CommitTypeIconProps`:
- `commitType?: ConventionalCommitType` - Pass a type directly
- `message?: string` - OR pass a commit message to parse (uses `parseConventionalType` from `layoutUtils.ts`)
- `className?: string` - Additional CSS classes
- `colored?: boolean` - Whether to apply the type's color (default: true)

Implementation:
1. Determine the type: use `commitType` if provided, otherwise parse from `message` using `parseConventionalType`
2. Look up the icon from `COMMIT_TYPE_ICONS`. If type is null or not found, fall back to `GitCommit` from lucide-react
3. Look up the color from `COMMIT_TYPE_COLORS` if `colored` is true
4. Render: `<Icon className={cn("w-4 h-4 shrink-0", colorClass, className)} />`

Import `cn` from `../../lib/utils`, `parseConventionalType` from `../topology/layoutUtils`, and `GitCommit` from `lucide-react`.
  </action>
  <verify>
Run `npx tsc --noEmit 2>&1 | grep -v "bindings.ts"` -- no new TypeScript errors. Verify files exist with `ls src/lib/commit-type-theme.ts src/components/icons/CommitTypeIcon.tsx`.
  </verify>
  <done>
`src/lib/commit-type-theme.ts` exports COMMIT_TYPE_ICONS, COMMIT_TYPE_COLORS, COMMIT_TYPE_BADGE_COLORS, and ConventionalCommitType. `src/components/icons/CommitTypeIcon.tsx` exports a working CommitTypeIcon component that renders colored icons by type or message parsing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor existing consumers to use shared module and apply colored icons</name>
  <files>src/components/topology/CommitBadge.tsx, src/components/commit/TypeSelector.tsx, src/components/commit/CommitHistory.tsx</files>
  <action>
**Refactor `src/components/topology/CommitBadge.tsx`:**

1. Remove the local `ICON_MAP` constant and all its Lucide icon imports (Bug, FileText, Hammer, Package, Paintbrush, Rocket, Settings, Sparkles, TestTube, Undo, Zap)
2. Add imports: `import { COMMIT_TYPE_ICONS, COMMIT_TYPE_COLORS, type ConventionalCommitType } from "../../lib/commit-type-theme";`
3. Keep `GitCommit` import from lucide-react (used as fallback)
4. Update the icon lookup logic:
   ```
   const Icon = (commitType && COMMIT_TYPE_ICONS[commitType as ConventionalCommitType]) || GitCommit;
   const iconColor = commitType
     ? COMMIT_TYPE_COLORS[commitType as ConventionalCommitType]
     : "text-ctp-overlay1";
   ```
5. Apply the color to the Icon in JSX: change `<Icon className="w-3 h-3 text-ctp-overlay1 shrink-0" />` to `<Icon className={cn("w-3 h-3 shrink-0", iconColor)} />`
6. Ensure `cn` is still imported from `../../lib/utils`

**Refactor `src/components/commit/TypeSelector.tsx`:**

1. Remove the local `TYPE_ICONS` and `TYPE_COLORS` constants
2. Remove all Lucide icon imports (Bug, FileText, Hammer, Package, Paintbrush, Rocket, Settings, Sparkles, TestTube, Undo, Zap)
3. Add imports: `import { COMMIT_TYPE_ICONS, COMMIT_TYPE_BADGE_COLORS } from "../../lib/commit-type-theme";`
4. Update the grid button rendering:
   - Change `const Icon = TYPE_ICONS[type];` to `const Icon = COMMIT_TYPE_ICONS[type];`
   - Change `TYPE_COLORS[type]` to `COMMIT_TYPE_BADGE_COLORS[type]` in the className conditional
5. Verify the import of `CommitType` from `../../stores/conventional` still works (it's the same type, just imported differently)

**Refactor `src/components/commit/CommitHistory.tsx`:**

1. Remove the `GitCommit` import from lucide-react (the standalone icon usage) -- keep `Loader2`
2. Add import: `import { CommitTypeIcon } from "../icons/CommitTypeIcon";`
3. In the Virtuoso `itemContent` render, replace the generic `GitCommit` icon:
   - Find: `<GitCommit className="w-4 h-4 text-ctp-overlay0 mt-0.5 shrink-0" />`
   - Replace with: `<CommitTypeIcon message={commit.messageSubject} className="mt-0.5" />`
4. Keep the `GitCommit` icon import ONLY if it's used elsewhere in the file (check the EmptyState usage). Looking at the code: `GitCommit` is used in the EmptyState component's `icon` prop. So KEEP the `GitCommit` import but it's now only used in EmptyState, not in the commit list item.
5. Summary of imports: keep `{ GitCommit, Loader2 }` from "lucide-react", add `{ CommitTypeIcon }` from "../icons/CommitTypeIcon"
  </action>
  <verify>
Run `npx tsc --noEmit 2>&1 | grep -v "bindings.ts"` -- no new TypeScript errors. Run `npm run build` to verify the app builds without errors. Visually: the commit type icons in CommitBadge should now show colored icons instead of monochrome gray.
  </verify>
  <done>
CommitBadge shows colored commit type icons per type. CommitHistory shows colored commit type icons per commit message. TypeSelector uses the shared module instead of local constants. No duplicate icon/color mappings remain in any component -- `commit-type-theme.ts` is the single source of truth.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit 2>&1 | grep -v "bindings.ts"` reports no errors
2. `npm run build` succeeds
3. `grep -r "ICON_MAP" src/components/topology/CommitBadge.tsx` returns no matches (local map removed)
4. `grep -r "TYPE_ICONS\|TYPE_COLORS" src/components/commit/TypeSelector.tsx` matches only the imported names, not local `const` declarations
5. `grep -r "import.*commit-type-theme" src/` shows imports from CommitBadge.tsx, TypeSelector.tsx, and CommitTypeIcon.tsx
6. `grep -r "CommitTypeIcon" src/components/commit/CommitHistory.tsx` confirms CommitTypeIcon is used
</verification>

<success_criteria>
- Each conventional commit type has a distinct colored icon in the topology graph (CommitBadge)
- Each conventional commit type has a distinct colored icon in the commit history list (CommitHistory)
- Commit type icon/color definitions exist in exactly one file (src/lib/commit-type-theme.ts)
- TypeSelector uses the shared module and visual behavior is unchanged
- TypeScript compilation passes with no new errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-hierarchical-view-commit-enhancements/17-01-SUMMARY.md`
</output>
