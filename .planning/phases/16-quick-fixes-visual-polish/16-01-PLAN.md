---
phase: 16-quick-fixes-visual-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/dialog.tsx
  - src/index.css
  - src/components/blades/BladeContainer.tsx
  - src/lib/animations.ts
autonomous: true

must_haves:
  truths:
    - "Modals appear centered on screen immediately with no flicker or position jump"
    - "Blade panels slide in with a subtle animation that does not feel aggressive or jarring"
  artifacts:
    - path: "src/components/ui/dialog.tsx"
      provides: "Flicker-free modal with framer-motion"
      contains: "AnimatePresence"
    - path: "src/components/blades/BladeContainer.tsx"
      provides: "Subtle blade slide animation"
      contains: "tween"
    - path: "src/lib/animations.ts"
      provides: "Updated bladeSlideIn variant"
      contains: "x: 40"
  key_links:
    - from: "src/components/ui/dialog.tsx"
      to: "framer-motion"
      via: "motion.div for content + overlay"
      pattern: "motion\\.div"
    - from: "src/components/blades/BladeContainer.tsx"
      to: "src/lib/animations.ts"
      via: "consistent tween transition"
      pattern: "tween"
---

<objective>
Fix modal flicker (UIPX-01) and make blade slide animation subtler (UIPX-02).

Purpose: Modals currently flicker in the top-left corner before animating to center because CSS keyframes fight with Tailwind positioning. Blade panels slide in with an aggressive spring from 100% off-screen. Both need smoother, more polished animations.

Output: Flicker-free modals using framer-motion AnimatePresence, and subtle blade tween animation from 40px offset.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/ui/dialog.tsx
@src/index.css
@src/components/blades/BladeContainer.tsx
@src/lib/animations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix modal flicker with framer-motion AnimatePresence</name>
  <files>src/components/ui/dialog.tsx, src/index.css</files>
  <action>
Replace CSS keyframe animations in dialog.tsx with framer-motion for both overlay and content.

In `src/components/ui/dialog.tsx`:
1. Add import: `import { AnimatePresence, motion } from "framer-motion";`
2. Remove the CSS keyframe class from `dialogContentVariants` base string. Remove `animate-[dialog-content-show_150ms_ease-out]` from the base classes.
3. Wrap the entire return of `DialogContent` in `<AnimatePresence mode="wait">` OUTSIDE the conditional:
   ```tsx
   return (
     <AnimatePresence mode="wait">
       {open && (
         <>
           <motion.div ... /> {/* overlay */}
           <motion.div ... /> {/* content */}
         </>
       )}
     </AnimatePresence>
   );
   ```
4. Replace the overlay `<div>` with a `<motion.div>` that has:
   ```
   initial={{ opacity: 0 }}
   animate={{ opacity: 1 }}
   exit={{ opacity: 0 }}
   transition={{ duration: 0.15, ease: "easeOut" }}
   ```
   Remove `animate-[dialog-overlay-show_150ms_ease-out]` class from it.
5. Replace the content `<div>` (role="dialog") with a `<motion.div>` that has:
   ```
   initial={{ opacity: 0, scale: 0.96 }}
   animate={{ opacity: 1, scale: 1 }}
   exit={{ opacity: 0, scale: 0.96 }}
   transition={{ duration: 0.15, ease: "easeOut" }}
   ```
   Keep all existing classes, refs, onClick, role, aria-modal, children.

IMPORTANT: Do NOT animate `translate` or position properties. The dialog is positioned via Tailwind CSS classes (`fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2`). Only animate `opacity` and `scale`.

In `src/index.css`:
6. Remove the `@keyframes dialog-content-show` and `@keyframes dialog-overlay-show` blocks. Keep `@keyframes dirty-pulse` and everything else.
  </action>
  <verify>
Run `grep -n "dialog-content-show\|dialog-overlay-show" src/components/ui/dialog.tsx src/index.css` — should return NO matches.
Run `grep -n "AnimatePresence\|motion\.div" src/components/ui/dialog.tsx` — should return matches confirming framer-motion usage.
Run `npx tsc --noEmit 2>&1 | grep -v "bindings.ts"` — no new TypeScript errors.
  </verify>
  <done>Dialog opens centered immediately with smooth opacity+scale fade-in. No position jump or flicker. CSS keyframes for dialog removed from index.css.</done>
</task>

<task type="auto">
  <name>Task 2: Make blade slide animation subtler</name>
  <files>src/components/blades/BladeContainer.tsx, src/lib/animations.ts</files>
  <action>
Reduce blade slide-in distance from 100% viewport width to 40px, and switch from bouncy spring to smooth tween.

In `src/components/blades/BladeContainer.tsx`:
1. Change the motion.div animation props from:
   ```tsx
   initial={{ x: "100%", opacity: 0 }}
   animate={{ x: 0, opacity: 1 }}
   exit={{ x: "100%", opacity: 0 }}
   transition={{ type: "spring", stiffness: 300, damping: 30 }}
   ```
   To:
   ```tsx
   initial={{ x: 40, opacity: 0 }}
   animate={{ x: 0, opacity: 1 }}
   exit={{ x: 40, opacity: 0 }}
   transition={{ type: "tween", ease: "easeOut", duration: 0.2 }}
   ```

In `src/lib/animations.ts`:
2. Update the `bladeSlideIn` variant to match:
   ```ts
   export const bladeSlideIn: Variants = {
     hidden: { x: 40, opacity: 0 },
     show: {
       x: 0,
       opacity: 1,
       transition: { type: "tween", ease: "easeOut", duration: 0.2 },
     },
     exit: {
       x: 40,
       opacity: 0,
       transition: { type: "tween", ease: "easeIn", duration: 0.15 },
     },
   };
   ```
  </action>
  <verify>
Run `grep -n "x: 40\|tween" src/components/blades/BladeContainer.tsx src/lib/animations.ts` — should show the new values in both files.
Run `grep -n "stiffness\|x: .100" src/components/blades/BladeContainer.tsx src/lib/animations.ts` — should return NO matches.
  </verify>
  <done>Blade panels slide in from 40px right with a 200ms ease-out tween. No bouncy spring overshoot. Exit animation is 150ms ease-in.</done>
</task>

</tasks>

<verification>
- Open the app and trigger a modal (e.g., create tag dialog). Verify it appears centered immediately with no position flash.
- Navigate to trigger a blade (e.g., click a file to open diff). Verify the blade slides in subtly from the right, not aggressively from off-screen.
- Both animations should feel smooth and polished, completing in under 200ms.
</verification>

<success_criteria>
1. Modals appear centered on screen immediately with no flicker or position jump (UIPX-01)
2. Blade panels slide in with a subtle 40px tween animation that does not feel aggressive (UIPX-02)
3. No TypeScript compilation errors introduced
4. CSS keyframes for dialog animations removed from index.css
</success_criteria>

<output>
After completion, create `.planning/phases/16-quick-fixes-visual-polish/16-01-SUMMARY.md`
</output>
