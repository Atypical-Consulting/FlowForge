---
phase: 16-quick-fixes-visual-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src-tauri/src/git/tag.rs
  - src/bindings.ts
autonomous: true

must_haves:
  truths:
    - "Tags list shows most recently created tag at the top"
  artifacts:
    - path: "src-tauri/src/git/tag.rs"
      provides: "TagInfo with created_at_ms field, sorted descending by date"
      contains: "created_at_ms"
    - path: "src/bindings.ts"
      provides: "Auto-generated TypeScript type with createdAtMs field"
      contains: "createdAtMs"
  key_links:
    - from: "src-tauri/src/git/tag.rs"
      to: "src/bindings.ts"
      via: "specta auto-generation on cargo build"
      pattern: "created_at_ms.*f64"
---

<objective>
Add timestamp to TagInfo and sort tags by most recent first (TAGS-01).

Purpose: Tags are currently sorted alphabetically. Users expect to see the most recently created tag at the top of the list, matching how git GUIs typically display tags.

Output: TagInfo struct gains `created_at_ms: f64` field. Tags sorted descending by timestamp. TypeScript bindings regenerated automatically.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src-tauri/src/git/tag.rs
@src/bindings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add created_at_ms to TagInfo and sort tags by date descending</name>
  <files>src-tauri/src/git/tag.rs</files>
  <action>
Modify the Rust `TagInfo` struct and both functions that construct it (`list_tags` and `create_tag`).

1. Add a new field to the `TagInfo` struct (after `is_annotated`):
   ```rust
   /// Creation timestamp in milliseconds since epoch
   pub created_at_ms: f64,
   ```

2. In `list_tags` function, populate `created_at_ms` for both tag types:

   For **annotated tags** (the `if let Some(tag) = obj.as_tag()` branch):
   ```rust
   created_at_ms: tag.tagger()
       .map(|sig| (sig.when().seconds() as f64) * 1000.0)
       .unwrap_or_else(|| (target.time().seconds() as f64) * 1000.0),
   ```

   For **lightweight tags** (the `else` branch):
   ```rust
   created_at_ms: (commit.time().seconds() as f64) * 1000.0,
   ```

3. Change the sort from alphabetical to descending by timestamp:
   Replace:
   ```rust
   tags.sort_by(|a, b| a.name.cmp(&b.name));
   ```
   With:
   ```rust
   tags.sort_by(|a, b| b.created_at_ms.partial_cmp(&a.created_at_ms).unwrap_or(std::cmp::Ordering::Equal));
   ```

4. In `create_tag` function, populate `created_at_ms` for both tag types:

   For **annotated tags**: use `(sig.when().seconds() as f64) * 1000.0` where `sig` is from `repo.signature()?`.

   For **lightweight tags**: use `(target_commit.time().seconds() as f64) * 1000.0`.
  </action>
  <verify>
Run `cd src-tauri && cargo check 2>&1 | tail -5` — should compile with no errors.
Run `grep -n "created_at_ms" src-tauri/src/git/tag.rs` — should appear in struct definition, list_tags (2 places), and create_tag (2 places).
Run `grep -n "partial_cmp\|b\.created_at_ms" src-tauri/src/git/tag.rs` — should show descending sort.
  </verify>
  <done>TagInfo struct has created_at_ms field populated from tagger/commit time. Tags sorted most-recent-first.</done>
</task>

<task type="auto">
  <name>Task 2: Regenerate TypeScript bindings</name>
  <files>src/bindings.ts</files>
  <action>
Regenerate the TypeScript bindings by running a Tauri build, which triggers specta to export types.

1. Run `cd /Users/phmatray/Repositories/github-phm/FlowForge && cargo build --manifest-path src-tauri/Cargo.toml` to trigger bindings regeneration.

2. Verify the regenerated `src/bindings.ts` now contains `createdAtMs` in the `TagInfo` type:
   ```
   grep "createdAtMs" src/bindings.ts
   ```

3. Run `npx tsc --noEmit 2>&1 | grep -v "bindings.ts(1493"` to check for any NEW TypeScript errors (the pre-existing bindings.ts TS2440 error should be ignored).

NOTE: The pre-existing `src/bindings.ts(1493,2): error TS2440` is a known issue. Ignore it.
  </action>
  <verify>
Run `grep "createdAtMs" src/bindings.ts` — should show `createdAtMs: number` in TagInfo type.
Run `grep "TagInfo" src/bindings.ts | head -3` — should show updated type with new field.
  </verify>
  <done>TypeScript bindings regenerated with createdAtMs field in TagInfo type. Frontend will automatically receive sorted tags from backend.</done>
</task>

</tasks>

<verification>
- `cargo check` in src-tauri compiles without errors
- `src/bindings.ts` contains `createdAtMs: number` in TagInfo type
- Tags will be returned sorted by date descending from the backend — no frontend sorting changes needed
</verification>

<success_criteria>
1. Tags list shows most recently created tag at the top (TAGS-01)
2. TagInfo has created_at_ms field in Rust and createdAtMs in TypeScript
3. Both annotated and lightweight tags have correct timestamps
4. No Rust compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/16-quick-fixes-visual-polish/16-02-SUMMARY.md`
</output>
