---
phase: 12-workflows
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - src/components/clone/CloneForm.tsx
  - src/components/clone/CloneProgress.tsx
  - src/stores/clone.ts
  - src/components/WelcomeView.tsx
  - src/components/Header.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter repository URL and select destination folder"
    - "Clone progress displays inline on welcome page during clone"
    - "After clone completes, repository auto-opens"
    - "Clone errors display via toast notification"
  artifacts:
    - path: "src/components/clone/CloneForm.tsx"
      provides: "URL input and destination picker"
      min_lines: 50
    - path: "src/components/clone/CloneProgress.tsx"
      provides: "Progress display component"
      min_lines: 30
    - path: "src/stores/clone.ts"
      provides: "Clone state management"
      exports: ["useCloneStore"]
  key_links:
    - from: "src/components/clone/CloneForm.tsx"
      to: "commands.cloneRepository"
      via: "useMutation with Channel"
      pattern: "cloneRepository.*Channel"
    - from: "CloneForm"
      to: "useCloneStore"
      via: "state subscription"
      pattern: "useCloneStore"
---

<objective>
Implement clone UI with form, progress display, and entry points.

Purpose: Users can clone repositories from the welcome page with visual progress feedback.
Output: CloneForm component on welcome page, CloneProgress inline display, Header "Clone" button.
</objective>

<execution_context>
@C:\Users\matrayp\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\matrayp\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12-workflows/12-CONTEXT.md
@.planning/phases/12-workflows/12-01-SUMMARY.md
@src/components/WelcomeView.tsx
@src/components/Header.tsx
@src/stores/toast.ts
@src/bindings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create clone store and CloneProgress component</name>
  <files>src/stores/clone.ts, src/components/clone/CloneProgress.tsx</files>
  <action>
1. Create `src/stores/clone.ts`:
   - State: `isCloning: boolean`, `progress: CloneProgress | null`, `error: string | null`
   - Actions: `startClone()`, `updateProgress(progress)`, `finishClone()`, `setError(msg)`, `reset()`
   - Use zustand pattern matching existing stores (see toast.ts, repository.ts)

2. Create `src/components/clone/CloneProgress.tsx`:
   - Subscribe to useCloneStore for progress state
   - Display progress based on variant:
     - `Started`: "Connecting to {url}..."
     - `Receiving`: Progress bar with "{received}/{total} objects ({bytes} bytes)"
     - `Resolving`: Progress bar with "Resolving {current}/{total} deltas"
     - `Checkout`: Progress bar with "Checking out files... {current}/{total}"
     - `Finished`: "Clone complete!"
   - Use Tailwind for styling (bg-ctp-surface0, rounded-lg, progress bar with bg-ctp-blue)
   - Include cancel/close button when not actively cloning
   - Animate progress bar smoothly (use framer-motion or CSS transitions)
  </action>
  <verify>
Run `npm run typecheck` - no TypeScript errors.
Verify CloneProgress component renders placeholder content.
  </verify>
  <done>
Clone store manages state, CloneProgress component displays all progress phases.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CloneForm with URL input and folder picker</name>
  <files>src/components/clone/CloneForm.tsx</files>
  <action>
Create `src/components/clone/CloneForm.tsx`:

1. Form fields:
   - URL input: text field with placeholder "https://github.com/user/repo.git"
   - Destination: display path + "Browse" button using `open({ directory: true })` from @tauri-apps/plugin-dialog
   - Default destination: Use a sensible default (can be empty, user must select)

2. Clone mutation:
   - Use `useMutation` from @tanstack/react-query
   - Create `Channel<CloneProgress>` and subscribe to progress events
   - On each progress event, call `useCloneStore.getState().updateProgress(event)`
   - On success: call `useRepositoryStore.getState().openRepository(path)`, show success toast
   - On error: call `useCloneStore.getState().setError(msg)`, show error toast

3. UI layout:
   - Vertical stack: URL input, destination row (path display + Browse button), Clone button
   - Clone button disabled when: URL empty, destination empty, isCloning
   - Show spinner on Clone button when cloning
   - Style with Tailwind matching existing forms (see CreateBranchDialog.tsx for patterns)

4. Validation:
   - URL: basic validation (starts with http/https/git@)
   - Destination: must be selected via folder picker
  </action>
  <verify>
Run `npm run typecheck` - no errors.
Component renders form with all fields.
  </verify>
  <done>
CloneForm accepts URL and destination, triggers clone with progress tracking.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate clone UI into WelcomeView and Header</name>
  <files>src/components/WelcomeView.tsx, src/components/Header.tsx</files>
  <action>
1. Update `src/components/WelcomeView.tsx`:
   - Add "Clone Repository" button below "Open Repository" button
   - When clicked, show CloneForm inline (not modal - per CONTEXT.md)
   - While cloning, replace form with CloneProgress component
   - After clone success, form disappears (repo opens automatically)
   - Add state: `showCloneForm: boolean` to toggle form visibility
   - Position: Below "Open Repository" button, styled consistently

2. Update `src/components/Header.tsx`:
   - Add "Clone" button next to "Open" button (icon: GitFork or Copy from lucide-react)
   - When clicked (and no repo open): dispatch custom event `clone-repository-dialog` 
   - WelcomeView listens for this event and shows clone form
   - When repo IS open: still allow clone (shows in a simple dialog or navigates to welcome view)

3. Wire up auto-open after clone:
   - In CloneForm's onSuccess: call `openRepository(clonedPath)` and `addRecentRepo(clonedPath)`
   - This automatically transitions from WelcomeView to RepositoryView
  </action>
  <verify>
Run `npm run dev` - verify Clone button appears on welcome page.
Click Clone - form appears inline.
Clone button in header dispatches event (check console).
  </verify>
  <done>
Clone accessible from welcome page button and header, progress displays inline, auto-opens after success.
  </done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- Clone button visible on welcome page
- Clicking Clone shows form with URL input and folder picker
- Clone header button works
- Progress displays during clone operation
</verification>

<success_criteria>
- User can enter URL and select destination folder
- Clone progress displays inline (not modal) on welcome page
- After clone completes, repository auto-opens
- Clone errors display via toast notification
- Clone accessible from welcome page and header
</success_criteria>

<output>
After completion, create `.planning/phases/12-workflows/12-02-SUMMARY.md`
</output>
