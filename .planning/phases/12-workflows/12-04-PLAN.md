---
phase: 12-workflows
plan: 04
type: execute
wave: 2
depends_on: ["12-03"]
files_modified:
  - src/components/gitflow/InitGitflowDialog.tsx
  - src/components/gitflow/GitflowPanel.tsx
  - src/stores/gitflow.ts
autonomous: true

must_haves:
  truths:
    - "Init dialog appears only when repo is not Gitflow-initialized"
    - "User can configure all branch names in the dialog"
    - "Dialog warns if develop branch exists with different name"
    - "After init, switches to develop branch automatically"
  artifacts:
    - path: "src/components/gitflow/InitGitflowDialog.tsx"
      provides: "Gitflow initialization modal"
      min_lines: 80
  key_links:
    - from: "src/components/gitflow/InitGitflowDialog.tsx"
      to: "commands.initGitflow"
      via: "useMutation"
      pattern: "initGitflow"
    - from: "src/components/gitflow/GitflowPanel.tsx"
      to: "InitGitflowDialog"
      via: "conditional render"
      pattern: "!.*isInitialized.*InitGitflow"
---

<objective>
Implement Gitflow initialization UI with configuration dialog.

Purpose: Users can initialize Gitflow on non-Gitflow repositories via a modal dialog.
Output: InitGitflowDialog component, "Initialize Gitflow" button in GitflowPanel sidebar.
</objective>

<execution_context>
@C:\Users\matrayp\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\matrayp\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12-workflows/12-CONTEXT.md
@.planning/phases/12-workflows/12-03-SUMMARY.md
@src/components/gitflow/GitflowPanel.tsx
@src/components/gitflow/StartFlowDialog.tsx
@src/stores/gitflow.ts
@src/bindings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create InitGitflowDialog component</name>
  <files>src/components/gitflow/InitGitflowDialog.tsx</files>
  <action>
Create `src/components/gitflow/InitGitflowDialog.tsx`:

1. Dialog structure (use existing Dialog components from ui/dialog.tsx):
   - Title: "Initialize Gitflow"
   - Description: "Configure branch naming conventions for this repository"

2. Form fields (all with labels and placeholders):
   - Main branch: text input, default to detected main branch (main or master)
   - Develop branch: text input, default "develop"
   - Feature prefix: text input, default "feature/"
   - Release prefix: text input, default "release/"
   - Hotfix prefix: text input, default "hotfix/"
   - Push develop to remote: checkbox, default checked

3. Validation:
   - All fields required
   - Prefixes must end with "/"
   - Show inline validation errors
   - Disable submit until valid

4. Warning state:
   - If develop branch exists (check via gitflow status), show warning:
     "A 'develop' branch already exists. It will be used as the develop branch."
   - Allow user to proceed or change the name

5. Mutation:
   - Use `useMutation` with `commands.initGitflow(config, pushDevelop)`
   - On success: show success toast, close dialog, refresh gitflow status
   - On error: show error toast with message

6. Styling: Match existing dialogs (StartFlowDialog.tsx pattern)
  </action>
  <verify>
Run `npm run typecheck` - no errors.
Component renders with all form fields.
  </verify>
  <done>
InitGitflowDialog renders form with all configuration fields, validation, and submit logic.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add "Initialize Gitflow" button to GitflowPanel</name>
  <files>src/components/gitflow/GitflowPanel.tsx, src/stores/gitflow.ts</files>
  <action>
1. Update `src/stores/gitflow.ts`:
   - Add `initGitflow(config, push)` action that calls `commands.initGitflow`
   - On success: call `refresh()` to update status
   - Handle error state

2. Update `src/components/gitflow/GitflowPanel.tsx`:
   - Add state: `showInitDialog: boolean`
   - Check `status.context.isInitialized` (or `!status.context.hasDevelop && !status.context.hasMain` as fallback)
   - If NOT initialized, show "Initialize Gitflow" button prominently:
     - Position: Top of panel, before flow actions
     - Style: Primary button with GitBranch icon
     - Text: "Initialize Gitflow"
     - On click: setShowInitDialog(true)
   - If initialized, show normal flow controls (existing behavior)
   - Render `<InitGitflowDialog open={showInitDialog} onOpenChange={setShowInitDialog} />`

3. After successful init:
   - Dialog closes
   - Panel refreshes and shows normal Gitflow controls
   - Toast: "Gitflow initialized! Switched to develop branch."
  </action>
  <verify>
Run `npm run typecheck` - no errors.
Run `npm run dev` - on non-Gitflow repo, "Initialize Gitflow" button appears in left panel.
  </verify>
  <done>
GitflowPanel shows "Initialize Gitflow" button when repo is not Gitflow-initialized, opens dialog on click.
  </done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- On non-Gitflow repo: "Initialize Gitflow" button visible in sidebar
- Clicking button opens configuration dialog
- Dialog has all branch name fields with defaults
- Submit creates develop branch and stores config
</verification>

<success_criteria>
- Init dialog only appears when repo is not Gitflow-initialized
- User can configure all branch names (main, develop, prefixes)
- Dialog warns if develop branch exists
- After init, switches to develop branch automatically
- Success shows toast notification
</success_criteria>

<output>
After completion, create `.planning/phases/12-workflows/12-04-SUMMARY.md`
</output>
