---
phase: 41-sandbox-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/repository.ts
  - src/stores/branches.ts
  - src/stores/tags.ts
  - src/stores/stash.ts
  - src/stores/worktrees.ts
  - src/stores/clone.ts
  - src/stores/undo.ts
  - src/stores/topology.ts
  - src/stores/gitflow.ts
  - src/stores/staging.ts
  - src/stores/commandPalette.ts
  - src/stores/navigation.ts
  - src/stores/theme.ts
  - src/stores/settings.ts
  - src/stores/reviewChecklist.ts
  - src/stores/branchMetadata.ts
  - src/commands/navigation.ts
  - src/commands/toolbar-actions.ts
  - src/commands/repository.ts
  - src/commands/settings.ts
  - src/commands/sync.ts
  - src/commands/branches.ts
  - src/components/RepositoryView.tsx
  - src/components/Header.tsx
  - src/components/WelcomeView.tsx
  - src/components/RecentRepos.tsx
  - src/components/command-palette/CommandPalette.tsx
  - src/components/toolbar/Toolbar.tsx
  - src/components/navigation/BranchSwitcher.tsx
  - src/components/navigation/RepoSwitcher.tsx
  - src/components/branches/BranchList.tsx
  - src/components/branches/MergeDialog.tsx
  - src/components/branches/CreateBranchDialog.tsx
  - src/components/gitflow/ReviewChecklist.tsx
  - src/components/gitflow/StartFlowDialog.tsx
  - src/components/gitflow/InitGitflowDialog.tsx
  - src/components/gitflow/FinishFlowDialog.tsx
  - src/components/gitflow/GitflowPanel.tsx
  - src/components/clone/CloneForm.tsx
  - src/components/stash/StashDialog.tsx
  - src/components/stash/StashList.tsx
  - src/components/tags/TagList.tsx
  - src/components/ui/ThemeToggle.tsx
  - src/components/worktree/WorktreePanel.tsx
  - src/components/worktree/CreateWorktreeDialog.tsx
  - src/components/worktree/DeleteWorktreeDialog.tsx
  - src/hooks/useKeyboardShortcuts.ts
  - src/hooks/useBranchScopes.ts
  - src/hooks/useBranches.ts
  - src/hooks/useCommitGraph.ts
  - src/blades/settings/SettingsBlade.tsx
  - src/blades/extension-manager/ExtensionManagerBlade.tsx
  - src/blades/staging-changes/StagingChangesBlade.tsx
  - src/blades/gitflow-cheatsheet/GitflowCheatsheetBlade.tsx
  - src/blades/diff/DiffBlade.tsx
  - src/extensions/gitflow/index.ts
  - src/extensions/conventional-commits/index.ts
  - src/extensions/github/index.ts
autonomous: true

must_haves:
  truths:
    - "No file in src/ imports from any of the 16 deprecated shim paths"
    - "All 16 deprecated shim files are deleted from src/stores/"
    - "All consumers use direct domain store imports (git-ops, preferences, ui-state)"
    - "TypeScript compilation passes with zero errors"
    - "All existing tests pass after shim removal"
  artifacts:
    - path: "src/stores/domain/git-ops/index.ts"
      provides: "useGitOpsStore hook that all former git-ops shim consumers now import"
    - path: "src/stores/domain/preferences/index.ts"
      provides: "usePreferencesStore hook that all former preferences shim consumers now import"
    - path: "src/stores/domain/ui-state/index.ts"
      provides: "useUIStore hook that all former ui-state shim consumers now import"
  key_links:
    - from: "src/extensions/github/index.ts"
      to: "src/stores/domain/git-ops"
      via: "import useGitOpsStore as useRepositoryStore"
      pattern: "useGitOpsStore"
    - from: "src/components/RepositoryView.tsx"
      to: "src/stores/domain/git-ops"
      via: "import useGitOpsStore as useRepositoryStore"
      pattern: "useGitOpsStore"
---

<objective>
Remove all 16 deprecated re-export shim files from Phase 30's store consolidation and update all consumer imports to use direct domain store paths.

Purpose: Eliminate the indirection layer of backward-compatibility shims that were created during store consolidation (Phase 30). These shims served as a bridge during migration but are now pure technical debt -- 16 files re-exporting hooks that could be imported directly.

Output: 16 shim files deleted, ~42 consumer files updated with direct domain imports, zero broken imports verified by TypeScript compiler.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/stores/domain/git-ops/index.ts
@src/stores/domain/preferences/index.ts
@src/stores/domain/ui-state/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove zero-consumer shims and migrate git-ops shim consumers</name>
  <files>
    src/stores/clone.ts
    src/stores/worktrees.ts
    src/stores/gitflow.ts
    src/stores/staging.ts
    src/stores/repository.ts
    src/stores/branches.ts
    src/stores/tags.ts
    src/stores/stash.ts
    src/stores/undo.ts
    src/stores/topology.ts
  </files>
  <action>
**Phase 1: Delete zero-consumer shims immediately (no import updates needed).**

Delete these 4 files that have zero consumers:
- `src/stores/clone.ts`
- `src/stores/worktrees.ts`
- `src/stores/gitflow.ts`
- `src/stores/staging.ts`

Verify with: `grep -r "from.*stores/(clone|worktrees|gitflow|staging)[\"']" src/` should return no results. Note: the `stores/gitflow.ts` shim is different from `extensions/gitflow/` -- the shim is just a re-export.

**Phase 2: Migrate git-ops shim consumers (9 shims -> useGitOpsStore).**

For each of the remaining 6 git-ops shims (repository, branches, tags, stash, undo, topology), find all consumer files and update their imports.

**Migration pattern:** Replace the shim import with a direct import using `as` alias for readability:
```typescript
// BEFORE:
import { useRepositoryStore } from "../stores/repository";
// AFTER:
import { useGitOpsStore as useRepositoryStore } from "../stores/domain/git-ops";
```

This pattern preserves the semantic name (`useRepositoryStore`, `useBranchStore`, etc.) in the consumer code while pointing to the correct domain store. The `as` alias means no other code in the file needs to change.

**Important: the `topology.ts` shim re-exports types.** Check if any consumer imports types from `stores/topology.ts`. If so, redirect those type imports to the source slice: `import type { ... } from "../stores/domain/git-ops/topology.slice"`.

**Process each shim in order of consumer count (lowest first):**

1. `stores/tags.ts` -> Find consumers (`grep -rn "from.*stores/tags" src/`), update each to `import { useGitOpsStore as useTagStore } from "...stores/domain/git-ops"`, then delete shim.

2. `stores/undo.ts` -> Same pattern with `useGitOpsStore as useUndoStore`.

3. `stores/topology.ts` -> Same pattern with `useGitOpsStore as useTopologyStore`. Check for type re-exports.

4. `stores/stash.ts` -> Same pattern with `useGitOpsStore as useStashStore`.

5. `stores/branches.ts` -> Same pattern with `useGitOpsStore as useBranchStore`.

6. `stores/repository.ts` -> Largest: update ALL consumers. This includes 3 extension files:
   - `src/extensions/github/index.ts`: change `import { useRepositoryStore } from "../../stores/repository"` to `import { useGitOpsStore as useRepositoryStore } from "../../stores/domain/git-ops"`
   - `src/extensions/gitflow/index.ts`: same pattern
   - `src/extensions/conventional-commits/index.ts`: same pattern (if it imports repository)
   - All component/command/hook files that import useRepositoryStore

After migrating all consumers for each shim, delete the shim file.

Run `npx tsc --noEmit` after completing all git-ops migrations to verify no broken imports.
  </action>
  <verify>
    - `npx tsc --noEmit` passes after all git-ops shim removals
    - `grep -rn "from.*stores/(repository|branches|tags|stash|worktrees|clone|undo|topology|gitflow|staging)[\"']" src/` returns zero results (excluding test mocks that reference old paths)
    - All 10 git-ops related shim files deleted (including 4 zero-consumer ones)
  </verify>
  <done>
    All 10 git-ops and zero-consumer shim files deleted, all consumers updated to import from stores/domain/git-ops or stores/domain/ui-state
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate preferences and ui-state shim consumers</name>
  <files>
    src/stores/commandPalette.ts
    src/stores/navigation.ts
    src/stores/theme.ts
    src/stores/settings.ts
    src/stores/reviewChecklist.ts
    src/stores/branchMetadata.ts
  </files>
  <action>
**Migrate ui-state shims (2 shims):**

1. `stores/commandPalette.ts` -> Find consumers, update to:
   ```typescript
   import { useUIStore as useCommandPaletteStore } from "../stores/domain/ui-state";
   ```

2. Note: `stores/staging.ts` was already deleted in Task 1 (zero consumers).

**Migrate preferences shims (5 shims) -- SPECIAL: some re-export types.**

For preferences shims, the pattern is the same except 3 shims also re-export types that consumers may import:

3. `stores/navigation.ts` -> Update consumers to:
   ```typescript
   import { usePreferencesStore as useNavigationStore } from "../stores/domain/preferences";
   ```

4. `stores/theme.ts` -> **Has type re-exports.** Check consumers for type imports like `type Theme`, `type ResolvedTheme`. Update store import:
   ```typescript
   import { usePreferencesStore as useThemeStore } from "../stores/domain/preferences";
   ```
   For type imports, redirect to the source slice:
   ```typescript
   import type { Theme } from "../stores/domain/preferences/theme.slice";
   ```

5. `stores/branchMetadata.ts` -> **Has type re-exports.** Check consumers for `type RecentBranchEntry`. Update store import:
   ```typescript
   import { usePreferencesStore as useBranchMetadataStore } from "../stores/domain/preferences";
   ```
   For type imports:
   ```typescript
   import type { RecentBranchEntry } from "../stores/domain/preferences/branch-metadata.slice";
   ```

6. `stores/settings.ts` -> **Has type re-exports.** Check consumers for `type SettingsCategory`, `type GeneralSettings`, `type GitSettings`, `type IntegrationsSettings`, `type Settings`. Update store import:
   ```typescript
   import { usePreferencesStore as useSettingsStore } from "../stores/domain/preferences";
   ```
   For type imports:
   ```typescript
   import type { SettingsCategory, GeneralSettings, GitSettings, IntegrationsSettings, Settings } from "../stores/domain/preferences/settings.slice";
   ```

7. `stores/reviewChecklist.ts` -> **Has type re-exports.** Check consumers for `type ChecklistItem`, `type FlowType`, `DEFAULT_CHECKLIST`. Update store import:
   ```typescript
   import { usePreferencesStore as useReviewChecklistStore } from "../stores/domain/preferences";
   ```
   For type/value imports:
   ```typescript
   import { DEFAULT_CHECKLIST, type ChecklistItem, type FlowType } from "../stores/domain/preferences/review-checklist.slice";
   ```

After migrating all consumers for each shim, delete the shim file.

**Final verification after all 16 shims removed:**
- Run `npx tsc --noEmit` -- must pass with zero errors
- Run `npx vitest run` -- all tests must pass
- Run comprehensive grep: `grep -rn "from.*stores/(repository|branches|tags|stash|worktrees|clone|undo|topology|gitflow|staging|commandPalette|navigation|theme|settings|reviewChecklist|branchMetadata)[\"']" src/` -- must return zero results (excluding any test mock setup that references old paths for mock declarations, which should also be updated)

**Important:** Also check `src/stores/index.ts` -- if it re-exports from any deleted shims, remove those re-exports.
  </action>
  <verify>
    - `npx tsc --noEmit` passes with zero errors
    - `npx vitest run` passes (all 207+ tests)
    - `grep -rn "from.*stores/(commandPalette|navigation|theme|settings|reviewChecklist|branchMetadata)[\"']" src/` returns zero results
    - All 6 preferences/ui-state shim files deleted
    - Total: all 16 shim files removed from src/stores/
  </verify>
  <done>
    All 16 deprecated re-export shim files deleted. All ~42 consumer files updated to use direct domain store imports. TypeScript compiles cleanly. All tests pass.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes -- zero type errors after all migrations
2. `npx vitest run` passes -- all existing tests pass
3. `ls src/stores/{repository,branches,tags,stash,worktrees,clone,undo,topology,gitflow,staging,commandPalette,navigation,theme,settings,reviewChecklist,branchMetadata}.ts 2>&1 | grep "No such file"` -- all 16 files gone
4. `grep -rn "from.*stores/(repository|branches|tags|stash|worktrees|clone|undo|topology|gitflow|staging|commandPalette|navigation|theme|settings|reviewChecklist|branchMetadata)[\"']" src/` -- zero results
5. Extensions still import correctly: grep for `useGitOpsStore` in `src/extensions/` shows updated imports
</verification>

<success_criteria>
- All 16 deprecated shim files deleted from src/stores/
- All consumer files (~42) updated with direct domain imports
- TypeScript compilation passes with zero errors
- All existing tests pass (207+)
- No runtime regressions -- store hooks point to same underlying Zustand stores
</success_criteria>

<output>
After completion, create `.planning/phases/41-sandbox-polish/41-02-SUMMARY.md`
</output>
