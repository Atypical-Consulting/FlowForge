---
phase: 41-sandbox-polish
plan: 05
type: execute
wave: 3
depends_on: ["41-01", "41-02", "41-03", "41-04"]
files_modified:
  - docs/extension-api.md
  - docs/extension-manifest.md
  - docs/trust-levels.md
  - package.json
  - src-tauri/Cargo.toml
  - src-tauri/tauri.conf.json
autonomous: true

must_haves:
  truths:
    - "Version is 1.6.0 in package.json, Cargo.toml, and tauri.conf.json"
    - "Extension API documentation exists with method classification table"
    - "Extension manifest documentation exists with trust level schema"
    - "All tests pass at v1.6.0"
  artifacts:
    - path: "package.json"
      provides: "Frontend version 1.6.0"
      contains: "1.6.0"
    - path: "src-tauri/Cargo.toml"
      provides: "Rust backend version 1.6.0"
      contains: "1.6.0"
    - path: "src-tauri/tauri.conf.json"
      provides: "Tauri config version 1.6.0"
      contains: "1.6.0"
    - path: "docs/extension-api.md"
      provides: "ExtensionAPI method reference with sandbox safety classification"
    - path: "docs/extension-manifest.md"
      provides: "Extension manifest JSON schema documentation"
    - path: "docs/trust-levels.md"
      provides: "Trust level architecture documentation"
  key_links:
    - from: "docs/extension-api.md"
      to: "src/extensions/ExtensionAPI.ts"
      via: "documents all public methods"
      pattern: "registerBlade|contributeToolbar"
    - from: "docs/trust-levels.md"
      to: "src/extensions/extensionTypes.ts"
      via: "documents TrustLevel type"
      pattern: "built-in|user-trusted|sandboxed"
---

<objective>
Create in-repo extension developer documentation and bump version to v1.6.0.

Purpose: Document the extension architecture, API methods with trust classifications, and manifest schema for future extension developers. Bump the version to mark the v1.6.0 milestone completion. This plan runs LAST to ensure all features and tests are in place before the version bump.

Output: Three documentation files in docs/, version bumped to 1.6.0 in all three config files.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/41-sandbox-polish/41-01-SUMMARY.md
@.planning/phases/41-sandbox-polish/41-03-SUMMARY.md
@src/extensions/ExtensionAPI.ts
@src/extensions/extensionTypes.ts
@src/extensions/sandbox/sandbox-api-surface.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create extension developer documentation</name>
  <files>
    docs/extension-api.md
    docs/extension-manifest.md
    docs/trust-levels.md
  </files>
  <action>
Create a `docs/` directory at the project root if it does not exist.

1. Create `docs/extension-api.md` -- ExtensionAPI method reference:

   Structure:
   - Title: "ExtensionAPI Reference"
   - Brief intro explaining that each extension receives an `ExtensionAPI` instance during activation
   - **API Method Classification Table** (critical for SAND-03):

     | Method | Sandbox Safety | Description |
     |--------|---------------|-------------|
     | `registerBlade(config)` | requires-trust | Register a blade type with React component |
     | `registerCommand(config)` | requires-trust | Register a command palette entry |
     | `contributeToolbar(config)` | requires-trust | Add a toolbar action |
     | `contributeContextMenu(config)` | requires-trust | Add a context menu item |
     | `contributeSidebarPanel(config)` | requires-trust | Add a sidebar panel section |
     | `contributeStatusBar(config)` | requires-trust | Add a status bar widget |
     | `onDidGit(operation, handler)` | sandbox-safe | Listen for post-operation git events |
     | `onWillGit(operation, handler)` | sandbox-safe | Listen for pre-operation git events (can cancel) |
     | `onDispose(disposable)` | sandbox-safe | Register cleanup callback |
     | `cleanup()` | internal | Remove all registrations (called by host) |

   - Section per method group: "Blade Registration", "Commands", "Toolbar", "Context Menu", "Sidebar Panels", "Status Bar", "Git Hooks", "Lifecycle"
   - Each section: method signature, config interface, example usage, sandbox safety note
   - "Automatic Namespacing" section: explain `ext:{extensionId}:` prefix, `coreOverride` for built-ins
   - "Cleanup Order" section: blades -> commands -> toolbar -> context menu -> sidebar -> status bar -> git hooks -> disposables (LIFO)
   - Reference the source file: `src/extensions/ExtensionAPI.ts`

2. Create `docs/extension-manifest.md` -- Extension manifest JSON schema:

   Structure:
   - Title: "Extension Manifest Schema"
   - Explain that extensions ship a `flowforge.extension.json` in their root
   - Full JSON schema example with all fields:
     ```json
     {
       "id": "my-extension",
       "name": "My Extension",
       "version": "1.0.0",
       "description": "What it does",
       "apiVersion": "1",
       "main": "index.js",
       "trustLevel": "sandboxed",
       "contributes": {
         "blades": [{ "type": "my-blade", "title": "My Blade", "singleton": true }],
         "commands": [{ "id": "do-thing", "title": "Do Thing", "category": "My Ext" }],
         "toolbar": [{ "id": "my-btn", "label": "My Button", "group": "tools", "priority": 50 }]
       },
       "permissions": ["git-operations"]
     }
     ```
   - Field reference table with types, required/optional, defaults
   - `trustLevel` field documentation: defaults to "sandboxed", built-in extensions override to "built-in"
   - `contributes` section documentation
   - `permissions` list documentation
   - Reference the Rust source: `src-tauri/src/extensions/manifest.rs`

3. Create `docs/trust-levels.md` -- Trust level architecture:

   Structure:
   - Title: "Extension Trust Levels"
   - Overview of the three-tier trust model
   - Table:

     | Level | Label | API Access | Execution Environment | Examples |
     |-------|-------|-----------|----------------------|----------|
     | `built-in` | Built-in | Full ExtensionAPI | Main thread | GitHub, Content Viewers, CC, Gitflow |
     | `user-trusted` | Trusted | Full ExtensionAPI | Main thread | User-installed extensions |
     | `sandboxed` | Sandboxed | sandbox-safe only | Worker (future) | Third-party extensions (v1.7.0+) |

   - "How Trust Level is Determined" section:
     - Built-in: set automatically by `registerBuiltIn()`
     - User-trusted: user-installed extensions (loaded via asset:// protocol)
     - Sandboxed: default for external manifests, future Worker isolation
   - "Sandbox-Safe vs Requires-Trust" section with the classification table
   - "Worker Sandbox Architecture" section: brief overview of the prototype, MessagePort communication, what cannot cross the Worker boundary (React components, closures, store references)
   - "Design Tokens for Extensions" section: list available Catppuccin CSS custom properties (`--catppuccin-color-{name}`) and Tailwind utility classes (`bg-ctp-{name}`, `text-ctp-{name}`, `border-ctp-{name}`)
   - Reference source files: `src/extensions/extensionTypes.ts`, `src/extensions/sandbox/sandbox-api-surface.ts`

Keep all docs concise and technical. No marketing language. Focus on what extension developers need to know.
  </action>
  <verify>
    - `docs/extension-api.md` exists with API classification table
    - `docs/extension-manifest.md` exists with JSON schema
    - `docs/trust-levels.md` exists with trust model documentation
    - All three files reference the correct source files
  </verify>
  <done>
    Extension developer documentation covers API methods with sandbox classification, manifest JSON schema with trust level field, and trust level architecture with design tokens
  </done>
</task>

<task type="auto">
  <name>Task 2: Bump version to v1.6.0</name>
  <files>
    package.json
    src-tauri/Cargo.toml
    src-tauri/tauri.conf.json
  </files>
  <action>
**PREREQUISITE:** This task runs ONLY after all other Phase 41 plans are complete and verified. Run the full test suite first.

1. Run the full test suite to verify everything passes:
   ```bash
   npx vitest run
   ```
   If ANY test fails, stop and fix before bumping version.

2. Update version in all three files from `1.5.0` to `1.6.0`:

   - `package.json`: Change `"version": "1.5.0"` to `"version": "1.6.0"`
   - `src-tauri/Cargo.toml`: Change `version = "1.5.0"` to `version = "1.6.0"`
   - `src-tauri/tauri.conf.json`: Change `"version": "1.5.0"` to `"version": "1.6.0"`

3. Verify no other files reference 1.5.0 that should be updated:
   ```bash
   grep -rn "1\.5\.0" package.json src-tauri/Cargo.toml src-tauri/tauri.conf.json
   ```
   Should return zero results.

4. Verify the version change compiles:
   ```bash
   npx tsc --noEmit
   ```

5. Run the test suite one final time:
   ```bash
   npx vitest run
   ```

All three files must be updated atomically in the same commit.
  </action>
  <verify>
    - `grep "1.6.0" package.json` returns the version line
    - `grep "1.6.0" src-tauri/Cargo.toml` returns the version line
    - `grep "1.6.0" src-tauri/tauri.conf.json` returns the version line
    - `grep "1.5.0" package.json src-tauri/Cargo.toml src-tauri/tauri.conf.json` returns zero results
    - `npx vitest run` passes all tests
  </verify>
  <done>
    Version bumped to 1.6.0 in all three config files. Full test suite passes at v1.6.0.
  </done>
</task>

</tasks>

<verification>
1. `docs/extension-api.md` exists with method classification table (9 methods classified)
2. `docs/extension-manifest.md` exists with full JSON schema
3. `docs/trust-levels.md` exists with three-tier trust model
4. Version is 1.6.0 in package.json, Cargo.toml, and tauri.conf.json
5. `npx vitest run` passes all tests
6. `npx tsc --noEmit` passes
</verification>

<success_criteria>
- Three documentation files exist in docs/ covering API, manifest, and trust levels
- API classification table documents all 9 methods with sandbox safety
- Trust level documentation explains the three-tier model
- Manifest schema documents the trustLevel field
- Version is 1.6.0 in all three config files (package.json, Cargo.toml, tauri.conf.json)
- Full test suite passes at v1.6.0
- No references to 1.5.0 remain in version files
</success_criteria>

<output>
After completion, create `.planning/phases/41-sandbox-polish/41-05-SUMMARY.md`
</output>
