---
phase: 19-settings-onboarding-file-icons
plan: 04
type: execute
wave: 2
depends_on: [2]
files_modified:
  - src/components/settings/IntegrationsSettings.tsx
  - src/components/settings/SettingsWindow.tsx
  - src/lib/integrations-options.ts
autonomous: true

must_haves:
  truths:
    - "IntegrationsSettings component shows an 'External Editor' dropdown with platform-aware options plus a Custom path fallback"
    - "IntegrationsSettings component shows a 'Terminal Shell' dropdown with platform-aware options plus a Custom path fallback"
    - "Editor and terminal selections persist to Tauri store via updateSetting('integrations', key, value)"
    - "Dropdown options are platform-specific: macOS shows Terminal.app/iTerm2, Windows shows cmd/PowerShell, Linux shows GNOME Terminal/Konsole"
    - "Selecting 'Custom path...' reveals a text input for entering a custom executable path, with 'Use preset' to switch back"
    - "Integrations tab is registered in SettingsWindow with Wrench icon between Git and Appearance"
    - "Preferences are saved but NOT wired to any actions (future phase)"
  artifacts:
    - path: "src/lib/integrations-options.ts"
      provides: "Platform-aware editor and terminal option lists"
      exports: ["AppOption", "getEditorOptions", "getTerminalOptions"]
    - path: "src/components/settings/IntegrationsSettings.tsx"
      provides: "Integrations settings tab with editor and terminal dropdowns"
      exports: ["IntegrationsSettings"]
    - path: "src/components/settings/SettingsWindow.tsx"
      provides: "Updated SettingsWindow with Integrations tab activated"
      exports: ["SettingsWindow"]
  key_links:
    - from: "src/components/settings/IntegrationsSettings.tsx"
      to: "src/lib/integrations-options.ts"
      via: "imports getEditorOptions and getTerminalOptions"
      pattern: "import.*getEditorOptions.*from.*integrations-options"
    - from: "src/components/settings/IntegrationsSettings.tsx"
      to: "src/stores/settings.ts"
      via: "imports useSettingsStore for reading/writing integrations settings"
      pattern: "import.*useSettingsStore.*from.*settings"
    - from: "src/components/settings/SettingsWindow.tsx"
      to: "src/components/settings/IntegrationsSettings.tsx"
      via: "imports IntegrationsSettings component for tab registration"
      pattern: "import.*IntegrationsSettings.*from.*IntegrationsSettings"
---

<objective>
Create the IntegrationsSettings component with platform-aware editor and terminal dropdown configurations, extract option data to a shared module, and activate the Integrations tab in SettingsWindow.

Purpose: This satisfies requirement SETT-01 -- "Settings window has an Integrations tab where user can configure preferred external editor and terminal shell." The dropdowns show platform-aware options (different editors/terminals for macOS vs Windows vs Linux) with a "Custom" option that reveals a free-text path input. Preferences are saved to the Tauri persistent store but are NOT wired to any actions in this phase.

Output: A fully functional Integrations tab with editor and terminal configuration, persisted via the settings store.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/stores/settings.ts
@src/lib/platform.ts
@src/components/settings/SettingsWindow.tsx
@src/components/settings/SettingsField.tsx
@src/components/settings/AppearanceSettings.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create platform-aware options data module</name>
  <files>src/lib/integrations-options.ts</files>
  <action>
Create `src/lib/integrations-options.ts` containing the platform-aware editor and terminal option lists.

1. Define `AppOption` interface: `{ label: string; value: string }`
2. Define `editorsByPlatform: Record<Platform, AppOption[]>` with entries per platform:
   - **macOS**: VS Code (code), Cursor (cursor), Zed (zed), Sublime Text (subl), TextMate (mate), BBEdit (bbedit), Vim (vim), Neovim (nvim)
   - **Windows**: VS Code (code), Cursor (cursor), Notepad++ (notepad++), Sublime Text (subl), Visual Studio (devenv), Vim (vim)
   - **Linux**: VS Code (code), Cursor (cursor), Sublime Text (subl), Vim (vim), Neovim (nvim), Gedit (gedit), Kate (kate)

3. Define `terminalsByPlatform: Record<Platform, AppOption[]>` with entries per platform:
   - **macOS**: Terminal (terminal), iTerm2 (iterm2), Warp (warp), Alacritty (alacritty), Kitty (kitty), Hyper (hyper)
   - **Windows**: Windows Terminal (wt), PowerShell (powershell), Command Prompt (cmd), Git Bash (git-bash), Alacritty (alacritty), Hyper (hyper)
   - **Linux**: GNOME Terminal (gnome-terminal), Konsole (konsole), Alacritty (alacritty), Kitty (kitty), xterm (xterm), Hyper (hyper)

4. Export `getEditorOptions(): AppOption[]` -- returns `editorsByPlatform[getPlatform()]`
5. Export `getTerminalOptions(): AppOption[]` -- returns `terminalsByPlatform[getPlatform()]`

Import `Platform` type and `getPlatform` from `./platform`.

Key decisions:
- Uses command names (e.g., "code", "subl") rather than full paths -- more portable
- Platform-specific lists show only relevant options
- Options sorted by popularity within each platform
  </action>
  <verify>
Run `npx tsc --noEmit` and confirm no type errors. Verify options are correctly platform-mapped.
  </verify>
  <done>
integrations-options.ts exports AppOption interface, getEditorOptions, and getTerminalOptions with platform-specific option lists.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create IntegrationsSettings component</name>
  <files>src/components/settings/IntegrationsSettings.tsx</files>
  <action>
Create `src/components/settings/IntegrationsSettings.tsx` with editor and terminal selection dropdowns.

The component contains:

1. **A local `SettingsSelectWithCustom` sub-component** (not exported) that provides:
   - A `<select>` dropdown with: "None" option, platform options, "Custom path..." option
   - When "Custom path..." is selected: switches to a text `<input>` with a "Use preset" button to switch back
   - Auto-detects custom mode if the stored value doesn't match any preset option
   - Uses `SettingsField` wrapper for consistent layout

2. **The `IntegrationsSettings` component** that:
   - Reads `settings.integrations.editor` and `settings.integrations.terminal` from `useSettingsStore`
   - Calls `getEditorOptions()` and `getTerminalOptions()` from integrations-options.ts
   - Renders two `SettingsSelectWithCustom` instances -- one for editor, one for terminal
   - Uses `updateSetting("integrations", "editor", value)` and `updateSetting("integrations", "terminal", value)` for persistence
   - Shows heading "Integrations" with description "Configure external tools for use with FlowForge"
   - Includes informational footer: "These integrations are not yet wired to actions. Future updates will add 'Open in Editor' and 'Open Terminal' commands."

Styling matches existing settings components:
- Select: `max-w-xs px-3 py-2 bg-ctp-surface0 border border-ctp-surface1 rounded-md text-sm text-ctp-text focus:outline-none focus:ring-2 focus:ring-ctp-blue focus:border-transparent`
- Custom text input: same styling as select
- "Use preset" button: `text-xs text-ctp-subtext0 hover:text-ctp-text transition-colors`
- Footer note: `text-xs text-ctp-overlay0` with `border-t border-ctp-surface1` separator
  </action>
  <verify>
1. Run `npx tsc --noEmit` and confirm no type errors (ignore pre-existing TS2440)
2. Verify IntegrationsSettings shows editor and terminal dropdowns
3. Verify selecting "Custom path..." shows a text input
4. Verify "Use preset" switches back to dropdown
5. Verify preferences persist via settings store
  </verify>
  <done>
IntegrationsSettings created with platform-aware editor and terminal dropdowns, custom path fallback, persistence via updateSetting. Includes future-use note.
  </done>
</task>

<task type="auto">
  <name>Task 3: Activate Integrations tab in SettingsWindow</name>
  <files>src/components/settings/SettingsWindow.tsx</files>
  <action>
Update `src/components/settings/SettingsWindow.tsx` to activate the Integrations tab.

**Step 1**: Add the import for IntegrationsSettings after the GitSettings import:
```typescript
import { IntegrationsSettings } from "./IntegrationsSettings";
```

**Step 2**: In the `settingsTabs` array, uncomment the Integrations entry. Change:
```typescript
  // Integrations tab -- uncommented by Plan 19-04 when component is created:
  // { id: "integrations", label: "Integrations", icon: Wrench, component: IntegrationsSettings },
```
To:
```typescript
  { id: "integrations", label: "Integrations", icon: Wrench, component: IntegrationsSettings },
```

The Wrench icon import should already be present from Plan 19-02. The final tab order is:
General, Git, Integrations, Appearance.

This is a 2-line change (import + uncomment) -- exactly the simplicity the tab refactor was designed for.
  </action>
  <verify>
1. Verify SettingsWindow imports IntegrationsSettings
2. Verify Integrations tab entry is active in settingsTabs array
3. Verify clicking "Integrations" in settings sidebar shows the IntegrationsSettings component
4. Verify tab order: General, Git, Integrations, Appearance
  </verify>
  <done>
Integrations tab activated in SettingsWindow with Wrench icon between Git and Appearance. IntegrationsSettings component renders when tab is selected.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes (ignore pre-existing TS2440 in bindings.ts)
2. Settings window shows 4 tabs: General, Git, Integrations, Appearance
3. Integrations tab has Wrench icon
4. External Editor dropdown shows platform-appropriate options
5. Terminal Shell dropdown shows platform-appropriate options
6. Both dropdowns have a "Custom path..." option that reveals a text input
7. Selecting "None" clears the preference
8. Preferences persist across settings open/close
9. Selecting a preset saves the identifier string (e.g., "code", "iterm2")
10. Custom path input saves the typed path string
11. If a custom value was previously saved, component starts in custom mode
12. Note about future actions is visible at the bottom
</verification>

<success_criteria>
- Integrations tab visible in Settings between Git and Appearance
- External editor dropdown with platform-aware options and custom path
- Terminal shell dropdown with platform-aware options and custom path
- Preferences persisted to Tauri store under settings.integrations
- Preferences NOT wired to any actions (save only)
</success_criteria>

<output>
After completion, create `.planning/phases/19-settings-onboarding-file-icons/19-04-SUMMARY.md`
</output>
