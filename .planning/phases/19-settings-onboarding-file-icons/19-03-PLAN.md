---
phase: 19-settings-onboarding-file-icons
plan: 03
type: execute
wave: 2
depends_on: [1, 2]
files_modified:
  - src/components/settings/GitSettings.tsx
autonomous: true

must_haves:
  truths:
    - "GitSettings tab shows three new fields: Name, Email, Default branch name under a 'Git Identity' heading"
    - "Git identity fields read values from global git config via commands.getGitGlobalConfig() on mount"
    - "Git identity fields write values to global git config via commands.setGitGlobalConfig() with 500ms debounce"
    - "Save status indicator shows 'Saving...', 'Saved to git config', or error state with aria-live region"
    - "Existing defaultRemote and autoFetchInterval fields remain under a separate 'Repository Defaults' section, behavior unchanged"
    - "Git Identity and Repository Defaults sections are visually separated by a horizontal rule"
  artifacts:
    - path: "src/components/settings/GitSettings.tsx"
      provides: "Expanded Git settings with identity fields from global config plus existing app settings"
      exports: ["GitSettings"]
  key_links:
    - from: "src/components/settings/GitSettings.tsx"
      to: "src/bindings.ts"
      via: "imports commands for getGitGlobalConfig and setGitGlobalConfig"
      pattern: "import.*commands.*from.*bindings"
    - from: "src/components/settings/GitSettings.tsx"
      to: "src/components/settings/SettingsField.tsx"
      via: "imports SettingsField for consistent form layout"
      pattern: "import.*SettingsField.*from.*SettingsField"
---

<objective>
Expand the GitSettings tab to include user.name, user.email, and init.defaultBranch fields that read from and write to the global git configuration (~/.gitconfig).

Purpose: This satisfies requirement SETT-02 -- "Settings window has a Git tab where user can set name, email, and default branch name." These fields use a different persistence mechanism than existing settings: they call Rust commands (from Plan 19-01) rather than the Zustand settings store, and they debounce text input to avoid writing to ~/.gitconfig on every keystroke.

Output: An expanded GitSettings component with two visual sections: "Git Identity" (config-backed) and "Repository Defaults" (store-backed).
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/settings/GitSettings.tsx
@src/components/settings/SettingsField.tsx
@src/stores/settings.ts
@src/bindings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite GitSettings with identity fields section</name>
  <files>src/components/settings/GitSettings.tsx</files>
  <action>
Replace the entire content of `src/components/settings/GitSettings.tsx` with an expanded version that includes both the existing app-settings fields and the new git-config identity fields.

The new component has two major sections separated by a horizontal rule:

**Section 1: "Git Identity"** (backed by `~/.gitconfig` via Rust commands)
- `user.name` -- text input, debounced save
- `user.email` -- email input, debounced save
- `init.defaultBranch` -- text input, debounced save
- Loaded from `commands.getGitGlobalConfig()` on mount
- Saved via `commands.setGitGlobalConfig(key, value)` with 500ms debounce
- Each field has its own debounce timer (typing in one does not reset another)
- Shows loading state (disabled inputs) while reading config
- Shows error banner if config cannot be read
- Save status indicator with `aria-live="polite"`: "Saving..." / "Saved to git config" / error
- Status auto-clears after 2 seconds

**Section 2: "Repository Defaults"** (backed by Tauri store, existing behavior)
- `defaultRemote` -- text input, immediate save via `updateSetting()`
- `autoFetchInterval` -- checkbox + number input, immediate save via `updateSetting()`
- These fields are completely unchanged in behavior

Implementation details:
1. Import `useCallback, useEffect, useRef, useState` from React
2. Import `commands` from `../../bindings`
3. Import `useSettingsStore` from `../../stores/settings`
4. Import `SettingsField` from `./SettingsField` (from Plan 19-02)
5. Define `GIT_CONFIG_DEBOUNCE_MS = 500` constant
6. Local state: `userName`, `userEmail`, `defaultBranch`, `configLoading`, `configError`, `saveStatus`
7. Refs for debounce timers: `nameTimerRef`, `emailTimerRef`, `branchTimerRef`, `saveStatusTimerRef`
8. `useEffect` on mount to load config with cleanup for cancelled requests
9. `useEffect` cleanup for timer refs on unmount
10. `saveGitConfig` callback that clears previous timer, sets new timeout, calls `commands.setGitGlobalConfig`, manages save status
11. Individual change handlers: `handleNameChange`, `handleEmailChange`, `handleBranchChange` that update local state and trigger debounced save
12. All identity inputs use the same styling as existing inputs: `w-full max-w-xs px-3 py-2 bg-ctp-surface0 border border-ctp-surface1 rounded-md text-sm text-ctp-text placeholder-ctp-overlay0 focus:outline-none focus:ring-2 focus:ring-ctp-blue focus:border-transparent disabled:opacity-50`
13. Use `SettingsField` wrapper for all fields (both new and existing)
14. Wrap existing fields in `SettingsField` too for consistency

The error banner uses: `p-3 mb-4 bg-ctp-red/10 border border-ctp-red/30 rounded-md` with `text-sm text-ctp-red`
The save status indicator uses: `text-xs text-ctp-overlay0` for saving, `text-xs text-ctp-green` for saved, `text-xs text-ctp-red` for error
The section separator uses: `border-t border-ctp-surface1`
  </action>
  <verify>
1. Run `npx tsc --noEmit` and confirm no type errors (ignore pre-existing TS2440 in bindings.ts)
2. Verify GitSettings imports commands from bindings
3. Verify GitSettings imports SettingsField
4. Verify both git identity and repository defaults sections render
5. Verify existing defaultRemote and autoFetchInterval behavior is preserved
  </verify>
  <done>
GitSettings expanded with Git Identity section (name, email, defaultBranch from ~/.gitconfig) and Repository Defaults section (existing fields). Debounced auto-save with visual feedback. All fields use SettingsField wrapper.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes (ignore pre-existing TS2440 in bindings.ts)
2. GitSettings tab shows three new fields: Name, Email, Default branch name
3. Fields load values from global git config on component mount
4. Fields show disabled state while loading
5. Typing in a field saves to git config after 500ms debounce
6. Save status indicator shows "Saving...", "Saved to git config", or error
7. Save status resets to idle after 2 seconds
8. Error banner shows if git config cannot be read
9. Existing "Default remote" and "Auto-fetch interval" fields still work as before
10. Git Identity and Repository Defaults sections are visually separated
11. All form fields have accessible labels (htmlFor/id pairs)
12. Screen readers announce save status via aria-live region
</verification>

<success_criteria>
- user.name, user.email, init.defaultBranch fields visible in Git settings tab
- Fields read from and write to global git config (not Tauri store)
- Debounced auto-save for text inputs (no save button)
- Visual feedback for save status (saving/saved/error)
- Existing settings fields unchanged in behavior
</success_criteria>

<output>
After completion, create `.planning/phases/19-settings-onboarding-file-icons/19-03-SUMMARY.md`
</output>
