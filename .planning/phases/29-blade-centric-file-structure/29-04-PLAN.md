---
phase: 29-blade-centric-file-structure
plan: 04
type: execute
wave: 2
depends_on: ["29-01"]
files_modified:
  - src/blades/settings/SettingsBlade.tsx
  - src/blades/settings/SettingsBlade.test.tsx
  - src/blades/settings/registration.ts
  - src/blades/settings/index.ts
  - src/blades/settings/components/GeneralSettings.tsx
  - src/blades/settings/components/AppearanceSettings.tsx
  - src/blades/settings/components/GitSettings.tsx
  - src/blades/settings/components/IntegrationsSettings.tsx
  - src/blades/settings/components/ReviewSettings.tsx
  - src/blades/settings/components/SettingsField.tsx
  - src/blades/gitflow-cheatsheet/GitflowCheatsheetBlade.tsx
  - src/blades/gitflow-cheatsheet/GitflowCheatsheetBlade.test.tsx
  - src/blades/gitflow-cheatsheet/registration.ts
  - src/blades/gitflow-cheatsheet/index.ts
autonomous: true

must_haves:
  truths:
    - "Settings blade loads with all 5 settings panels (General, Appearance, Git, Integrations, Review)"
    - "Gitflow cheatsheet blade loads and shows gitflow diagram, action cards, and branch reference"
    - "Settings store remains shared in stores/settings.ts (used by App.tsx)"
    - "Gitflow store remains shared in stores/gitflow.ts (used by gitflow panel dialogs)"
  artifacts:
    - path: "src/blades/settings/registration.ts"
      provides: "Auto-discovered registration for settings blade"
      contains: "registerBlade"
    - path: "src/blades/settings/components/GeneralSettings.tsx"
      provides: "Settings sub-component co-located with blade"
    - path: "src/blades/gitflow-cheatsheet/registration.ts"
      provides: "Auto-discovered registration for gitflow-cheatsheet blade"
      contains: "registerBlade"
  key_links:
    - from: "src/blades/settings/SettingsBlade.tsx"
      to: "src/stores/settings.ts"
      via: "shared store import (stays shared)"
      pattern: 'from.*stores/settings'
    - from: "src/blades/gitflow-cheatsheet/GitflowCheatsheetBlade.tsx"
      to: "src/components/gitflow/"
      via: "shared gitflow component imports (stays shared)"
      pattern: 'from.*components/gitflow'
---

<objective>
Migrate the settings and gitflow-cheatsheet blades, both of which have multiple sub-components but shared stores.

Purpose: Handle blades with sub-component directories while correctly keeping their stores shared. Settings has 6 sub-components in `components/settings/`. Gitflow-cheatsheet imports 3 sub-components from the SHARED `components/gitflow/` directory (which is also used by RepositoryView, InitGitflowDialog, etc.).

Output: 2 more blade directories. Settings sub-components move into the blade. Gitflow shared components stay in `components/gitflow/`.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/29-blade-centric-file-structure/29-RESEARCH.md
@.planning/phases/29-blade-centric-file-structure/29-01-SUMMARY.md

@src/components/blades/SettingsBlade.tsx
@src/components/blades/GitflowCheatsheetBlade.tsx
@src/components/blades/registrations/settings.ts
@src/components/blades/registrations/gitflow-cheatsheet.ts
@src/components/settings/GeneralSettings.tsx
@src/components/settings/AppearanceSettings.tsx
@src/components/settings/GitSettings.tsx
@src/components/settings/IntegrationsSettings.tsx
@src/components/settings/ReviewSettings.tsx
@src/components/settings/SettingsField.tsx
@src/stores/settings.ts
@src/stores/gitflow.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate settings blade with 6 sub-components</name>
  <files>
    src/blades/settings/SettingsBlade.tsx
    src/blades/settings/SettingsBlade.test.tsx
    src/blades/settings/registration.ts
    src/blades/settings/index.ts
    src/blades/settings/components/GeneralSettings.tsx
    src/blades/settings/components/AppearanceSettings.tsx
    src/blades/settings/components/GitSettings.tsx
    src/blades/settings/components/IntegrationsSettings.tsx
    src/blades/settings/components/ReviewSettings.tsx
    src/blades/settings/components/SettingsField.tsx
  </files>
  <action>
    1. Create `src/blades/settings/` and `src/blades/settings/components/` directories.

    2. `git mv src/components/blades/SettingsBlade.tsx src/blades/settings/`
    3. `git mv src/components/blades/SettingsBlade.test.tsx src/blades/settings/`

    4. Move all 6 settings sub-components via `git mv`:
       ```
       git mv src/components/settings/GeneralSettings.tsx src/blades/settings/components/
       git mv src/components/settings/AppearanceSettings.tsx src/blades/settings/components/
       git mv src/components/settings/GitSettings.tsx src/blades/settings/components/
       git mv src/components/settings/IntegrationsSettings.tsx src/blades/settings/components/
       git mv src/components/settings/ReviewSettings.tsx src/blades/settings/components/
       git mv src/components/settings/SettingsField.tsx src/blades/settings/components/
       ```

    5. Delete the now-empty `src/components/settings/` directory.

    6. Create `src/blades/settings/registration.ts`:
       ```typescript
       import { lazy } from "react";
       import { registerBlade } from "@/lib/bladeRegistry";

       const SettingsBlade = lazy(() =>
         import("./SettingsBlade").then((m) => ({ default: m.SettingsBlade }))
       );

       registerBlade({
         type: "settings",
         defaultTitle: "Settings",
         component: SettingsBlade,
         lazy: true,
         singleton: true,
       });
       ```

    7. Create `src/blades/settings/index.ts`:
       ```typescript
       // Public API for settings blade
       // No public types -- settings store lives in shared stores/settings.ts
       ```

    8. Update imports in moved files:
       - `SettingsBlade.tsx`: Update settings sub-component imports from `../settings/GeneralSettings` to `./components/GeneralSettings` (they're now in the same blade directory)
       - `SettingsBlade.tsx`: Update shared store import -- `useSettingsStore` stays at `@/stores/settings` or `../../stores/settings`
       - Each sub-component (GeneralSettings, etc.): Update their imports:
         - `useSettingsStore` -> `@/stores/settings` or `../../../stores/settings`
         - `SettingsField` -> `./SettingsField` (relative within components/)
         - Any other shared imports (theme store, etc.) -> adjust relative paths

    9. Delete old registration: `git rm src/components/blades/registrations/settings.ts`

    IMPORTANT: Settings store (`stores/settings.ts`) is SHARED -- it's used by App.tsx for initialization. Do NOT move it into the blade.
  </action>
  <verify>
    - `ls -R src/blades/settings/` shows blade files + components/ with all 6 sub-components
    - `tsc --noEmit` passes
    - `vitest run` passes
    - `ls src/components/settings/` fails (directory removed)
    - `ls src/stores/settings.ts` still exists (store NOT moved)
    - Old registration deleted
  </verify>
  <done>Settings blade migrated with all 6 sub-components co-located in `blades/settings/components/`. Settings store correctly remains shared. Old registration and empty sub-component directory removed. TypeScript compiles, tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate gitflow-cheatsheet blade (shared sub-components stay in place)</name>
  <files>
    src/blades/gitflow-cheatsheet/GitflowCheatsheetBlade.tsx
    src/blades/gitflow-cheatsheet/GitflowCheatsheetBlade.test.tsx
    src/blades/gitflow-cheatsheet/registration.ts
    src/blades/gitflow-cheatsheet/index.ts
  </files>
  <action>
    1. Create `src/blades/gitflow-cheatsheet/` directory.

    2. `git mv src/components/blades/GitflowCheatsheetBlade.tsx src/blades/gitflow-cheatsheet/`
    3. `git mv src/components/blades/GitflowCheatsheetBlade.test.tsx src/blades/gitflow-cheatsheet/`

    4. Create `src/blades/gitflow-cheatsheet/registration.ts`:
       ```typescript
       import { lazy } from "react";
       import { registerBlade } from "@/lib/bladeRegistry";

       const GitflowCheatsheetBlade = lazy(() =>
         import("./GitflowCheatsheetBlade").then((m) => ({ default: m.GitflowCheatsheetBlade }))
       );

       registerBlade({
         type: "gitflow-cheatsheet",
         defaultTitle: "GitFlow Cheatsheet",
         component: GitflowCheatsheetBlade,
         lazy: true,
         singleton: true,
       });
       ```

    5. Create `src/blades/gitflow-cheatsheet/index.ts`:
       ```typescript
       // Public API for gitflow-cheatsheet blade
       // No public types -- gitflow store and components are shared
       ```

    6. Update imports in `GitflowCheatsheetBlade.tsx`:
       - `useGitflowStore` stays shared: `from "@/stores/gitflow"` or `from "../../stores/gitflow"`
       - Gitflow sub-components stay shared (used by RepositoryView and dialogs):
         - `GitflowDiagram` -> `from "@/components/gitflow/GitflowDiagram"` or `from "../../components/gitflow/GitflowDiagram"`
         - `GitflowActionCards` -> same pattern
         - `GitflowBranchReference` -> same pattern
       - BladeContent* components -> `from "../_shared"` (barrel import)

    7. Update imports in test file: Adjust relative paths for test-utils.

    8. Delete old registration: `git rm src/components/blades/registrations/gitflow-cheatsheet.ts`

    IMPORTANT: Do NOT move `src/components/gitflow/` into the blade. The gitflow directory contains GitflowPanel, InitGitflowDialog, StartFlowDialog, FinishFlowDialog, ReviewChecklist -- all used by RepositoryView and other non-blade contexts. They are SHARED infrastructure.
  </action>
  <verify>
    - `ls src/blades/gitflow-cheatsheet/` shows GitflowCheatsheetBlade.tsx, test, registration.ts, index.ts
    - `tsc --noEmit` passes
    - `vitest run` passes
    - `ls src/components/gitflow/` still exists (shared components NOT moved)
    - Old registration deleted
    - `grep -r "from.*components/gitflow" src/blades/gitflow-cheatsheet/` shows imports of shared gitflow components
  </verify>
  <done>Gitflow-cheatsheet blade migrated to `blades/gitflow-cheatsheet/`. Shared gitflow components correctly remain in `components/gitflow/`. Shared gitflow store stays in `stores/`. Old registration deleted. 10/15 blades migrated total. TypeScript compiles, tests pass.</done>
</task>

</tasks>

<verification>
- `tsc --noEmit` passes
- `vitest run` -- all tests pass
- 2 new blade directories: settings (with components/ sub-dir), gitflow-cheatsheet
- Settings sub-components co-located in blade; gitflow sub-components correctly remain shared
- Shared stores (settings.ts, gitflow.ts) remain in `stores/`
- 10/15 blades now in new structure, 5 remaining in old
- All 15 blades discoverable
</verification>

<success_criteria>
1. Settings blade migrated with 6 co-located sub-components
2. Gitflow-cheatsheet blade migrated; shared gitflow components stay in `components/gitflow/`
3. Both shared stores (settings, gitflow) remain in `stores/`
4. 10/15 blades in new structure
5. TypeScript compiles, all tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/29-blade-centric-file-structure/29-04-SUMMARY.md`
</output>
