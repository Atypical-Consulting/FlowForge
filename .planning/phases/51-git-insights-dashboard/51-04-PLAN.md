---
phase: 51-git-insights-dashboard
plan: 04
type: execute
wave: 3
depends_on: ["51-03"]
files_modified:
  - src/extensions/git-insights/components/CommitActivityChart.tsx
  - src/extensions/git-insights/components/ContributorBreakdown.tsx
  - src/extensions/git-insights/components/BranchHealthOverview.tsx
  - src/extensions/git-insights/components/RepoStatsCards.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a bar chart of daily commit frequency with hover tooltips showing date and count"
    - "User sees a contributor list with commit counts, activity bars, avatars, and can click to filter"
    - "User sees a branch list with last commit date, ahead/behind badges, staleness flags, and checkout/delete actions"
    - "User sees four stat cards (Total Commits, Active Branches, Contributors, Repo Age) in a responsive grid"
    - "All chart and component colors use Catppuccin Mocha tokens"
  artifacts:
    - path: "src/extensions/git-insights/components/CommitActivityChart.tsx"
      provides: "visx XYChart bar chart for daily commit frequency"
      exports: ["CommitActivityChart"]
    - path: "src/extensions/git-insights/components/ContributorBreakdown.tsx"
      provides: "Contributor list with avatars, percentage bars, click-to-filter"
      exports: ["ContributorBreakdown"]
    - path: "src/extensions/git-insights/components/BranchHealthOverview.tsx"
      provides: "Branch health table with staleness, ahead/behind, quick actions"
      exports: ["BranchHealthOverview"]
    - path: "src/extensions/git-insights/components/RepoStatsCards.tsx"
      provides: "Four stat cards in responsive grid"
      exports: ["RepoStatsCards"]
  key_links:
    - from: "src/extensions/git-insights/components/CommitActivityChart.tsx"
      to: "@visx/xychart"
      via: "XYChart, AnimatedBarSeries, Axis, Grid, Tooltip imports"
      pattern: "from \"@visx/xychart\""
    - from: "src/extensions/git-insights/components/CommitActivityChart.tsx"
      to: "src/extensions/git-insights/lib/chartTheme.ts"
      via: "insightsChartTheme for chart theme prop"
      pattern: "insightsChartTheme"
    - from: "src/extensions/git-insights/components/ContributorBreakdown.tsx"
      to: "src/extensions/git-insights/insightsStore.ts"
      via: "selectContributor action for click-to-filter"
      pattern: "selectContributor"
    - from: "src/extensions/git-insights/components/BranchHealthOverview.tsx"
      to: "src/bindings.ts"
      via: "commands.checkoutBranch and commands.deleteBranch for quick actions"
      pattern: "commands\\."
---

<objective>
Build the four production-grade dashboard visualization components: commit activity chart, contributor breakdown, branch health overview, and repo stats cards.

Purpose: These are the visual heart of the insights dashboard — the components users interact with to understand repository activity. Each component must feel native to FlowForge's Catppuccin dark theme with thoughtful design, tasteful hover states, and meaningful data presentation.

Output: Four polished components that replace any stubs from Plan 03, completing the full dashboard experience.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/51-git-insights-dashboard/51-RESEARCH.md
@.planning/phases/51-git-insights-dashboard/51-02-SUMMARY.md
@.planning/phases/51-git-insights-dashboard/51-03-SUMMARY.md

@src/extensions/git-insights/types.ts
@src/extensions/git-insights/lib/chartTheme.ts
@src/extensions/git-insights/insightsStore.ts
@src/extensions/git-insights/components/GravatarAvatar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CommitActivityChart and RepoStatsCards components</name>
  <files>src/extensions/git-insights/components/CommitActivityChart.tsx, src/extensions/git-insights/components/RepoStatsCards.tsx</files>
  <action>
**Create `src/extensions/git-insights/components/CommitActivityChart.tsx`:**

A visx XYChart bar chart showing daily commit frequency. Uses the Catppuccin chart theme with animated bars and interactive tooltips.

Implementation details:
- Import from `@visx/xychart`: `XYChart`, `AnimatedBarSeries`, `AnimatedGrid`, `Axis`, `Tooltip`
- Import from `@visx/responsive`: `ParentSize`
- Import `insightsChartTheme` from `../lib/chartTheme`
- Import `DailyCommitCount` from `../types`

Props: `{ data: DailyCommitCount[] }`

Component structure:
```tsx
<ParentSize>
  {({ width }) => (
    <XYChart
      height={220}
      width={width}
      theme={insightsChartTheme}
      xScale={{ type: "band", paddingInner: 0.3 }}
      yScale={{ type: "linear" }}
    >
      <AnimatedGrid columns={false} numTicks={4} />
      <AnimatedBarSeries
        dataKey="Daily Commits"
        data={data}
        xAccessor={(d) => d.date}
        yAccessor={(d) => d.count}
        colorAccessor={() => "#89b4fa"}  // ctp-blue
        radiusAll={3}                     // rounded bar tops
      />
      <Axis
        orientation="bottom"
        numTicks={Math.min(data.length, 7)}
        tickFormat={formatDate}          // show "Feb 14" not "2026-02-14"
        hideTicks
      />
      <Axis
        orientation="left"
        numTicks={4}
        hideTicks
        hideAxisLine
      />
      <Tooltip
        snapTooltipToDatumX
        snapTooltipToDatumY
        showVerticalCrosshair
        verticalCrosshairStyle={{ stroke: "#89b4fa", strokeOpacity: 0.3 }}
        renderTooltip={...}
      />
    </XYChart>
  )}
</ParentSize>
```

Tooltip rendering: A styled div with date (formatted) and commit count. Use Catppuccin colors:
```tsx
renderTooltip={({ tooltipData }) => {
  const datum = tooltipData?.nearestDatum?.datum as DailyCommitCount | undefined;
  if (!datum) return null;
  return (
    <div className="rounded-lg bg-ctp-surface0 px-3 py-2 text-xs shadow-lg border border-ctp-surface1/50">
      <div className="font-medium text-ctp-text">{formatDateFull(datum.date)}</div>
      <div className="text-ctp-blue mt-0.5">
        {datum.count} commit{datum.count !== 1 ? "s" : ""}
      </div>
    </div>
  );
}}
```

Helper functions:
- `formatDate(dateStr: string)`: Parse "YYYY-MM-DD" and return short format like "Feb 14"
- `formatDateFull(dateStr: string)`: Parse and return "February 14, 2026"

Handle empty data: If `data.length === 0`, show a centered "No commit activity" message with subtle icon.

Handle chart height: Fixed 220px height. The ParentSize wrapper handles width responsiveness.

**Create `src/extensions/git-insights/components/RepoStatsCards.tsx`:**

Four stat cards in a responsive grid showing total commits, active branches, contributors, and repo age.

Props: `{ insights: RepoInsights | null; branchCount: number; isLoading: boolean }`

Implementation:
```tsx
import { motion } from "framer-motion";
import { GitCommitHorizontal, GitBranch, Users, Clock } from "lucide-react";
import type { RepoInsights } from "../types";

interface Props {
  insights: RepoInsights | null;
  branchCount: number;
  isLoading: boolean;
}

interface StatCardData {
  label: string;
  value: string;
  icon: React.ComponentType<{ className?: string }>;
  color: string;        // text color class
  bgColor: string;      // icon bg class (surface with colored tint)
}

function computeRepoAge(firstCommitMs: number): string {
  const days = Math.floor((Date.now() - firstCommitMs) / 86_400_000);
  if (days < 30) return `${days}d`;
  if (days < 365) return `${Math.floor(days / 30)}mo`;
  const years = Math.floor(days / 365);
  const remainMonths = Math.floor((days % 365) / 30);
  return remainMonths > 0 ? `${years}y ${remainMonths}mo` : `${years}y`;
}
```

Card layout: Use `grid grid-cols-2 gap-3 lg:grid-cols-4` for responsive 2-col (mobile) / 4-col (desktop).

Each stat card design:
```tsx
<motion.div
  className="group relative overflow-hidden rounded-xl border border-ctp-surface0/50 bg-ctp-mantle/60 px-4 py-3.5 backdrop-blur-sm transition-colors hover:border-ctp-surface1/70"
  initial={{ opacity: 0, y: 8 }}
  animate={{ opacity: 1, y: 0 }}
  transition={{ delay: index * 0.05, duration: 0.2 }}
>
  {/* Subtle gradient accent at top */}
  <div className={`absolute inset-x-0 top-0 h-px ${gradientClass}`} />

  <div className="flex items-start justify-between">
    <div>
      <p className="text-[10px] font-medium uppercase tracking-wider text-ctp-subtext0">
        {card.label}
      </p>
      <p className={`mt-1 text-xl font-bold ${card.color}`}>
        {isLoading ? "—" : card.value}
      </p>
    </div>
    <div className={`rounded-lg p-2 ${card.bgColor}`}>
      <card.icon className={`h-4 w-4 ${card.color}`} />
    </div>
  </div>
</motion.div>
```

Four cards:
1. **Total Commits** — `GitCommitHorizontal`, `text-ctp-blue`, value: `insights.totalCommits.toLocaleString()`
2. **Active Branches** — `GitBranch`, `text-ctp-green`, value: `branchCount.toString()`
3. **Contributors** — `Users`, `text-ctp-mauve`, value: `insights.contributorCount.toString()`
4. **Repo Age** — `Clock`, `text-ctp-peach`, value: computed from `firstCommitMs`

Icon background colors use surface with opacity: e.g., `bg-ctp-blue/10` for blue card icon bg.

Gradient accent line at top of each card: `bg-gradient-to-r from-transparent via-{color}/30 to-transparent` for subtle polish.

Staggered entrance: Each card animates in with 50ms delay multiplied by index.
  </action>
  <verify>
Run `npx tsc --noEmit --skipLibCheck 2>&1 | grep -E "CommitActivityChart|RepoStatsCards" | head -5` — no type errors.
  </verify>
  <done>
CommitActivityChart renders a visx bar chart with Catppuccin theme, animated bars, responsive width, and styled tooltips. RepoStatsCards renders four polished stat cards with staggered animations, gradient accents, and responsive grid layout.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ContributorBreakdown and BranchHealthOverview components</name>
  <files>src/extensions/git-insights/components/ContributorBreakdown.tsx, src/extensions/git-insights/components/BranchHealthOverview.tsx</files>
  <action>
**Create `src/extensions/git-insights/components/ContributorBreakdown.tsx`:**

A contributor list with avatars, horizontal activity bars, commit counts, and click-to-filter functionality.

Props: `{ contributors: ContributorStats[]; totalCommits: number }`

Implementation:

```tsx
import { motion } from "framer-motion";
import type { ContributorStats } from "../types";
import { GravatarAvatar } from "./GravatarAvatar";
import { useInsightsStore } from "../insightsStore";

interface Props {
  contributors: ContributorStats[];
  totalCommits: number;
}
```

Render a scrollable list (max-height ~320px with `overflow-y-auto`) of contributor rows.

Each contributor row:
```tsx
<button
  onClick={() => {
    const current = useInsightsStore.getState().selectedContributor;
    useInsightsStore.getState().selectContributor(
      current === contributor.email ? null : contributor.email
    );
  }}
  className={`group flex w-full items-center gap-3 rounded-lg px-3 py-2 text-left transition-colors ${
    isSelected
      ? "bg-ctp-blue/10 border border-ctp-blue/20"
      : "hover:bg-ctp-surface0/50 border border-transparent"
  }`}
>
  <GravatarAvatar email={contributor.email} name={contributor.name} size="sm" />
  <div className="min-w-0 flex-1">
    <div className="flex items-center justify-between">
      <span className="truncate text-xs font-medium text-ctp-text">
        {contributor.name}
      </span>
      <span className="ml-2 shrink-0 text-[10px] text-ctp-subtext0">
        {contributor.commitCount} commits
      </span>
    </div>
    {/* Activity bar */}
    <div className="mt-1.5 h-1.5 w-full overflow-hidden rounded-full bg-ctp-surface0/60">
      <motion.div
        className="h-full rounded-full bg-ctp-blue"
        initial={{ width: 0 }}
        animate={{ width: `${contributor.percentage}%` }}
        transition={{ duration: 0.5, delay: index * 0.03 }}
      />
    </div>
    <span className="mt-0.5 text-[10px] text-ctp-subtext0">
      {contributor.percentage.toFixed(1)}%
    </span>
  </div>
</button>
```

Design details:
- Clicking a contributor toggles the `selectedContributor` filter (click again to deselect)
- Selected state: subtle blue tint background with blue border
- Activity bar: animated horizontal bar showing percentage of total commits
- Bars stagger in with 30ms delay per contributor
- `truncate` on name to handle long names
- Max 15 contributors shown. If more exist, show a "and N more..." footer text
- Empty state: "No contributor data" message

**Create `src/extensions/git-insights/components/BranchHealthOverview.tsx`:**

A branch health table with last commit date, ahead/behind badges, staleness indicators, and quick actions.

Props: `{ branches: BranchHealthInfo[] }`

Implementation:

```tsx
import { motion } from "framer-motion";
import {
  GitBranch,
  ArrowUp,
  ArrowDown,
  AlertTriangle,
  CheckCircle2,
  Trash2,
  ExternalLink,
} from "lucide-react";
import type { BranchHealthInfo } from "../types";
import { commands } from "../../../bindings";
import { toast } from "../../../core/stores/toast";
import { useInsightsStore } from "../insightsStore";
```

Render a scrollable list (max-height ~320px) of branch rows.

Each branch row:
```tsx
<div className="flex items-center gap-3 rounded-lg px-3 py-2 hover:bg-ctp-surface0/30 transition-colors">
  {/* Branch icon with color coding */}
  <div className={`shrink-0 ${branch.isStale ? "text-ctp-yellow" : "text-ctp-green"}`}>
    <GitBranch className="h-3.5 w-3.5" />
  </div>

  {/* Branch name and metadata */}
  <div className="min-w-0 flex-1">
    <div className="flex items-center gap-2">
      <span className="truncate text-xs font-medium text-ctp-text">
        {branch.name}
      </span>
      {branch.isHead && (
        <span className="shrink-0 rounded-full bg-ctp-green/15 px-1.5 py-0.5 text-[9px] font-medium text-ctp-green">
          HEAD
        </span>
      )}
      {branch.isStale && (
        <AlertTriangle className="h-3 w-3 shrink-0 text-ctp-yellow" />
      )}
      {branch.isMerged && (
        <CheckCircle2 className="h-3 w-3 shrink-0 text-ctp-green" />
      )}
    </div>
    <div className="mt-0.5 flex items-center gap-2 text-[10px] text-ctp-subtext0">
      <span>{formatRelativeDate(branch.lastCommitTimestampMs)}</span>
      {(branch.ahead > 0 || branch.behind > 0) && (
        <span className="flex items-center gap-1">
          {branch.ahead > 0 && (
            <span className="flex items-center text-ctp-green">
              <ArrowUp className="h-2.5 w-2.5" />{branch.ahead}
            </span>
          )}
          {branch.behind > 0 && (
            <span className="flex items-center text-ctp-red">
              <ArrowDown className="h-2.5 w-2.5" />{branch.behind}
            </span>
          )}
        </span>
      )}
    </div>
  </div>

  {/* Quick actions */}
  <div className="flex shrink-0 items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
    {!branch.isHead && !branch.isRemote && (
      <>
        <button
          onClick={() => handleCheckout(branch.name)}
          className="rounded p-1 text-ctp-subtext0 hover:bg-ctp-surface1 hover:text-ctp-text"
          title="Checkout branch"
        >
          <ExternalLink className="h-3 w-3" />
        </button>
        <button
          onClick={() => handleDelete(branch.name)}
          className="rounded p-1 text-ctp-subtext0 hover:bg-ctp-red/10 hover:text-ctp-red"
          title="Delete branch"
        >
          <Trash2 className="h-3 w-3" />
        </button>
      </>
    )}
  </div>
</div>
```

Helper functions:
- `formatRelativeDate(timestampMs: number)`: Returns "2 days ago", "3 weeks ago", "2 months ago", etc.
- `handleCheckout(name: string)`: Call `commands.checkoutBranch(name)`, show toast on success/error, reload branch health data via `useInsightsStore.getState().loadBranchHealth()`
- `handleDelete(name: string)`: Call `commands.deleteBranch(name, false)` (non-force), show toast, reload branch health

Design details:
- Quick actions appear on hover (`opacity-0 group-hover:opacity-100`)
- Add `group` to the parent row div for group-hover
- Staleness: yellow AlertTriangle icon next to stale branches
- Merged: green CheckCircle2 icon for merged branches
- HEAD branch: green "HEAD" badge pill
- Ahead/behind: green ArrowUp for ahead, red ArrowDown for behind
- Maximum 20 branches shown. If more, show "and N more branches..." footer
- Remote branches show `isRemote` branches but without checkout/delete actions
- Empty state: "No branches found" message

Handle the tauri-specta result pattern for checkout/delete: `if (result.status === "error")` show error toast.
  </action>
  <verify>
Run `npx tsc --noEmit --skipLibCheck 2>&1 | grep -E "ContributorBreakdown|BranchHealthOverview" | head -5` — no type errors. All four dashboard components exist and export their named functions.
  </verify>
  <done>
ContributorBreakdown renders an interactive contributor list with Gravatar avatars, animated percentage bars, and click-to-filter functionality. BranchHealthOverview renders a branch health table with staleness indicators, ahead/behind badges, and hover-reveal quick actions for checkout and delete.
  </done>
</task>

</tasks>

<verification>
1. All four component files exist and export named functions
2. CommitActivityChart imports from `@visx/xychart` and `@visx/responsive`
3. CommitActivityChart uses `insightsChartTheme` from chartTheme.ts
4. ContributorBreakdown renders GravatarAvatar for each contributor
5. ContributorBreakdown calls `selectContributor` on click
6. BranchHealthOverview shows ahead/behind with colored badges
7. BranchHealthOverview has checkout and delete quick actions
8. RepoStatsCards shows four stat cards with responsive grid
9. All components use Catppuccin color tokens (ctp-*)
10. `npx tsc --noEmit --skipLibCheck` passes with no new errors
</verification>

<success_criteria>
The insights dashboard displays four fully functional, production-grade visualization components: a visx bar chart with tooltips, an interactive contributor list with avatars and filtering, a branch health table with quick actions, and animated stat cards. All components use the Catppuccin Mocha theme, have proper empty and loading states, and feel native to FlowForge's existing visual language.
</success_criteria>

<output>
After completion, create `.planning/phases/51-git-insights-dashboard/51-04-SUMMARY.md`
</output>
