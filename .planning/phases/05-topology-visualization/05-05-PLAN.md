# Plan: UI Integration and Commit Selection

## Frontmatter

```yaml
phase: 05
plan: 05
type: frontend
wave: 4
depends_on: [05-03, 05-04]
files_modified:
  - src/components/sidebar/Sidebar.tsx
  - src/components/repository/RepositoryView.tsx
  - src/components/topology/TopologyPanel.tsx
autonomous: false
must_haves:
  - Topology panel accessible from sidebar navigation
  - Clicking commit node shows commit details
  - Integration with existing commit detail panel
  - Visual indication of selected commit
```

## Objective

Integrate the TopologyPanel into the main application layout, add navigation in the sidebar, and connect commit selection to the existing commit details functionality.

## Tasks

<task id="1">
<title>Add Topology navigation to sidebar</title>
<instructions>
Update the sidebar navigation to include a Topology option.

Find the sidebar component (likely `src/components/sidebar/Sidebar.tsx` or similar) and add a navigation item for the topology view.

Look for existing navigation patterns using icons like GitBranch, History, etc. Add:

```typescript
import { Network } from 'lucide-react'; // or GitGraph icon

// In the navigation items array, add:
{
  id: 'topology',
  label: 'Topology',
  icon: Network, // or appropriate graph icon
}
```

Follow the existing navigation pattern for active state styling and click handlers.
</instructions>
</task>

<task id="2">
<title>Add TopologyPanel to RepositoryView</title>
<instructions>
Update the main repository view to render TopologyPanel when topology navigation is selected.

Find the repository view component and add conditional rendering:

```typescript
import { TopologyPanel } from '@/components/topology';

// In the view switching logic:
{activeView === 'topology' && <TopologyPanel />}
```

Ensure the TopologyPanel has proper container sizing (h-full w-full or flex-1).

If using tabs or view switching, add topology as an option following existing patterns.
</instructions>
</task>

<task id="3">
<title>Connect commit selection to details panel</title>
<instructions>
Update the TopologyPanel to integrate with the existing commit details panel.

1. Find how commit selection works in the existing history view
2. Use the same store/mechanism for topology commit selection
3. When a commit node is clicked:
   - Update the selected commit in the appropriate store
   - The existing commit details panel should react to this change

If there's a `useHistoryStore` or similar that manages selected commit, use it:

```typescript
// In useCommitGraph or TopologyPanel
const setSelectedCommit = useHistoryStore((s) => s.setSelectedCommit);

// On node click:
const handleSelectCommit = (oid: string) => {
  selectCommit(oid); // topology store
  setSelectedCommit(oid); // history store for details panel
};
```

Pass `handleSelectCommit` to the nodes instead of just `selectCommit`.
</instructions>
</task>

<task id="4">
<title>Add visual selected state to nodes</title>
<instructions>
Ensure selected commit is visually distinct in the graph.

The CommitNode already has `isSelected` styling. Verify:
1. Selected node has visible ring/glow effect
2. Ring color matches the branch type or uses accent color
3. Selection is visible at different zoom levels

Update CommitNode if needed:

```typescript
className={cn(
  // ... existing classes
  data.isSelected && 'ring-2 ring-primary ring-offset-2 ring-offset-background shadow-lg'
)}
```
</instructions>
</task>

<task id="5">
<title>Test integration manually</title>
<instructions>
Manual testing checklist (for human verification):

1. Launch the application with a Git repository open
2. Navigate to Topology view from sidebar
3. Verify commit graph renders with colored nodes
4. Verify edges connect parent-child commits
5. Verify different branch types have distinct colors:
   - Main/master: Purple
   - Develop: Green
   - Feature branches: Blue
   - Release branches: Amber/Yellow
   - Hotfix branches: Red
6. Click on a commit node
7. Verify commit details panel shows the selected commit
8. Verify selected node has visual distinction
9. Test pan and zoom controls
10. Test "Load More" button if repository has many commits

Report any issues found for follow-up fixes.
</instructions>
</task>

## Verification

```bash
# Check sidebar has topology navigation
grep -n "topology\|Topology" src/components/sidebar/*.tsx

# Check RepositoryView includes TopologyPanel
grep -n "TopologyPanel" src/components/repository/*.tsx

# Verify all topology components compile
npx tsc --noEmit 2>&1 | head -20
```

## Success Criteria

- [ ] Topology navigation item visible in sidebar
- [ ] TopologyPanel renders in repository view
- [ ] Clicking commit shows details in existing panel
- [ ] Selected commit visually highlighted
- [ ] All Gitflow branch types have correct colors
- [ ] Pan/zoom controls functional
- [ ] Human verification confirms visual quality
