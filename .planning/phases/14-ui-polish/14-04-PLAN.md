---
phase: 14-ui-polish
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/RepositoryView.tsx
  - src/components/layout/ResizablePanelLayout.tsx
  - src/components/ui/ShortcutTooltip.tsx
  - src/components/Header.tsx
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Frosted glass blur is visibly apparent on sidebar section headers when content scrolls behind them"
    - "ShortcutTooltip for the Open button does not overflow the right edge of the window"
    - "All ShortcutTooltips have lightweight styling consistent with the Catppuccin UI aesthetic"
  artifacts:
    - path: "src/components/RepositoryView.tsx"
      provides: "Sidebar with single continuous scroll container, no per-section scroll wrappers"
      contains: "overflow-y-auto"
    - path: "src/components/layout/ResizablePanelLayout.tsx"
      provides: "Panel wrapper that does not clip backdrop-blur"
      contains: "overflow-clip"
    - path: "src/components/ui/ShortcutTooltip.tsx"
      provides: "Tooltip with viewport boundary detection and light styling"
      contains: "getBoundingClientRect"
    - path: "src/components/Header.tsx"
      provides: "Open button tooltip with correct alignment"
      contains: "ShortcutTooltip"
  key_links:
    - from: "src/components/RepositoryView.tsx"
      to: "sidebar scroll behavior"
      via: "single overflow-y-auto container with sticky headers"
      pattern: "sticky top-0.*backdrop-blur"
    - from: "src/components/ui/ShortcutTooltip.tsx"
      to: "viewport boundary"
      via: "getBoundingClientRect measurement and translate adjustment"
      pattern: "getBoundingClientRect"
---

<objective>
Fix two UAT gaps from Phase 14 verification:

1. **Frosted glass blur not visible** — Sidebar section content scrolls inside individual max-h/overflow-y-auto containers, so nothing ever scrolls behind the sticky headers where backdrop-blur would be visible. Also, overflow-hidden on the ResizablePanel may clip the backdrop-filter rendering.

2. **ShortcutTooltip off-screen and ugly styling** — The Open button tooltip overflows the right edge of the window because it uses center-anchored positioning with no viewport boundary detection. Tooltip styling is visually heavy compared to the rest of the UI.

Purpose: Close the remaining 2 UAT issues so Phase 14 can be marked complete.
Output: Fixed sidebar scrolling for visible frosted glass effect; refined tooltip component with viewport-aware positioning and lighter styling.
</objective>

<execution_context>
@/Users/phmatray/.claude/get-shit-done/workflows/execute-plan.md
@/Users/phmatray/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-ui-polish/14-02-SUMMARY.md
@.planning/phases/14-ui-polish/14-03-SUMMARY.md
@.planning/phases/14-ui-polish/14-UAT.md
@src/components/RepositoryView.tsx
@src/components/layout/ResizablePanelLayout.tsx
@src/components/ui/ShortcutTooltip.tsx
@src/components/Header.tsx
@src/components/sync/SyncButtons.tsx
@src/components/commit/CommitForm.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix sidebar scroll structure for visible frosted glass blur</name>
  <files>
    src/components/RepositoryView.tsx
    src/components/layout/ResizablePanelLayout.tsx
  </files>
  <action>
**In `src/components/RepositoryView.tsx`:**

Remove the individual `max-h-XX overflow-y-auto` wrapper divs from ALL sidebar section content areas. Currently each `<details>` section wraps its content in a constraining div:

- `<div className="max-h-64 overflow-y-auto">` around BranchList — REMOVE this wrapper div entirely (keep BranchList as direct child of the details element)
- `<div className="max-h-48 overflow-y-auto">` around StashList — REMOVE this wrapper div
- `<div className="max-h-48 overflow-y-auto">` around TagList — REMOVE this wrapper div
- `<div className="max-h-64 overflow-y-auto">` around WorktreePanel — REMOVE this wrapper div
- GitflowPanel has no wrapper div, leave it alone

The outer container (`<div className="flex-1 overflow-y-auto">`) already provides a single scroll container for the entire sidebar. With individual scroll wrappers removed, all section content participates in this single scroll. The sticky `<summary>` headers (with `sticky top-0 z-10 bg-ctp-base/70 backdrop-blur-lg`) will then have content actually scrolling behind them, making the frosted glass blur visible.

**In `src/components/layout/ResizablePanelLayout.tsx`:**

Change the Panel's className from `"overflow-hidden"` to `"overflow-clip"`. The `overflow-clip` property prevents content from escaping the panel boundary (identical to `overflow-hidden` for layout purposes) but does NOT create a new containing block that can interfere with `backdrop-filter` rendering in Chromium.

**Do NOT change:**
- The frosted glass classes on the `<summary>` elements (they are correct: `bg-ctp-base/70 backdrop-blur-lg border-b border-ctp-surface0/50`)
- The `sticky top-0 z-10` positioning on headers
- The `flex-1 overflow-y-auto` on the outer sidebar scroll container
- The CommitForm section at the bottom (`shrink-0`, not part of scroll area)
  </action>
  <verify>
1. `npx tsc --noEmit 2>&1 | grep -v 'bindings.ts'` — no new type errors
2. Visual: Open app with a repo that has multiple branches/stashes/tags. Scroll the left sidebar — content should scroll behind sticky headers, frosted glass blur visible through semi-transparent header backgrounds.
3. All 5 section headers (Branches, Stashes, Tags, Gitflow, Worktrees) remain sticky when scrolling.
4. CommitForm stays anchored at the bottom of the sidebar panel.
  </verify>
  <done>
Sidebar sections scroll as a single continuous list. Frosted glass blur is visually apparent on all 5 sticky section headers when content scrolls behind them. No layout regressions — CommitForm stays anchored at bottom, panel resize still works correctly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix ShortcutTooltip viewport detection and restyle</name>
  <files>
    src/components/ui/ShortcutTooltip.tsx
  </files>
  <action>
**A. Add viewport boundary detection:**

Add a ref to the tooltip element and measure its position after it becomes visible. If it overflows the viewport, shift it horizontally.

Implementation:
1. Add `const tooltipRef = useRef<HTMLDivElement>(null);`
2. Add `const [nudgeX, setNudgeX] = useState(0);`
3. Reset `nudgeX` to 0 when `visible` becomes false.
4. Add a `useEffect` that runs when `visible` changes:
   ```tsx
   useEffect(() => {
     if (visible && tooltipRef.current) {
       const rect = tooltipRef.current.getBoundingClientRect();
       const padding = 8;
       let shift = 0;
       if (rect.right > window.innerWidth - padding) {
         shift = window.innerWidth - padding - rect.right;
       } else if (rect.left < padding) {
         shift = padding - rect.left;
       }
       if (shift !== 0) setNudgeX(shift);
     }
   }, [visible]);
   ```
5. On the tooltip element:
   - Keep `left-1/2` class
   - Remove `-translate-x-1/2` from className
   - Add `style={{ transform: \`translateX(calc(-50% + ${nudgeX}px))\` }}`
   - Attach `ref={tooltipRef}`
   - For framer-motion: animate only opacity (remove y-axis animation to avoid transform conflicts)

**B. Lighten tooltip container styling:**

Replace visual classes on the tooltip container:

OLD: `rounded-md border border-ctp-surface0 bg-ctp-crust px-2.5 py-1.5 shadow-lg`
NEW: `rounded-md bg-ctp-mantle/95 backdrop-blur-sm px-2.5 py-1.5 shadow-md border border-ctp-surface0/30`

**C. Simplify kbd element styling:**

OLD: `inline-flex items-center justify-center min-w-[20px] h-5 px-1.5 text-[10px] font-mono font-medium rounded border border-ctp-surface2 bg-ctp-surface0 text-ctp-subtext1 shadow-[0_1px_0_0_var(--ctp-surface2)]`
NEW: `inline-flex items-center justify-center min-w-[18px] h-[18px] px-1 text-[10px] font-mono font-medium rounded bg-ctp-surface0/80 text-ctp-subtext0`

Removes: border, 3D shadow. Softens: background opacity, text color. Slightly smaller footprint.

**No changes needed to Header.tsx, SyncButtons.tsx, or CommitForm.tsx** — the viewport boundary detection in ShortcutTooltip handles all positions automatically.
  </action>
  <verify>
1. `npx tsc --noEmit 2>&1 | grep -v 'bindings.ts'` — no new type errors
2. Hover over Open button (far right of header) for ~500ms — tooltip appears fully within the window.
3. Hover over Settings gear (left side) — tooltip appears roughly centered below the button.
4. Hover over Fetch/Pull/Push buttons — tooltips appear below, properly positioned.
5. Hover over Amend checkbox in commit form — tooltip appears above (side="top"), properly positioned.
6. All tooltips have lighter styling: semi-transparent bg, subtle border, flat kbd badges without 3D shadow.
7. Tooltip fade-in/fade-out animation still works.
  </verify>
  <done>
ShortcutTooltip detects viewport overflow and shifts horizontally to stay on screen. Tooltip background is semi-transparent with subtle border (matches Catppuccin aesthetic). Kbd elements are flat and muted (no 3D shadow effect). All 6 tooltip instances display correctly regardless of screen position.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Two UAT gap fixes:
1. Sidebar frosted glass — sections now scroll as one continuous list behind sticky headers, making backdrop-blur visible.
2. ShortcutTooltip — viewport-aware positioning prevents off-screen rendering; lighter styling matches app aesthetic.
  </what-built>
  <how-to-verify>
**Frosted glass (UAT Test 5 recheck):**
1. Open a repository with several branches, stashes, and tags
2. Scroll the left sidebar down — content should flow behind the sticky section headers
3. Observe the frosted glass blur effect through the semi-transparent header backgrounds
4. All 5 headers (Branches, Stashes, Tags, Gitflow, Worktrees) should remain sticky

**Tooltip styling and positioning (UAT Test 9 recheck):**
1. Hover over "Open" button (far right of header) for ~500ms — tooltip should appear fully within the window
2. Hover over "Settings" gear icon (left side) — tooltip should be centered below
3. Hover over Fetch/Pull/Push buttons — tooltips should appear below, properly positioned
4. Hover over Amend checkbox in commit form — tooltip should appear above
5. All tooltips should have a refined, lightweight look — semi-transparent background, no heavy borders or 3D key styling
  </how-to-verify>
  <resume-signal>Type "approved" if both fixes look correct, or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles without new errors: `npx tsc --noEmit 2>&1 | grep -v 'bindings.ts'`
2. App starts without console errors
3. Frosted glass blur is visible when scrolling sidebar
4. No tooltip overflows viewport edges
5. Tooltip styling is visually consistent with the Catppuccin theme
6. No regressions in existing 9 passing UAT tests
</verification>

<success_criteria>
- UAT Test 5 (Frosted Glass) passes: blur effect is visible on all 5 sidebar section headers
- UAT Test 9 (Shortcut Tooltips) passes: tooltips are correctly positioned and visually consistent
- No regressions in sidebar layout, panel resizing, or tooltip functionality
- All 11 UAT tests pass (9 existing passes maintained + 2 gap fixes)
</success_criteria>

<output>
After completion, create `.planning/phases/14-ui-polish/14-04-SUMMARY.md`
</output>
