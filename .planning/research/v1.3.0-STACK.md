# v1.3.0 Stack Additions

**Project:** FlowForge
**Researched:** 2026-02-07
**Scope:** New dependencies for blade expansion, branch management, and documentation site
**Overall Confidence:** HIGH

---

## Context

FlowForge v1.2.0 has a validated, frozen stack (Tauri 2 / React 19 / TypeScript / Zustand / React Query / Monaco / framer-motion / Catppuccin / react-resizable-panels / react-virtuoso). This document covers ONLY the new dependencies needed for v1.3.0 features. Nothing in the existing stack needs changing.

---

## Summary: What to Add

| Feature | New Frontend Packages | New Rust Crates | Lazy-Loaded |
|---------|----------------------|-----------------|-------------|
| 3D Model Viewer | `@google/model-viewer` | None | Yes |
| Markdown Preview | `react-markdown`, `remark-gfm`, `rehype-highlight` | None | Yes |
| Repo File Browser | None | None (new commands using existing `git2`) | N/A |
| Branch Management | None | None (extend existing commands) | N/A |
| Modal-to-Blade Migration | None | None | N/A |
| Two-Column Staging | None (use existing `react-resizable-panels`) | None | N/A |
| Documentation Site | Docusaurus (separate workspace) | None | Not in app bundle |

**Total new production dependencies in the main app: 4 packages.**
**Total new Rust crates: 0.**

---

## 1. 3D Model Viewer (Blender .glb/.gltf)

### Recommendation: `@google/model-viewer` ^4.1.0

| Technology | Version | Purpose |
|------------|---------|---------|
| `@google/model-viewer` | 4.1.0 | GLB/GLTF 3D preview web component |

**Why `@google/model-viewer`:**
- Self-contained web component: `<model-viewer src="model.glb" camera-controls></model-viewer>` gives you orbit controls, auto-lighting, and camera framing with zero configuration
- Purpose-built for exactly this use case -- previewing 3D models, not building 3D applications
- Maintained by Google, broadly adopted, stable API (v4.1.0, 401 files in published package)
- Framework-agnostic: works as a custom element in React without wrapper libraries
- Three.js is embedded internally but fully encapsulated -- no API surface to learn

**Why NOT `@babylonjs/viewer` (v8.50.2):**
- Pulls `lit` (LitElement) as a transitive dependency, adding a second web component runtime
- Official docs note React integration "has limitations" with string attribute mapping for the `<babylon-viewer>` custom element
- Downloads ~470KB compressed for a basic glTF -- comparable to model-viewer but with more complexity
- BabylonJS is a full 3D engine; its viewer is a thin wrapper. For read-only file preview, it is overengineered
- Tree-shaking BabylonJS is notoriously difficult: forum reports show bundles hitting 5MB+ without careful import management

**Why NOT `@react-three/fiber` + `@react-three/drei` + `three`:**
- Three separate packages (three v0.182.0, @react-three/fiber v9.5.0, @react-three/drei v10.7.7)
- Requires writing a custom viewer component: scene, camera, controls, lighting, GLTF loader, Suspense boundaries
- Gives full scene control you do not need for a read-only preview

### Integration with FlowForge

```
Blade Type:     "viewer-3d" (new BladeType)
Extension Map:  .glb, .gltf -> "viewer-3d"
Data Loading:   Existing `commands.getFileBase64()` / `commands.getCommitFileBase64()`
                Decode base64 -> Blob -> createObjectURL -> pass to model-viewer src
Bundle Impact:  ~300-400KB gzipped, loaded ONLY when user opens a 3D file
Loading:        React.lazy(() => import('./Viewer3dBlade'))
```

**TypeScript declaration needed:**
```typescript
// src/types/model-viewer.d.ts
declare namespace JSX {
  interface IntrinsicElements {
    'model-viewer': React.DetailedHTMLProps<
      React.HTMLAttributes<HTMLElement>,
      HTMLElement
    > & {
      src?: string;
      alt?: string;
      'camera-controls'?: boolean;
      'auto-rotate'?: boolean;
      poster?: string;
      loading?: 'auto' | 'lazy' | 'eager';
    };
  }
}
```

**Confidence:** HIGH -- v4.1.0 verified via npm registry. Web component approach is proven in existing `ViewerImageBlade` pattern.

---

## 2. Markdown Preview/Rendering

### Recommendation: `react-markdown` ^10.1.0 + `remark-gfm` ^4.0.1 + `rehype-highlight` ^7.0.2

| Technology | Version | Purpose |
|------------|---------|---------|
| `react-markdown` | 10.1.0 | Render markdown to React elements |
| `remark-gfm` | 4.0.1 | GitHub Flavored Markdown (tables, task lists, strikethrough) |
| `rehype-highlight` | 7.0.2 | Syntax highlighting in fenced code blocks |

**Why `react-markdown`:**
- De facto standard React markdown renderer. v10.1.0 verified via npm
- Builds a virtual DOM -- React only re-renders what changed. No `dangerouslySetInnerHTML`
- Plugin architecture via unified/remark/rehype for extensibility
- Peer dependency: `react >= 18` (FlowForge has React 19 -- compatible)
- Component override API: `components={{ code: CustomCode, a: CustomLink }}` for Catppuccin styling

**Why `remark-gfm`:**
- Most README.md files use GitHub Flavored Markdown
- Without it, tables render as pipe-separated text. Task lists become plain bullets
- This is a table-stakes expectation for any markdown renderer in a Git client

**Why `rehype-highlight` over alternatives:**

| Library | Gzipped Size | Integration | Verdict |
|---------|-------------|-------------|---------|
| `rehype-highlight` (lowlight/highlight.js) | ~40-50KB | Native rehype plugin, drops into react-markdown pipeline | **Use this** |
| `react-syntax-highlighter` (Prism) | ~1.2MB default | External component, requires custom `code` renderer | Too heavy |
| `react-shiki` (Shiki/WASM) | ~695KB-1.2MB | External, WASM-based, overkill for runtime | Too heavy |

`rehype-highlight` uses `lowlight` (a virtual highlight.js) -- 190+ languages, ~40KB gzipped. It plugs directly into react-markdown's rehype pipeline with zero extra component wiring:

```tsx
import ReactMarkdown from 'react-markdown';
import remarkGfm from 'remark-gfm';
import rehypeHighlight from 'rehype-highlight';

<ReactMarkdown remarkPlugins={[remarkGfm]} rehypePlugins={[rehypeHighlight]}>
  {markdownContent}
</ReactMarkdown>
```

**Why NOT `rehype-raw`:**
- Enables raw HTML passthrough in markdown. Security concern, unnecessary for file viewer
- Explicitly omit to prevent XSS vectors from malicious README files

### Integration with FlowForge

```
Blade Type:     "viewer-markdown" (new BladeType)
Extension Map:  .md, .mdx, .markdown -> "viewer-markdown"
Data Loading:   New Rust command `get_file_text(ref, path)` returns UTF-8 string
                OR decode from existing getFileBase64/getCommitFileBase64
Styling:        Import highlight.js Catppuccin theme CSS:
                import 'highlight.js/styles/catppuccin-mocha.css'
                (highlight.js ships Catppuccin themes natively since v11.8)
Bundle Impact:  ~80-100KB gzipped total, loaded ONLY when user opens a .md file
Loading:        React.lazy(() => import('./ViewerMarkdownBlade'))
```

**Catppuccin styling for markdown elements:**
Override `components` prop to apply `text-ctp-blue` for links, `border-ctp-surface0` for blockquotes, `bg-ctp-surface0` for inline code, etc. This aligns markdown rendering with the rest of the app's Catppuccin theme.

**Confidence:** HIGH -- all versions verified via `npm view`. Pipeline compatibility confirmed (all use unified v11).

---

## 3. Repository File Browser Blade

### Recommendation: No new packages. New Rust commands using existing `git2`.

**Why no new frontend packages:**
- `FileTreeBlade.tsx` already implements tree/flat view toggle with search and folder expansion
- `FileTreeView.tsx` in staging already handles recursive tree rendering with expand/collapse
- `react-virtuoso` v4.18.1 (already installed) handles virtualized lists for large trees
- `FileTypeIcon.tsx` already maps file extensions to Lucide icons

**New Rust commands needed (using existing `git2` v0.20):**

```rust
// List directory entries at a given ref + path
// Uses: repo.revparse_single(ref) -> tree.get_path(path) -> iterate entries
pub async fn list_tree(ref_name: String, path: Option<String>, state: State<'_, RepositoryState>)
    -> Result<Vec<TreeEntry>, GitError>

// Read file content at a given ref + path
// Uses: repo.revparse_single(ref) -> tree.get_path(path) -> blob.content()
pub async fn get_file_text(ref_name: String, path: String, state: State<'_, RepositoryState>)
    -> Result<FileContent, GitError>
```

Where `TreeEntry` contains: name, entry_type (blob/tree/submodule), size, oid. And `FileContent` contains: text content (if UTF-8) or binary flag.

These use standard `git2` APIs (`Tree::walk`, `TreeEntry`, `Blob`) -- no new crates.

**Integration:**
- New blade type `repo-browser` in `BladeType` union
- Clicking a folder drills deeper (or expands inline)
- Clicking a file opens the appropriate viewer blade based on extension (diff/image/markdown/3d)
- Breadcrumb navigation showing current ref + path

**Confidence:** HIGH -- git2-rs tree walking is well-documented, existing `FileTreeBlade` provides proven UI patterns.

---

## 4. Branch Management (Cleanup, Last-Used Tracking)

### Recommendation: No new packages. Extend existing infrastructure.

**What already exists:**
- `branch.rs`: `list_branches`, `list_all_branches` (with `is_merged` field), `delete_branch` (with force flag)
- `BranchInfo` struct includes `is_merged: Option<bool>` -- the key signal for cleanup
- `BranchList.tsx` / `BranchItem.tsx` -- existing branch display components
- `tauri-plugin-store` v2 -- already installed for persisted settings

**Rust-side additions (no new crates):**

| New Command | Implementation |
|-------------|----------------|
| `delete_branches(names: Vec<String>, force: bool)` | Batch delete, iterate `names`, call `branch.delete()` for each |
| Add `last_commit_timestamp` to `BranchInfo` | Extract via `branch.get().peel_to_commit()?.time()` (git2 `Time` struct) |

**Frontend-side additions (no new packages):**

| Addition | Implementation |
|----------|----------------|
| Last-checkout tracking | Store `Record<string, number>` (branch name -> epoch) in `tauri-plugin-store`. Update on `checkout_branch` success |
| Branch cleanup UI | New blade type `branch-management` with multi-select, sort-by-last-used, filter-merged, bulk delete |

**Confidence:** HIGH -- `is_merged` is already computed. Commit timestamps use existing git2 patterns. Storage uses existing plugin.

---

## 5. Modal-to-Blade Migration

### Recommendation: Pure refactoring. No new packages.

**Current modals to migrate:**
- `SettingsWindow.tsx` -- Dialog with tabbed navigation (General, Git, Integrations, Appearance)
- `ConventionalCommitModal.tsx` -- Dialog for commit message composition
- `ChangelogDialog.tsx` -- Dialog for changelog generation/preview

**New blade types:**
- `settings` -- Extract tabbed content from SettingsWindow into a blade
- `conventional-commit` -- Extract form from ConventionalCommitModal
- `changelog` -- Extract form + preview from ChangelogDialog

**Migration pattern:**
1. Extract inner content of each Dialog into a standalone component
2. Wrap in BladePanel with appropriate title
3. Register as new BladeType in store
4. Add navigation entry points (command palette, header buttons, keyboard shortcuts)
5. Keep Dialog component available for simple confirmations (delete, force push)

**Confidence:** HIGH -- Architecture decision, not technology choice. All infrastructure exists.

---

## 6. Two-Column Staging Layout

### Recommendation: Use existing `react-resizable-panels` v4.6.0.

**Current state:** `StagingPanel.tsx` renders staged/unstaged/untracked sections vertically in a single column.

**Target state:** Side-by-side layout:
```
+---------------------------+---------------------------+
|  Changes (Unstaged)       |  Staged Changes           |
|  + Untracked Files        |                           |
|                           |                           |
|  [File list]              |  [File list]              |
|                           |                           |
|  [Stage All ->]           |  [<- Unstage All]         |
+---------------------------+---------------------------+
```

**Implementation:**
- `react-resizable-panels` is already used in `ResizablePanelLayout.tsx` -- proven pattern
- Split StagingPanel into `<PanelGroup direction="horizontal">` with two `<Panel>` children
- Left panel: unstaged + untracked. Right panel: staged
- Stage/unstage actions already exist as mutations -- wire them to per-file and bulk buttons
- No drag-and-drop library needed for v1.3: click-to-stage/unstage is the existing pattern

**Confidence:** HIGH -- Already validated in codebase.

---

## 7. Documentation Website

### Recommendation: Docusaurus 3.9.2 (separate workspace)

| Technology | Version | Purpose |
|------------|---------|---------|
| `@docusaurus/core` | 3.9.2 | Static site generator |
| `@docusaurus/preset-classic` | 3.9.2 | Default theme + plugins (docs, blog, search) |

**Why Docusaurus:**
- React-based: FlowForge team already writes React. No learning Vue (VitePress) or Astro templates (Starlight)
- First-class GitHub Pages deployment: `docusaurus deploy` command or GitHub Actions workflow
- v3.9.2 (verified npm) is stable, maintained by Meta, most adopted docs framework (4x VitePress)
- Built-in: versioned docs, local search, MDX, blog, dark mode, TypeScript support

**Why NOT VitePress (Vue-based):**
- Forces Vue for a React team. Custom components written in Vue cannot be shared with the main app
- Good tool, wrong ecosystem match

**Why NOT Starlight/Astro:**
- `@astrojs/starlight` is v0.37.6 -- pre-1.0, implying possible breaking changes
- Astro's `.astro` component model is a third paradigm (not React, not Vue)
- Over-flexible for a documentation site; Docusaurus is purpose-built

**Setup (completely separate from Tauri app):**
```bash
# From project root
npx create-docusaurus@latest docs classic --typescript
```

This creates `docs/` with its own `package.json`, `node_modules/`, and build pipeline.

**GitHub Actions deployment:**
```yaml
# .github/workflows/docs.yml
name: Deploy docs
on:
  push:
    branches: [main]
    paths: ['docs/**']
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: 20 }
      - run: cd docs && npm ci && npm run build
      - uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs/build
```

**Bundle impact on main app: ZERO.** Docusaurus is a separate build pipeline.

**Confidence:** HIGH -- v3.9.2 verified, GitHub Pages deployment officially documented.

---

## What NOT to Add

| Library | Why NOT |
|---------|---------|
| `react-arborist` / `react-complex-tree` | FlowForge already has proven tree components. Adding a tree library creates competing implementations |
| `dnd-kit` / `react-dnd` | Drag-and-drop for staging is nice-to-have. Click-to-stage suffices for v1.3. Defer to v1.4+ |
| `@mdx-js/react` | MDX (JSX in markdown) is for authoring, not viewing. We render existing repo files, not interactive docs |
| `rehype-raw` | Raw HTML passthrough in markdown is a security risk. Intentionally omitted |
| `sass` / `styled-components` | Tailwind v4 + Catppuccin handles all styling. Do not introduce a second paradigm |
| `monaco-editor` (for markdown) | Monaco shows raw text, not rendered markdown. Different use case |
| Any new state library | Zustand + React Query handles everything. No Redux, Jotai, or MobX |
| `lit` (via BabylonJS) | Avoid pulling in LitElement runtime as a transitive dependency |
| New Rust crates | All new backend features use existing `git2` v0.20 and `tauri-plugin-store` v2 APIs |

---

## Installation Commands

### Main App

```bash
# 3D model viewer (web component)
npm install @google/model-viewer

# Markdown rendering pipeline
npm install react-markdown remark-gfm rehype-highlight
```

### Documentation Site

```bash
npx create-docusaurus@latest docs classic --typescript
```

### Rust Backend

No changes to `Cargo.toml`. All new Tauri commands use existing `git2` crate APIs.

---

## Bundle Impact Assessment

| Addition | Est. Gzipped Size | Loading Strategy | Startup Impact |
|----------|-------------------|------------------|----------------|
| `@google/model-viewer` | ~300-400KB | `React.lazy()` on blade mount | None |
| `react-markdown` + `remark-gfm` | ~35-40KB | `React.lazy()` on blade mount | None |
| `rehype-highlight` (lowlight) | ~40-50KB | Bundled with markdown blade chunk | None |
| Docusaurus | 0KB | Separate build pipeline | None |
| **Total in main app** | **~375-490KB** | **All lazy-loaded** | **Zero** |

The app's initial bundle size and startup time are completely unchanged. All new viewer dependencies are code-split into on-demand chunks that load only when a user actually opens the corresponding file type.

---

## Version Verification Log

All versions verified against the npm registry on 2026-02-07:

| Package | Verified Version | Command |
|---------|-----------------|---------|
| `@google/model-viewer` | 4.1.0 | `npm view @google/model-viewer version` |
| `react-markdown` | 10.1.0 | `npm view react-markdown version` |
| `remark-gfm` | 4.0.1 | `npm view remark-gfm version` |
| `rehype-highlight` | 7.0.2 | `npm view rehype-highlight version` |
| `highlight.js` (transitive) | 11.11.1 | `npm view highlight.js version` |
| `@docusaurus/core` | 3.9.2 | `npm view @docusaurus/core version` |
| `@docusaurus/preset-classic` | 3.9.2 | `npm view @docusaurus/preset-classic version` |
| `@babylonjs/viewer` (rejected) | 8.50.2 | `npm view @babylonjs/viewer version` |
| `@react-three/fiber` (rejected) | 9.5.0 | `npm view @react-three/fiber version` |
| `@astrojs/starlight` (rejected) | 0.37.6 | `npm view @astrojs/starlight version` |

---

## Sources

- [@google/model-viewer npm](https://www.npmjs.com/package/@google/model-viewer) -- v4.1.0
- [@google/model-viewer GitHub](https://github.com/google/model-viewer) -- web component for 3D models
- [Babylon Viewer V2 docs](https://doc.babylonjs.com/features/featuresDeepDive/babylonViewer) -- HTML3DElement, ~470KB compressed
- [BabylonJS bundle size discussion](https://forum.babylonjs.com/t/treeshaking-but-bundle-still-over-5mb/44370) -- tree-shaking challenges
- [react-markdown GitHub](https://github.com/remarkjs/react-markdown) -- v10.1.0, unified pipeline
- [react-markdown npm](https://www.npmjs.com/package/react-markdown) -- peer deps `react >= 18`
- [rehype-highlight vs rehype-prism discussion](https://github.com/orgs/rehypejs/discussions/43) -- rehype-prism loads all languages (352KB gzip)
- [Syntax highlighter comparison](https://npm-compare.com/highlight.js,prismjs,react-syntax-highlighter,shiki) -- bundle sizes
- [Docusaurus deployment docs](https://docusaurus.io/docs/deployment) -- GitHub Pages config
- [Starlight getting started](https://starlight.astro.build/getting-started/) -- Astro-based docs framework
- [BabylonJS Viewer V2 announcement](https://babylonjs.medium.com/babylon-viewer-v2-e3e05674f110) -- 470KB compressed claim
- [BabylonJS and React docs](https://doc.babylonjs.com/communityExtensions/Babylon.js+ExternalLibraries/BabylonJS_and_ReactJS) -- React integration limitations
